a couple places streams are opened and are not closed. patch fixes this.