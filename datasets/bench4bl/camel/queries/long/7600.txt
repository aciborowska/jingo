QueueLoadBalancer needs to set callback before ending processing but when no processor is returned by chooseProcessor method, it only throws exception, which in turn makes it impossible to use it with onException.
To fix it setException should be used instead of throwing exception.