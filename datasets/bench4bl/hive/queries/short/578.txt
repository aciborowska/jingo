Refactor partition pruning code as an optimizer transformation