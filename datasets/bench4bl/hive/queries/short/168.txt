join on a subquery with a group by does not work