Refactor Heartbeater logic for transaction