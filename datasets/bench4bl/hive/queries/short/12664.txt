Bug in reduce deduplication optimization causing ArrayOutOfBoundException