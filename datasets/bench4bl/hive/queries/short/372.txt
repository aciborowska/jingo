Nested UDFs cause _very_ high memory usage when processing query