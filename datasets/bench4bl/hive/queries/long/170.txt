map-side aggregation depends on runtime.freememory() which is not guaranteed to return the freeable memory - it depends on when the garbage collector is invoked last.
It might be a good idea to estimate the number of rows that can fit in the hash table and then flush the hash table based on that