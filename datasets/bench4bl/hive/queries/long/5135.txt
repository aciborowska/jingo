HIVE-4388 makes a first couple of changes needed to fix unit tests with hadoop 2.x, and also modifies TestE2EScenarios to bring it up to date to use Shims, but TestE2EScenarios still fails because TaskAttemptId being instantiated with no arguments fails under hadoop 2.x.
I'm attaching a patch here which sits on top of HIVE-4388 to fix the test under hadoop 2.x, but is a WIP. After HIVE-4388 gets committed, I will revisit this to check if we need to shim out TaskAttemptID or not, and test across versions.