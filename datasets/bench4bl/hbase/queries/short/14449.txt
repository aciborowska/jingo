Rewrite deadlock prevention for concurrent connection close