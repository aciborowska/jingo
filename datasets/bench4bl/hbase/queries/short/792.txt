Rewrite getClosestAtOrJustBefore; doesn't scale as currently written