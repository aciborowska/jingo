Because shell uses old API, it runs into the "Can't add deletes to a BatchUpdate" issue.  Add new API to do shell delete and deleteAll.  Just a few lines.