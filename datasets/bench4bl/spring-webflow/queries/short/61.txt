NPE throwing Exception when currentState == null