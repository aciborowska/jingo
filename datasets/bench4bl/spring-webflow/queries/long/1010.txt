On the FlowExecutionListener.sessionEnded callback, the flow has already terminated.  If a commit occurs here and fails because of a version check on an optimistic lock, there is no way for the ending flow to capture this and ask the user to start over and try again.  The common optimistic lock failure case should be implemented and the commit logic possibly moved to sessionEnding which runs before ending--allowing the flow to handle failures.