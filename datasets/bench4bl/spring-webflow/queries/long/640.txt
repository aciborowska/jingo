This is because restoreVariables is only called when resuming from an external client, not when resuming interally as a result of a subflow ending and a parent flow continuing.
This is a subtle bug that can produce NPEs in some circumstances.