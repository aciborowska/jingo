Sometimes I have a error in my logs about toke series: "Querying token for series 'qF0PD5V64BRvlxTHU577ZQ==' returned more than one value. Series should be unique"
Looks like series generator generates not unique values and it causes some problems later.
Also the class logic is not clear for me. 
1. In case of broken tokens they are never removed from the database because JdbcTokenRepositoryImpl returns null but PersistentTokenBasedRememberMeServices does nothing in this case:






PersistentTokenBasedRememberMeServices.java






        if (token == null) {




            // No series match, so we can't authenticate using this cookie




            throw new RememberMeAuthenticationException("No persistent token found for series id: " + presentedSeries);




        }






2. I have a lot browsers. At least 3 but when I have incorrect token in one browser, for example, all other marked as broken:






PersistentTokenBasedRememberMeServices.java






        if (!presentedToken.equals(token.getTokenValue())) {




            // Token doesn't match series value. Delete all logins for this user and throw an exception to warn them.




            tokenRepository.removeUserTokens(token.getUsername());




Â 




            throw new CookieTheftException(messages.getMessage("PersistentTokenBasedRememberMeServices.cookieStolen",




                    "Invalid remember-me token (Series/token) mismatch. Implies previous cookie theft attack."));




        }






Why all my tokens are removed if only one is broken?
3. If token is expired it's not removed from DB:






PersistentTokenBasedRememberMeServices.java






        if (token.getDate().getTime() + getTokenValiditySeconds()*1000L < System.currentTimeMillis()) {




            throw new RememberMeAuthenticationException("Remember-me login has expired");




        }






At this moment my database has a lot of broken tokens.
