As it is currently, ConnectedAttrProcessor directly uses a type from Thymeleaf's Spring 3 integration and does not work when Thymeleaf's Spring 4 integration is in play.
ConnectedAttrProcessor should probably detect which version is in the classpath or depend on an abstract adapter that makes that decision.