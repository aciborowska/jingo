If a bean factory has disposable beans, they are disposed in the same order as they were created. Now if a bean has a dependency to another one this will lead to wrong disposal order. Changing the for loop in the destroySingletons method of the AbstractBeanFactory to the following solves this problem:
                // process in reverse order
                for (int i = disposableBeanNames.length-1; i >=0; i--) {