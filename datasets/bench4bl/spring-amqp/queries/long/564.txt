If a publisher callback channel detects the delegate is closed when logicalClose is called in the CachingConnectionFactory, the nacks for any pending acks are not generated.
This aspect is fixed on master by AMQP-535.
A second issue is that the "current" ack is lost if the channel is closed between setUpConfirm and basicPublish.
Since all pending confirms are nacked, the current confirm will immediately be incorrectly nacked.
This is not actually a problem - if the close is detected on the basicPublish an exception is thrown to the caller - we don't automatically create a new channel in this case - so the behavior is actually correct. If we change the behavior to create a new channel, we'd need a lot of complicated logic to transfer the pending ack to the new channel. So I am proposing we leave as-is and just backport the logicalClose fix.