Map daos keep references to mutable entities therefore they aren't truly transactional, regardless of using transactional maps. This leads to incorrect restart since the values stored in ExecutionContext don't reflect the rollback that preceded step failure.
The solution should be to clone the values before storing them, together with using the transactional collection wrappers.