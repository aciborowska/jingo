CountingInputStream/CountingOutputStream only partially synchronized