We need to inject hadoop configuration from a minicluster into an application context after cluster becomes available. This works if xml config is used, but because JavaConfig and its builder model does its job a bit earlier that xml config, we get into trouble by using config from a minicluster.
This is a corner case in unit testing and not really a problem for real application. Somehow we need to delay the stage where JavaConfig kicks the builder and wait a config to become available from a minicluster which is started by test context when unit test is run.
There are some tricks to manually start the minicluster and then pass info from there into SpringYarnConfigurerAdapter when config callback is executed. However this makes it a bit too verbose and difficult to use in every unit test.