https://groups.google.com/d/msg/hazelcast/QlSgNsVdkWE/G1FLozaPqxcJ

Test Method is:

public void testStoreId_whenNodeDown() {
        final Config config = new Config();
        final QueueConfig queueConfig = config.getQueueConfig("default");
        final IdCheckerQueueStore idCheckerQueueStore = new IdCheckerQueueStore();
        final QueueStoreConfig queueStoreConfig = new QueueStoreConfig();
        queueStoreConfig.setEnabled(true).setStoreImplementation(idCheckerQueueStore);
        queueConfig.setQueueStoreConfig(queueStoreConfig);

```
    final TestHazelcastInstanceFactory factory = createHazelcastInstanceFactory(2);
    final HazelcastInstance instance1 = factory.newHazelcastInstance(config);
    final HazelcastInstance instance2 = factory.newHazelcastInstance(config);

    final String name = generateKeyOwnedBy(instance1);
    final IQueue<Object> queue = instance2.getQueue(name);
    queue.offer(randomString());
    queue.offer(randomString());
    queue.offer(randomString());

    instance1.shutdown();

    queue.offer(randomString());

}
```

static class IdCheckerQueueStore implements QueueStore {

```
    Long lastKey;

    @Override
    public void store(final Long key, final Object value) {
        if (lastKey != null && lastKey >= key) {
            throw new RuntimeException("key[" + key + "] is already stored");
        }
        lastKey = key;
    }
```

}
