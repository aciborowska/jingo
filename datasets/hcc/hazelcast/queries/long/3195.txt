3.3-RC4-SNAPSHOT git log -1 --format="%H" 8c8fc7ec51a485a1b6a208b87065f60da652d48c

2  ec2 instances
2  members
2  clients
3m duration

txnCon.class=com.hazelcast.stabilizer.tests.map.MapTransactionContextTest
txnCon.basename=txnCon
txnCon.threadCount=3
txnCon.keyCount=1000

all worker threads hit this exception

```
Failure[
   message='Worked ran into an unhandled exception'
   type='Worker exception'
   agentAddress=10.183.40.66
   time=Thu Aug 07 12:37:01 UTC 2014
   workerAddress=client:10.183.40.66
   workerId=worker-10.183.40.66-2-client
   test=TestCase{
          id=txnCon
        , class=com.hazelcast.stabilizer.tests.map.MapTransactionContextTest
        , basename=txnCon
        , keyCount=1000
        , threadCount=3
    }
   cause=java.lang.IllegalStateException: Nested transactions are not allowed!
    at com.hazelcast.client.txn.TransactionProxy.begin(TransactionProxy.java:93)
    at com.hazelcast.client.txn.TransactionContextProxy.beginTransaction(TransactionContextProxy.java:80)
    at com.hazelcast.stabilizer.tests.map.MapTransactionContextTest$Worker.run(MapTransactionContextTest.java:68)
    at java.lang.Thread.run(Thread.java:745)
    at com.hazelcast.stabilizer.tests.utils.ThreadSpawner$DefaultThread.run(ThreadSpawner.java:88)

]
```

stdout of members and clients:  shows we are handling the expected HazelcastInstanceNotActiveException and TargetDisconnectedException,  exceptions expected when running a test where we are killing members.  Also shows verification step on member node,  showing 0 commits for 0 workers, as all the workers have died with IllegalStateException:

```
find . -name "out.log" | xargs -I % sh -c 'echo %; cat %; echo"" '
./workers/1407414866054/worker-10.183.40.66-3-server/out.log

./workers/1407414866054/worker-10.183.40.66-2-client/out.log
txnCon: com.hazelcast.core.HazelcastInstanceNotActiveException: Hazelcast instance is not active!
txnCon: com.hazelcast.core.HazelcastInstanceNotActiveException: Hazelcast instance is not active!
txnCon: com.hazelcast.spi.exception.TargetDisconnectedException: Target[Address[10.237.178.186]:5701] disconnected.

./workers/1407414866054/worker-10.237.178.186-2-client/out.log
txnCon: com.hazelcast.spi.exception.TargetDisconnectedException: Target[Address[10.237.178.186]:5701] disconnected.
txnCon: com.hazelcast.core.HazelcastInstanceNotActiveException: Hazelcast instance is not active!
txnCon: com.hazelcast.spi.exception.TargetDisconnectedException: Target[Address[10.183.40.66]:5701] disconnected.
txnCon: com.hazelcast.spi.exception.TargetDisconnectedException: Target[Address[10.183.40.66]:5701] disconnected.
txnCon: com.hazelcast.spi.exception.TargetDisconnectedException: Target[Address[10.183.40.66]:5701] disconnected.

./workers/1407414866054/worker-10.183.40.66-1-server/out.log
txnCon: TxnCounter{committed=0, rolled=0} from 0 workers
txnCon: received increments from 0 workers

./workers/1407414866054/worker-10.237.178.186-1-server/out.log
```

More Details from a client member 

```
FATAL 2014-08-07 12:37:00,740 [Thread-2] com.hazelcast.stabilizer.tests.utils.ExceptionReporter: Exception detected
java.lang.IllegalStateException: Nested transactions are not allowed!
    at com.hazelcast.client.txn.TransactionProxy.begin(TransactionProxy.java:93)
    at com.hazelcast.client.txn.TransactionContextProxy.beginTransaction(TransactionContextProxy.java:80)
    at com.hazelcast.stabilizer.tests.map.MapTransactionContextTest$Worker.run(MapTransactionContextTest.java:68)
    at java.lang.Thread.run(Thread.java:745)
    at com.hazelcast.stabilizer.tests.utils.ThreadSpawner$DefaultThread.run(ThreadSpawner.java:88)
FATAL 2014-08-07 12:37:00,757 [Thread-1] com.hazelcast.stabilizer.tests.utils.ExceptionReporter: Exception detected
java.lang.IllegalStateException: Nested transactions are not allowed!
    at com.hazelcast.client.txn.TransactionProxy.begin(TransactionProxy.java:93)
    at com.hazelcast.client.txn.TransactionContextProxy.beginTransaction(TransactionContextProxy.java:80)
    at com.hazelcast.stabilizer.tests.map.MapTransactionContextTest$Worker.run(MapTransactionContextTest.java:68)
    at java.lang.Thread.run(Thread.java:745)
    at com.hazelcast.stabilizer.tests.utils.ThreadSpawner$DefaultThread.run(ThreadSpawner.java:88)
.
..
...
WARN  2014-08-07 12:37:00,760 [hz.client_0_workers.cluster-listener] com.hazelcast.client.spi.impl.ClusterListenerThread: Error while listening cluster events! -> ClientConnection{live=false, writeHandler=com.hazelcast.client.connection.nio.ClientWriteHandler@5c14b052, readHandler=com.hazelcast.client.connection.nio.ClientReadHandler@524406b8, connectionId=1, socketChannel=DefaultSocketChannelWrapper{socketChannel=java.nio.channels.SocketChannel[closed]}, remoteEndpoint=Address[10.237.178.186]:5701}
java.nio.channels.AsynchronousCloseException
    at java.nio.channels.spi.AbstractInterruptibleChannel.end(AbstractInterruptibleChannel.java:205)
    at sun.nio.ch.SocketChannelImpl.read(SocketChannelImpl.java:412)
    at com.hazelcast.nio.tcp.DefaultSocketChannelWrapper.read(DefaultSocketChannelWrapper.java:59)
    at com.hazelcast.client.connection.nio.ClientConnection.read(ClientConnection.java:195)
    at com.hazelcast.client.spi.impl.ClusterListenerThread.listenMembershipEvents(ClusterListenerThread.java:175)
    at com.hazelcast.client.spi.impl.ClusterListenerThread.run(ClusterListenerThread.java:89)
INFO  2014-08-07 12:37:00,760 [hz.client_0_workers.cluster-listener] com.hazelcast.core.LifecycleService: HazelcastClient[hz.client_0_workers][3.3-RC4-SNAPSHOT] is CLIENT_DISCONNECTED
WARN  2014-08-07 12:37:00,773 [hz.client_0_workers.cached-1] com.hazelcast.client.connection.nio.ClientConnection: There are packets which are not processed 1
FATAL 2014-08-07 12:37:00,779 [Thread-3] com.hazelcast.stabilizer.tests.utils.ExceptionReporter: Exception detected
java.lang.IllegalStateException: Nested transactions are not allowed!
    at com.hazelcast.client.txn.TransactionProxy.begin(TransactionProxy.java:93)
    at com.hazelcast.client.txn.TransactionContextProxy.beginTransaction(TransactionContextProxy.java:80)
    at com.hazelcast.stabilizer.tests.map.MapTransactionContextTest$Worker.run(MapTransactionContextTest.java:68)
    at java.lang.Thread.run(Thread.java:745)
    at com.hazelcast.stabilizer.tests.utils.ThreadSpawner$DefaultThread.run(ThreadSpawner.java:88)
INFO  2014-08-07 12:37:01,764 [hz.client_0_workers.cluster-listener] com.hazelcast.core.LifecycleService: HazelcastClient[hz.client_0_workers][3.3-RC4-SNAPSHOT] is CLIENT_CONNECTED
```

more details from a member 

```
5701 [workers] [3.3-RC4-SNAPSHOT] Hazelcast instance is not active!
com.hazelcast.core.HazelcastInstanceNotActiveException: Hazelcast instance is not active!
    at com.hazelcast.spi.impl.BasicInvocation.engineActive(BasicInvocation.java:304)
    at com.hazelcast.spi.impl.BasicInvocation.doInvoke(BasicInvocation.java:257)
    at com.hazelcast.spi.impl.BasicInvocation.invoke(BasicInvocation.java:232)
    at com.hazelcast.spi.impl.BasicOperationService.invokeOnTarget(BasicOperationService.java:245)
    at com.hazelcast.transaction.impl.TransactionImpl.startTxBackup(TransactionImpl.java:229)
    at com.hazelcast.transaction.impl.TransactionImpl.begin(TransactionImpl.java:199)
    at com.hazelcast.transaction.impl.TransactionContextImpl.beginTransaction(TransactionContextImpl.java:78)
    at com.hazelcast.client.txn.CreateTransactionRequest.innerCall(CreateTransactionRequest.java:61)
    at com.hazelcast.client.txn.BaseTransactionRequest.call(BaseTransactionRequest.java:40)
    at com.hazelcast.client.CallableClientRequest.process(CallableClientRequest.java:27)
    at com.hazelcast.client.ClientEngineImpl$ClientPacketProcessor.processRequest(ClientEngineImpl.java:391)
    at com.hazelcast.client.ClientEngineImpl$ClientPacketProcessor.run(ClientEngineImpl.java:334)
    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
    at java.lang.Thread.run(Thread.java:745)
    at com.hazelcast.util.executor.PoolExecutorThreadFactory$ManagedThread.run(PoolExecutorThreadFactory.java:59)
WARN  2014-08-07 12:37:00,687 [hz._hzInstance_1_workers.client.thread-6] com.hazelcast.client.txn.CommitTransactionRequest: [10.237.178.186]:5701 [workers] [3.3-RC4-SNAPSHOT] Hazelcast instance is not active!
com.hazelcast.core.HazelcastInstanceNotActiveException: Hazelcast instance is not active!
    at com.hazelcast.spi.impl.BasicInvocation.engineActive(BasicInvocation.java:304)
    at com.hazelcast.spi.impl.BasicInvocation.doInvoke(BasicInvocation.java:257)
    at com.hazelcast.spi.impl.BasicInvocation.invoke(BasicInvocation.java:232)
    at com.hazelcast.spi.impl.BasicOperationService.invokeOnTarget(BasicOperationService.java:245)
    at com.hazelcast.transaction.impl.TransactionImpl.replicateTxnLog(TransactionImpl.java:271)
    at com.hazelcast.transaction.impl.TransactionImpl.prepare(TransactionImpl.java:259)
    at com.hazelcast.transaction.impl.TransactionContextImpl.commitTransaction(TransactionContextImpl.java:84)
    at com.hazelcast.client.txn.CommitTransactionRequest.innerCall(CommitTransactionRequest.java:47)
    at com.hazelcast.client.txn.BaseTransactionRequest.call(BaseTransactionRequest.java:40)
    at com.hazelcast.client.CallableClientRequest.process(CallableClientRequest.java:27)
    at com.hazelcast.client.ClientEngineImpl$ClientPacketProcessor.processRequest(ClientEngineImpl.java:391)
    at com.hazelcast.client.ClientEngineImpl$ClientPacketProcessor.run(ClientEngineImpl.java:334)
    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
    at java.lang.Thread.run(Thread.java:745)
    at com.hazelcast.util.executor.PoolExecutorThreadFactory$ManagedThread.run(PoolExecutorThreadFactory.java:59)
WARN  2014-08-07 12:37:00,718 [hz._hzInstance_1_workers.client.thread-5] com.hazelcast.transaction.impl.TransactionImpl: [10.237.178.186]:5701 [workers] [3.3-RC4-SNAPSHOT] Error during commit!
java.util.concurrent.ExecutionException: com.hazelcast.core.HazelcastInstanceNotActiveException: Hazelcast instance is not active!
    at com.hazelcast.spi.impl.BasicInvocationFuture.resolveApplicationResponseOrThrowException(BasicInvocationFuture.java:305)
    at com.hazelcast.spi.impl.BasicInvocationFuture.get(BasicInvocationFuture.java:181)
    at com.hazelcast.util.FutureUtil.executeWithDeadline(FutureUtil.java:314)
    at com.hazelcast.util.FutureUtil.waitWithDeadline(FutureUtil.java:281)
    at com.hazelcast.util.FutureUtil.waitWithDeadline(FutureUtil.java:254)
    at com.hazelcast.transaction.impl.TransactionImpl.commit(TransactionImpl.java:297)
    at com.hazelcast.transaction.impl.TransactionContextImpl.commitTransaction(TransactionContextImpl.java:86)
    at com.hazelcast.client.txn.CommitTransactionRequest.innerCall(CommitTransactionRequest.java:47)
    at com.hazelcast.client.txn.BaseTransactionRequest.call(BaseTransactionRequest.java:40)
    at com.hazelcast.client.CallableClientRequest.process(CallableClientRequest.java:27)
    at com.hazelcast.client.ClientEngineImpl$ClientPacketProcessor.processRequest(ClientEngineImpl.java:391)
    at com.hazelcast.client.ClientEngineImpl$ClientPacketProcessor.run(ClientEngineImpl.java:334)
    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
    at java.lang.Thread.run(Thread.java:745)
    at com.hazelcast.util.executor.PoolExecutorThreadFactory$ManagedThread.run(PoolExecutorThreadFactory.java:59)
Caused by: com.hazelcast.core.HazelcastInstanceNotActiveException: Hazelcast instance is not active!
    at com.hazelcast.spi.impl.BasicInvocation.engineActive(BasicInvocation.java:304)
    at com.hazelcast.spi.impl.BasicInvocation.doInvoke(BasicInvocation.java:257)
    at com.hazelcast.spi.impl.BasicInvocation.invoke(BasicInvocation.java:232)
    at com.hazelcast.spi.impl.BasicOperationService.invokeOnPartition(BasicOperationService.java:237)
    at com.hazelcast.map.tx.MapTransactionLog.commit(MapTransactionLog.java:76)
    at com.hazelcast.transaction.impl.TransactionImpl.commit(TransactionImpl.java:295)
    ... 10 more
WARN  2014-08-07 12:37:00,719 [hz._hzInstance_1_workers.client.thread-5] com.hazelcast.transaction.impl.TransactionImpl: [10.237.178.186]:5701 [workers] [3.3-RC4-SNAPSHOT] Error during commit!
java.util.concurrent.ExecutionException: com.hazelcast.core.HazelcastInstanceNotActiveException: Hazelcast instance is not active!
    at com.hazelcast.spi.impl.BasicInvocationFuture.resolveApplicationResponseOrThrowException(BasicInvocationFuture.java:305)
    at com.hazelcast.spi.impl.BasicInvocationFuture.get(BasicInvocationFuture.java:181)
    at com.hazelcast.transaction.impl.TransactionImpl.commit(TransactionImpl.java:300)
    at com.hazelcast.transaction.impl.TransactionContextImpl.commitTransaction(TransactionContextImpl.java:86)
    at com.hazelcast.client.txn.CommitTransactionRequest.innerCall(CommitTransactionRequest.java:47)
    at com.hazelcast.client.txn.BaseTransactionRequest.call(BaseTransactionRequest.java:40)
    at com.hazelcast.client.CallableClientRequest.process(CallableClientRequest.java:27)
    at com.hazelcast.client.ClientEngineImpl$ClientPacketProcessor.processRequest(ClientEngineImpl.java:391)
    at com.hazelcast.client.ClientEngineImpl$ClientPacketProcessor.run(ClientEngineImpl.java:334)
    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
    at java.lang.Thread.run(Thread.java:745)
    at com.hazelcast.util.executor.PoolExecutorThreadFactory$ManagedThread.run(PoolExecutorThreadFactory.java:59)
Caused by: com.hazelcast.core.HazelcastInstanceNotActiveException: Hazelcast instance is not active!
    at com.hazelcast.spi.impl.BasicInvocation.engineActive(BasicInvocation.java:304)
    at com.hazelcast.spi.impl.BasicInvocation.doInvoke(BasicInvocation.java:257)
    at com.hazelcast.spi.impl.BasicInvocation.invoke(BasicInvocation.java:232)
    at com.hazelcast.spi.impl.BasicOperationService.invokeOnPartition(BasicOperationService.java:237)
    at com.hazelcast.map.tx.MapTransactionLog.commit(MapTransactionLog.java:76)
    at com.hazelcast.transaction.impl.TransactionImpl.commit(TransactionImpl.java:295)
    ... 10 more
INFO  2014-08-07 12:37:00,750 [hz.ShutdownThread] com.hazelcast.nio.tcp.TcpIpConnection: [10.237.178.186]:5701 [workers] [3.3-RC4-SNAPSHOT] Connection [Address[10.183.40.66]:46396] lost. Reason: Socket explicitly closed
INFO  2014-08-07 12:37:00,753 [hz._hzInstance_1_workers.IO.thread-in-1] com.hazelcast.nio.tcp.TcpIpConnection: [10.237.178.186]:5701 [workers] [3.3-RC4-SNAPSHOT] Connection [Address[10.183.40.66]:46395] lost. Reason: java.io.EOFException[Remote socket closed!]
INFO  2014-08-07 12:37:00,767 [hz.ShutdownThread] com.hazelcast.nio.tcp.TcpIpConnection: [10.237.178.186]:5701 [workers] [3.3-RC4-SNAPSHOT] Connection [Address[10.237.178.186]:48242] lost. Reason: Socket explicitly closed
WARN  2014-08-07 12:37:00,767 [hz.ShutdownThread] com.hazelcast.transaction.impl.TransactionImpl: [10.237.178.186]:5701 [workers] [3.3-RC4-SNAPSHOT] Error during rollback!
java.util.concurrent.ExecutionException: com.hazelcast.core.HazelcastInstanceNotActiveException: Hazelcast instance is not active!
    at com.hazelcast.spi.impl.BasicInvocationFuture.resolveApplicationResponseOrThrowException(BasicInvocationFuture.java:305)
    at com.hazelcast.spi.impl.BasicInvocationFuture.get(BasicInvocationFuture.java:181)
    at com.hazelcast.util.FutureUtil.executeWithDeadline(FutureUtil.java:314)
    at com.hazelcast.util.FutureUtil.waitWithDeadline(FutureUtil.java:281)
    at com.hazelcast.util.FutureUtil.waitWithDeadline(FutureUtil.java:254)
    at com.hazelcast.transaction.impl.TransactionImpl.rollback(TransactionImpl.java:340)
    at com.hazelcast.transaction.impl.TransactionContextImpl.rollbackTransaction(TransactionContextImpl.java:91)
    at com.hazelcast.client.ClientEndpoint.destroy(ClientEndpoint.java:227)
    at com.hazelcast.client.ClientEngineImpl.shutdown(ClientEngineImpl.java:283)
    at com.hazelcast.spi.impl.ServiceManager.shutdownService(ServiceManager.java:224)
    at com.hazelcast.spi.impl.ServiceManager.shutdown(ServiceManager.java:215)
    at com.hazelcast.spi.impl.NodeEngineImpl.shutdown(NodeEngineImpl.java:388)
    at com.hazelcast.instance.Node.shutdown(Node.java:420)
    at com.hazelcast.instance.Node$NodeShutdownHookThread.run(Node.java:511)
Caused by: com.hazelcast.core.HazelcastInstanceNotActiveException: Hazelcast instance is not active!
    at com.hazelcast.spi.impl.BasicInvocation.engineActive(BasicInvocation.java:304)
    at com.hazelcast.spi.impl.BasicInvocation.doInvoke(BasicInvocation.java:257)
    at com.hazelcast.spi.impl.BasicInvocation.invoke(BasicInvocation.java:232)
    at com.hazelcast.spi.impl.BasicOperationService.invokeOnPartition(BasicOperationService.java:237)
    at com.hazelcast.map.tx.MapTransactionLog.rollback(MapTransactionLog.java:87)
    at com.hazelcast.transaction.impl.TransactionImpl.rollback(TransactionImpl.java:338)
    ... 8 more
```
