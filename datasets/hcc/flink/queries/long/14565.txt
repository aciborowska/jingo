Currently, we start SystemResourcesCounter when initialize (JM|TM)MetricGroup. This thread doesn't exit on (JM|TM)MetricGroup closed and even there is not exit logic of them.

It possibly causes thread leak. For example, on our platform which supports previewing sample SQL execution, it starts a MiniCluster in the same process as the platform. When the preview job finished MiniCluster closed and also (JM|TM)MetricGroup. However these SystemResourcesCounter threads remain.

I propose when creating SystemResourcesCounter, track it in (JM|TM)MetricGroup, and on (JM|TM)MetricGroup closed, shutdown SystemResourcesCounter. This way, we survive from thread leaks.

CC Chesnay Schepler Till Rohrmann