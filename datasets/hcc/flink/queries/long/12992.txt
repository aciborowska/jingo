We are using flink streming application with cassandra connector providing sinks that writes data into a Apache Cassandra database. 

At first we found the following exceptions：All host(s) tried for query failed (tried com.datastax.driver.core.exceptions.TransportException: Error writing...). This exception will cause the streaming job to fail

 

And we have carefully checked that Cassandra service and network are all normal. Finally, we refer to the source code of DataStax Java Driver that the connector depends on. We found that the real exception caused the problem is as follows:

com.datastax.shaded.netty.handler.codec.EncoderException: java.lang.IllegalAccessError: com/datastax/driver/core/Frame at com.datastax.shaded.netty.handler.codec.MessageToMessageEncoder.write(MessageToMessageEncoder.java:107) at com.datastax.shaded.netty.channel.AbstractChannelHandlerContext.invokeWrite(AbstractChannelHandlerContext.java:643) at com.datastax.shaded.netty.channel.AbstractChannelHandlerContext.write(AbstractChannelHandlerContext.java:700) at com.datastax.shaded.netty.channel.AbstractChannelHandlerContext.write(AbstractChannelHandlerContext.java:636) at com.datastax.shaded.netty.handler.codec.MessageToMessageEncoder.write(MessageToMessageEncoder.java:112) at com.datastax.shaded.netty.channel.AbstractChannelHandlerContext.invokeWrite(AbstractChannelHandlerContext.java:643) at com.datastax.shaded.netty.channel.AbstractChannelHandlerContext.write(AbstractChannelHandlerContext.java:700) at com.datastax.shaded.netty.channel.AbstractChannelHandlerContext.write(AbstractChannelHandlerContext.java:636) at com.datastax.shaded.netty.handler.timeout.IdleStateHandler.write(IdleStateHandler.java:284) at com.datastax.shaded.netty.channel.AbstractChannelHandlerContext.invokeWrite(AbstractChannelHandlerContext.java:643) at com.datastax.shaded.netty.channel.AbstractChannelHandlerContext.write(AbstractChannelHandlerContext.java:700) at com.datastax.shaded.netty.channel.AbstractChannelHandlerContext.write(AbstractChannelHandlerContext.java:636) at com.datastax.shaded.netty.channel.AbstractChannelHandlerContext.write(AbstractChannelHandlerContext.java:622) at com.datastax.shaded.netty.channel.DefaultChannelPipeline.write(DefaultChannelPipeline.java:939) at com.datastax.shaded.netty.channel.AbstractChannel.write(AbstractChannel.java:234) at com.datastax.driver.core.Connection$Flusher.run(Connection.java:872) at com.datastax.shaded.netty.util.concurrent.SingleThreadEventExecutor.runAllTasks(SingleThreadEventExecutor.java:358) at com.datastax.shaded.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:357) at com.datastax.shaded.netty.util.concurrent.SingleThreadEventExecutor$2.run(SingleThreadEventExecutor.java:112) at java.lang.Thread.run(Thread.java:748) Caused by: java.lang.IllegalAccessError: com/datastax/driver/core/Frame at com.datastax.shaded.netty.util.internal._matchers_.com.datastax.driver.core.FrameMatcher.match(NoOpTypeParameterMatcher.java) at com.datastax.shaded.netty.handler.codec.MessageToMessageEncoder.acceptOutboundMessage(MessageToMessageEncoder.java:77) at com.datastax.shaded.netty.handler.codec.MessageToMessageEncoder.write(MessageToMessageEncoder.java:84)

 

Based on this exception, we found relevant information https://datastax-oss.atlassian.net/browse/JAVA-1337?page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel  

 

Because I found that the latest version of flink-cassandra-connector uses the datastax Java driver old version 3.0.0.Perhaps we should upgrade the version on which the connector depends to Java driver 3.3.0+ to avoid this problem.