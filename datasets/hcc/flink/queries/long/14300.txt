In the StreamTask#invoke method if an exception occurs during the allocation of the operatorChain class, the exception handling fails to cleanup the threads allocated as StreamTask#recordWriters. This causes threads to leak as flink attempts to continually restart and fail for the same cause.

 

An example cause is a deserialization issue on a custom operator from a checkpoint.

 

Attached is a suggested fix for the master branch.