The checkpoint messages (AbstractCheckpointMessage) don't implement the RequiresLeaderSessionID interface. Thus, they are not scoped to the leadership of a JobManager and can interfere with a new leader session.

The downside of scoping the checkpoint messages to the leader id is that messages might get filtered out leading to resource leaks because the contained state handle is never discarded. However, in case of a JM failure one might end up in the same situation if there were some checkpoint messages in flight.

In order to mitigate the problem one could change the behaviour such that the CheckpointResponder awaits a response back and in case of a negative response or an outstanding response (timeout) it discards the state handle.