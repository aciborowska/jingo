If the created Elastic Search Rest High Level Client(rhlClient) is unreachable, Current code throws RuntimeException. But, it doesn't close the client which causes thread leak.

 

Current Code

if (!rhlClient.ping()) {

     throw new RuntimeException("There are no reachable Elasticsearch nodes!");

}

 

Change Needed

rhlClient needs to be closed.

 

Steps to Reproduce

1. Add the ElasticSearch Sink to the stream. Start the Flink program without starting the ElasticSearch. 

2. Program will give error: "Too many open files" and it doesn't write even though you start the Elastic Search later.

 