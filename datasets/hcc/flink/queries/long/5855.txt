
    handlePendingFilesForPreviousCheckpoints(restoredState.pendingFilesPerCheckpoint);

    synchronized (restoredState.pendingFilesPerCheckpoint) {
      restoredState.pendingFilesPerCheckpoint.clear();



Lock on pendingFilesPerCheckpoint should be obtained prior to the call to handlePendingFilesForPreviousCheckpoints().

After discussion. I would give a related jira from this issue. https://issues.apache.org/jira/browse/FLINK-6381