Currently, HadoopRecoverableFsDataOutputStream#waitUntilLeaseIsRevoked method is not support ViewFileSystem

 

and it will cause the same issue fail to recover after taskmanager failure

 

 

I try to resolve the real path and FileSystem of ViewFileSystem  and it works


if (fs instanceof ViewFileSystem) {
   ViewFileSystem vfs = (ViewFileSystem) fs;
   Path resolvePath = vfs.resolvePath(path);
   DistributedFileSystem dfs = (DistributedFileSystem) resolvePath.getFileSystem(fs.getConf());
   return waitUntilLeaseIsRevoked(dfs, resolvePath);
}


 