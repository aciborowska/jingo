This bug might happen when we call below method


FsCheckpointStreamFactory.FsCheckpointStateOutputStream#write(byte[] , int , int)



If the bytes array to write occupied the size between [writeBuffer.size/2, fileStateThreshold) , it will actually flush to a file and return as FileStateHandle. However, we hope the returned result as a ByteStreamStateHandle.