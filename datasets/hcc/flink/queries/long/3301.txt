Here is related code:

  public void restoreState(SerializedCheckpointData[] state) throws Exception {
    synchronized (pendingCheckpoints) {
      pendingCheckpoints = SerializedCheckpointData.toDeque(state, idSerializer);


When lock is held on current pendingCheckpoints field, new reference is assigned to the same field - making the synchronization ineffective.