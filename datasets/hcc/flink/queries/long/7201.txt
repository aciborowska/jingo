
 java.util.ConcurrentModificationException: null
 	at java.util.HashMap$HashIterator.nextEntry(HashMap.java:922)
 	at java.util.HashMap$ValueIterator.next(HashMap.java:950)
 	at org.apache.flink.runtime.resourcemanager.JobLeaderIdService.clear(JobLeaderIdService.java:114)
 	at org.apache.flink.runtime.resourcemanager.JobLeaderIdService.stop(JobLeaderIdService.java:92)
 	at org.apache.flink.runtime.resourcemanager.ResourceManager.shutDown(ResourceManager.java:200)
 	at org.apache.flink.runtime.resourcemanager.ResourceManagerRunner.shutDownInternally(ResourceManagerRunner.java:102)
 	at org.apache.flink.runtime.resourcemanager.ResourceManagerRunner.shutDown(ResourceManagerRunner.java:97)
 	at org.apache.flink.runtime.minicluster.MiniCluster.shutdownInternally(MiniCluster.java:329)
 	at org.apache.flink.runtime.minicluster.MiniCluster.shutdown(MiniCluster.java:297)
 	at org.apache.flink.runtime.minicluster.MiniClusterITCase.runJobWithMultipleJobManagers(MiniClusterITCase.java:85)





Because the jobLeaderIdService stops before the rpcService when shutdown the resourceManager, jobLeaderIdService has a risk of thread-unsafe.