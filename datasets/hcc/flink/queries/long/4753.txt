The PeriodicOffsetCommitter doesn't synchronize on the checkpoint lock when creating a copy of the partition offsets in the current state.

I propose to pass the checkpoint lock into{{PeriodicOffsetCommitter}}, and  let PeriodicOffsetCommitter use Kafka08Fetcher#snapshotCurrentState() to make the current state copy.