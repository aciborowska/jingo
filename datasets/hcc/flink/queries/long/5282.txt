
      CheckpointStreamFactory.CheckpointStateOutputStream keyedStateOut =
          checkpointStreamFactory.createCheckpointStateOutputStream(checkpointID, 0L);

      final long offset = keyedStateOut.getPos();


If getPos() throws exception, keyedStateOut would be left unclosed.