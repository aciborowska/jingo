Here is related code:

              } finally {
                inProgress.remove(jobId);
              }


A little lower, in another finally block, there is:

          synchronized (lock) {
            if (!success) {
              inProgress.remove(jobId);


which is correct.