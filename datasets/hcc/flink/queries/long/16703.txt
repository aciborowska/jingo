As part of FLINK-11551, the state machine of AkkaRpcActor has been updated to include 'terminating' and 'terminated' states. However, when actor termination request is handled, the resulting 'terminating' state is not updated by the FSM.

https://github.com/apache/flink/blame/master/flink-runtime/src/main/java/org/apache/flink/runtime/rpc/akka/AkkaRpcActor.java#L175

As a side-effect, isRunning() predicate can return that the actor is still running after terminate was initiated and to still handle messages.

I believe the fix is trivial and the private fieldÂ state should be updated with the return value of the call to state.terminate().

Feel free to adjust the priority accordingly.