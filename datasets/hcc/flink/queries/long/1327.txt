The calls to ByteBuffer#limit(int) and ByteBuffer#position(int) are in the wrong order. The positioning fails if the old limit is smaller than the new position.