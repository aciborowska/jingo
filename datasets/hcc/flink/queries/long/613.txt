I encountered the problem of negative cumulative costs for a plan which contained branched nodes. The problem is that the costs for branched nodes are not correctly calculated if one branched node x is contained in a cycle of another branched node y. Assuming that y is closed first, then closing of x will calculate too high double counted costs. To illustrate this case consider the following flow:

<pre>
     A ---- D
   /  \   /  \
SRC     \   SINK
   \  /   \  /
     B ---- C
</pre>
Assuming that the costs of all nodes except for SRC is 0 and the cost of SRC is 1, then SINK should have cumulative costs of 1 at the end. But executing the algorithm will calculate the following sequence.

SRC = 1
A = SRC = 1
B = SRC = 1
D = A + B - SRC (as a joined branching node) = 1
C = A + B - SRC = 1
SINK = D + C - A (as a joined branching node) - B (as a joined branching node) = 0

Thus the problem originates from a wrong accounting of branching nodes. A possible solution for this problem could be to split the predecessor costs according to the out degree of the predecessor node. By doing this, we wouldn't need to subtract double counted costs. But I'm not aware of any side effects this could have....

---------------- Imported from GitHub ----------------
Url: https://github.com/stratosphere/stratosphere/issues/613
Created by: tillrohrmann
Labels: bug, optimizer, 
Created at: Wed Mar 19 18:53:44 CET 2014
State: closed