Here is related code:

  public T getState(ClassLoader classLoader) throws Exception {
    FSDataInputStream inStream = getFileSystem().open(getFilePath());
    ObjectInputStream ois = new InstantiationUtil.ClassLoaderObjectInputStream(inStream, classLoader);
    return (T) ois.readObject();


ObjectInputStream should be closed upon exit from the method