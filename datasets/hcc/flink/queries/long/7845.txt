We had some problems with Flink and Netty so we wrote a small unit test to reproduce the memory issues we have in production. It happens that we have to restart the Flink cluster because the memory is always increasing from job to job. 
The github project is https://github.com/okkam-it/flink-memory-leak and the JUnit test is contained in the MemoryLeakTest class (within src/main/test).
I don't know if this is the root of our problems but at some point, usually around the 28th loop, the job fails with the following exception (actually we never faced that in production but maybe is related to the memory issue somehow...):



Caused by: java.lang.IllegalAccessError: org/apache/flink/runtime/io/network/netty/NettyMessage
	at io.netty.util.internal.__matchers__.org.apache.flink.runtime.io.network.netty.NettyMessageMatcher.match(NoOpTypeParameterMatcher.java)
	at io.netty.channel.SimpleChannelInboundHandler.acceptInboundMessage(SimpleChannelInboundHandler.java:95)
	at io.netty.channel.SimpleChannelInboundHandler.channelRead(SimpleChannelInboundHandler.java:102)
	... 16 more


