I use the flink in yarn cluster of version 1.2.0.  The HA is configured in flink-conf.yaml.The configurations are :
high-availability: zookeeper
high-availability.zookeeper.quorum: 100.106.40.102:2181,100.106.57.136:2181,100.106.41.233:2181
high-availability.zookeeper.storageDir: hdfs:/flink
high-availability.zookeeper.client.acl: open
high-availability.zookeeper.path.root:  flink0308
zookeeper.sasl.disable: true

The ZK version is 3.5.1.When one of ZK server node is down, the Flink client、JM、TM occur a following warning:
2017-03-22 10:14:06,196 INFO  org.apache.zookeeper.ClientCnxn                               - Opening socket connection to server 100.106.57.136/100.106.57.136:2181
2017-03-22 10:14:06,196 INFO  org.apache.zookeeper.ClientCnxn                               - Opening socket connection to server 100.106.57.136/100.106.57.136:2181
2017-03-22 10:14:06,197 WARN  org.apache.zookeeper.ClientCnxn                               - Session 0x0 for server null, unexpected error, closing socket connection and attempting reconnect
java.net.ConnectException: Connection refused
        at sun.nio.ch.SocketChannelImpl.checkConnect(Native Method)
        at sun.nio.ch.SocketChannelImpl.finishConnect(SocketChannelImpl.java:717)
        at org.apache.zookeeper.ClientCnxnSocketNIO.doTransport(ClientCnxnSocketNIO.java:364)
        at org.apache.zookeeper.ClientCnxn$SendThread.run(ClientCnxn.java:1426)

It seems the message is sent to the ZK server before the session is established.



