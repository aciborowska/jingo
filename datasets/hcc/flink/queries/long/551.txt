By accident, I grouped by a tuple field with type `Double`. The following exception occurs when trying to `groupBy()` by a Double field and using a `reduceGroup()` afterwards:

<code>java.lang.Exception: The data preparation for task 'Reduce(eu.stratosphere.example.java.relational.TPCHQuery1$1)' , caused an error: Error obtaining the sorted input: Thread 'SortMerger Reading Thread' terminated due to an exception: null
	at eu.stratosphere.pact.runtime.task.RegularPactTask.run(RegularPactTask.java:481)
	at eu.stratosphere.pact.runtime.task.RegularPactTask.invoke(RegularPactTask.java:374)
	at eu.stratosphere.nephele.execution.RuntimeEnvironment.run(RuntimeEnvironment.java:345)
	at java.lang.Thread.run(Thread.java:744)
Caused by: java.lang.RuntimeException: Error obtaining the sorted input: Thread 'SortMerger Reading Thread' terminated due to an exception: null
	at eu.stratosphere.pact.runtime.sort.UnilateralSortMerger.getIterator(UnilateralSortMerger.java:635)
	at eu.stratosphere.pact.runtime.task.RegularPactTask.getInput(RegularPactTask.java:1113)
	at eu.stratosphere.pact.runtime.task.ReduceDriver.prepare(ReduceDriver.java:86)
	at eu.stratosphere.pact.runtime.task.RegularPactTask.run(RegularPactTask.java:476)
	... 3 more
Caused by: java.io.IOException: Thread 'SortMerger Reading Thread' terminated due to an exception: null
	at eu.stratosphere.pact.runtime.sort.UnilateralSortMerger$ThreadBase.run(UnilateralSortMerger.java:826)
Caused by: java.lang.UnsupportedOperationException
	at eu.stratosphere.api.common.typeutils.base.DoubleComparator.putNormalizedKey(DoubleComparator.java:58)
	at eu.stratosphere.api.common.typeutils.base.DoubleComparator.putNormalizedKey(DoubleComparator.java:1)
	at eu.stratosphere.api.java.typeutils.runtime.TupleSingleFieldComparator.putNormalizedKey(TupleSingleFieldComparator.java:101)
	at eu.stratosphere.api.java.typeutils.runtime.TupleSingleFieldComparator.putNormalizedKey(TupleSingleFieldComparator.java:1)
	at eu.stratosphere.api.java.typeutils.runtime.ReferenceWrappedComparator.putNormalizedKey(ReferenceWrappedComparator.java:93)
	at eu.stratosphere.api.java.typeutils.runtime.ReferenceWrappedComparator.putNormalizedKey(ReferenceWrappedComparator.java:1)
	at eu.stratosphere.pact.runtime.sort.NormalizedKeySorter.write(NormalizedKeySorter.java:269)
	at eu.stratosphere.pact.runtime.sort.UnilateralSortMerger$ReadingThread.go(UnilateralSortMerger.java:1056)
	at eu.stratosphere.pact.runtime.sort.UnilateralSortMerger$ThreadBase.run(UnilateralSortMerger.java:822)</code>

I don't know if grouping over a double key makes much sense but anyway the exception is not user friendly and should be improved.

---------------- Imported from GitHub ----------------
Url: https://github.com/stratosphere/stratosphere/issues/551
Created by: twalthr
Labels: bug, java api, 
Created at: Mon Mar 10 14:34:23 CET 2014
State: closed