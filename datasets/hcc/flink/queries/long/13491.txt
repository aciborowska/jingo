This is the same issue as for ContinousFileReaderOperator in https://issues.apache.org/jira/browse/FLINK-13376. AsyncWaitOperator will propagate endInput notification immediately, even if it has some records buffered.

Side note, this also shows that the current BoundedOneInput#endInput API is easy to mishandle if an operator buffers some records internally. Maybe we could redesign this API somehow Aljoscha Krettek Haibo Sun?