The SafetyNetCloseableRegistry is closed to early in triggerCheckpointBarrier(...). Right now, it seems like the code assumes that statefulTask.triggerCheckpoint(...) is blocking - which it is not. Like this, the registry can be closed while the checkpoint is still running.