When running a job with a DeltaIteration that uses a keyless reducer on a cluster, the jobs fails with the following Exception:

    Exception in thread "main" eu.stratosphere.compiler.CompilerException: An error occurred while translating the optimized plan to a nephele JobGraph: Error: All functions that are part of an iteration must have the same degree-of-parallelism as that iteration.
	at eu.stratosphere.compiler.plantranslate.NepheleJobGraphGenerator.postVisit(NepheleJobGraphGenerator.java:563)
	at eu.stratosphere.compiler.plantranslate.NepheleJobGraphGenerator.postVisit(NepheleJobGraphGenerator.java:95)
	at eu.stratosphere.compiler.plan.DualInputPlanNode.accept(DualInputPlanNode.java:218)
	at eu.stratosphere.compiler.plan.SingleInputPlanNode.accept(SingleInputPlanNode.java:137)
	at eu.stratosphere.compiler.plan.SingleInputPlanNode.accept(SingleInputPlanNode.java:137)
	at eu.stratosphere.compiler.plan.NAryUnionPlanNode.accept(NAryUnionPlanNode.java:48)
	at eu.stratosphere.compiler.plan.SingleInputPlanNode.accept(SingleInputPlanNode.java:137)
	at eu.stratosphere.compiler.plan.DualInputPlanNode.accept(DualInputPlanNode.java:216)
	at eu.stratosphere.compiler.plan.DualInputPlanNode.accept(DualInputPlanNode.java:216)
	at eu.stratosphere.compiler.plan.DualInputPlanNode.accept(DualInputPlanNode.java:216)
	at eu.stratosphere.compiler.plan.DualInputPlanNode.accept(DualInputPlanNode.java:216)
	at eu.stratosphere.compiler.plan.SingleInputPlanNode.accept(SingleInputPlanNode.java:137)
	at eu.stratosphere.compiler.plan.DualInputPlanNode.accept(DualInputPlanNode.java:217)
	at eu.stratosphere.compiler.plan.SingleInputPlanNode.accept(SingleInputPlanNode.java:137)
	at eu.stratosphere.compiler.plan.OptimizedPlan.accept(OptimizedPlan.java:159)
	at eu.stratosphere.compiler.plantranslate.NepheleJobGraphGenerator.compileJobGraph(NepheleJobGraphGenerator.java:164)
	at eu.stratosphere.client.program.Client.getJobGraph(Client.java:202)
	at eu.stratosphere.client.program.Client.run(Client.java:281)
	at eu.stratosphere.client.program.Client.run(Client.java:250)
	at eu.stratosphere.client.CliFrontend.run(CliFrontend.java:304)
	at eu.stratosphere.client.CliFrontend.parseParameters(CliFrontend.java:773)
	at eu.stratosphere.client.CliFrontend.main(CliFrontend.java:796)
    Caused by: eu.stratosphere.compiler.CompilerException: Error: All functions that are part of an iteration must have the same degree-of-parallelism as that iteration.
	at eu.stratosphere.compiler.plantranslate.NepheleJobGraphGenerator.preVisit(NepheleJobGraphGenerator.java:341)
	at eu.stratosphere.compiler.plantranslate.NepheleJobGraphGenerator.preVisit(NepheleJobGraphGenerator.java:95)
	at eu.stratosphere.compiler.plan.SingleInputPlanNode.accept(SingleInputPlanNode.java:136)
	at eu.stratosphere.compiler.plan.DualInputPlanNode.accept(DualInputPlanNode.java:216)
	at eu.stratosphere.compiler.plan.SingleInputPlanNode.accept(SingleInputPlanNode.java:137)
	at eu.stratosphere.compiler.plan.SingleInputPlanNode.accept(SingleInputPlanNode.java:137)
	at eu.stratosphere.compiler.plan.WorksetIterationPlanNode.acceptForStepFunction(WorksetIterationPlanNode.java:177)
	at eu.stratosphere.compiler.plantranslate.NepheleJobGraphGenerator.postVisit(NepheleJobGraphGenerator.java:388)
	... 21 more

A special DOP is not set.

There's already a testcase for this issue ((#280 | FLINK-280)) but no fix available.

---------------- Imported from GitHub ----------------
Url: https://github.com/stratosphere/stratosphere/issues/450
Created by: twalthr
Labels: bug, 
Created at: Thu Jan 30 14:12:35 CET 2014
State: closed