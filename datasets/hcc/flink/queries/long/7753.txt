Unexpected errors in the server pipeline correctly cause a 500 error response.   I suggest that such responses also close the channel rather than allowing keep-alive.   This would be a better security posture too since we don't know if the pipeline is corrupt following an unexpected error.