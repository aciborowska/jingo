An exception was thrown when using KafkaAvroTableSource as follows:

Exception in thread "main" org.apache.flink.table.api.TableException: TableSource of type org.apache.flink.streaming.connectors.kafka.Kafka011AvroTableSource returned a DataStream of type GenericType<org.apache.flink.types.Row> that does not match with the type Row(id: Integer, name: String, age: Integer, event: GenericType<java.util.Map>) declared by the TableSource.getReturnType() method. Please validate the implementation of the TableSource.
 at org.apache.flink.table.plan.nodes.datastream.StreamTableSourceScan.translateToPlan(StreamTableSourceScan.scala:100)
 at org.apache.flink.table.api.StreamTableEnvironment.translateToCRow(StreamTableEnvironment.scala:885)
 at org.apache.flink.table.api.StreamTableEnvironment.translate(StreamTableEnvironment.scala:812)
 at org.apache.flink.table.api.StreamTableEnvironment.writeToSink(StreamTableEnvironment.scala:279)
 at org.apache.flink.table.api.Table.writeToSink(table.scala:862)
 at org.apache.flink.table.api.Table.writeToSink(table.scala:830)
 at org.apache.flink.quickstart.StreamingJobAvro.main(StreamingJobAvro.java:85)

 

It is caused by a discrepancy between the type returned by the TableSource and the type returned by the DataStream. I've already fixed it, would someone please review the patch and see if it could be merged.

 