PackagedProgram#getPreviewPlan contains code as below



if (isUsingProgramEntryPoint()) {
    previewPlan = Optimizer.createPreOptimizedPlan(getPlan());
} else if (isUsingInteractiveMode()) {
    // ...
    getPlan().getJobId();
    // ....
}



when the latter #getPlan executed, it will finally execute program.getPlan(options) where program equals null.

To solve this problem, we can replace getPlan with env.getPlan. Where env is an instance of PreviewPlanEnvironment