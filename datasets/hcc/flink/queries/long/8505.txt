The SlotManager can reach an inconsistent state when a formerly free task slot is reported as allocated by an incoming SlotReport. The problem is that the slot won't be removed from the set of free slots and, thus, will be considered for future slot requests.

The solution is to remove the slot from the set of free slots once it is reported allocated.

 

https://travis-ci.org/tillrohrmann/flink/jobs/332871241