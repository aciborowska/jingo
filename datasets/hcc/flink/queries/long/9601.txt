In short, the problem is that we reuse the `snaphotData` as the output array when partitioning the input data, but the `snapshotData` is max length is `1 << 30`. So when the records in `CopyOnWriteStateTable` is more than `1 << 30` (e.g. 1 <<30 + 1), then the check `Preconditions.checkState(partitioningDestination.length >= numberOfElements);` could be failed.