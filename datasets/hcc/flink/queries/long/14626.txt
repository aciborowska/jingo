Currently, the yarn application classpath is placed behind Flink classpath (including user jars), which will cause conflict if the user jar accidentally included hadoop dependencies.


// org.apache.flink.yarn.Utils#setupYarnClassPath
public static void setupYarnClassPath(Configuration conf, Map<String, String> appMasterEnv) {
   addToEnvironment(
      appMasterEnv,
      Environment.CLASSPATH.name(),
      appMasterEnv.get(ENV_FLINK_CLASSPATH));
   String[] applicationClassPathEntries = conf.getStrings(
      YarnConfiguration.YARN_APPLICATION_CLASSPATH,
      YarnConfiguration.DEFAULT_YARN_APPLICATION_CLASSPATH);
   for (String c : applicationClassPathEntries) {
      addToEnvironment(appMasterEnv, Environment.CLASSPATH.name(), c.trim());
   }
}


Maybe we should place the user jars behind yarn application classpath when `org.apache.flink.yarn.configuration.YarnConfigOptions.UserJarInclusion` is set to LAST, like this "flink-xxx.jar:hadoop-xxx.jar:user-xxx.jar".

Â 