Hi, I want to use window aggregate after create temporary, and has multiple sinks. But throw exception:



java.lang.AssertionError: type mismatch:
ref:
TIME ATTRIBUTE(PROCTIME) NOT NULL
input:
TIMESTAMP(3) NOT NULL



I look into the optimizer logic, there is comment at CommonSubGraphBasedOptimizer:
"1. In general, for multi-sinks users tend to use VIEW which is a natural common sub-graph."

After sub graph optimize, time attribute from source have been convert to basic TIMESTAMP type according to FlinkRelTimeIndicatorProgram. But my create view sql is simple query, I think didn't need to materialized time attribute in theory.

Here is my code:



// connector.type COLLECTION is for debug use
tableEnv.sqlUpdate("CREATE TABLE source (\n" +
	"    `ts` AS PROCTIME(),\n" +
	"    `order_type` INT\n" +
	") WITH (\n" +
	"    'connector.type' = 'COLLECTION',\n" +
	"    'format.type' = 'json'\n" +
	")\n");
tableEnv.createTemporaryView("source_view", tableEnv.sqlQuery("SELECT * FROM source"));
tableEnv.sqlUpdate("CREATE TABLE sink (\n" +
	"    `result` BIGINT\n" +
	") WITH (\n" +
	"    'connector.type' = 'COLLECTION',\n" +
	"    'format.type' = 'json'\n" +
	")\n");
tableEnv.sqlUpdate("INSERT INTO sink \n" +
	"SELECT\n" +
	"    COUNT(1)\n" +
	"FROM\n" +
	"    `source_view`\n" +
	"WHERE\n" +
	"     `order_type` = 33\n" +
	"GROUP BY\n" +
	"    TUMBLE(`ts`, INTERVAL '5' SECOND)\n");
tableEnv.sqlUpdate("INSERT INTO sink \n" +
	"SELECT\n" +
	"    COUNT(1)\n" +
	"FROM\n" +
	"    `source_view`\n" +
	"WHERE\n" +
	"     `order_type` = 34\n" +
	"GROUP BY\n" +
	"    TUMBLE(`ts`, INTERVAL '5' SECOND)\n");



