Currently state partitioning is only available for one-input stream operators and even for those, the partitioning will only depend on the first input.

This happens because the keyselector used to extract the partitioning key from each element is used from the first input stream. We need to make sure that for each input stream the corresponding key selector is used.

To do this, ctx.nextRecord(record), should be extended by adding a parameter denoting the index of the input channel which can be used by the partitioner to select the appropriate key selector.

The same mechanics can be extended to allow state partitioning for TwoInput stream operators as well.