The YarnResourceManager registers callbacks at a AMRMClientAsync which it uses to react to Yarn container allocations. These callbacks (e.g. onContainersAllocated modify the internal state of the YarnResourceManager. This can lead to race conditions with the requestYarnContainer method.

In order to solve this problem we have to execute the state changing operations in the main thread of the YarnResourceManager.