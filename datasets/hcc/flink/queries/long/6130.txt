In YarnFlinkApplicationMasterRunner#runApplicationMaster() :

      synchronized (lock) {
        LOG.info("Starting High Availability Services");
...
      }

      // wait for resource manager to finish
      resourceManager.getTerminationFuture().get();



resourceManager#getTerminationFuture() is called without holding lock.

We should store the value returned from resourceManager#getTerminationFuture() inside the synchronized block.