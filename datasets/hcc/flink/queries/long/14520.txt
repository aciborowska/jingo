Description

Flink can't find JSON table factory. JsonRowFormatFactory is considered but won't match properties.

 

gist with code and error: https://gist.github.com/mserranom/4b2e0088b6000b892c38bd7f93d4fe73

Attached is a zip file for reproduction.

 

Error message excerpt


rg.apache.flink.table.api.TableException: findAndCreateTableSink failed.
        at org.apache.flink.table.factories.TableFactoryUtil.findAndCreateTableSink(TableFactoryUtil.java:87)
        at org.apache.flink.table.factories.TableFactoryUtil.findAndCreateTableSink(TableFactoryUtil.java:77)

...

Caused by: org.apache.flink.table.api.NoMatchingTableFactoryException: Could not find a suitable table factory for 'org.apache.flink.table.factories.TableSinkFactory' in
the classpath.

...

The following properties are requested:

connector.path=file://./data.json
connector.property-version=1
connector.type=filesystem
format.derive-schema=true
format.fail-on-missing-field=false
format.property-version=1
format.type=json
schema.0.name=f0
schema.0.type=BIGINT
update-mode=append

...

The following factories have been considered:
org.apache.flink.formats.json.JsonRowFormatFactory
org.apache.flink.table.sources.CsvBatchTableSourceFactory

...


Code


StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();
EnvironmentSettings settings =
        EnvironmentSettings.newInstance().useOldPlanner().inStreamingMode().build();
StreamTableEnvironment tableEnv = StreamTableEnvironment.create(env, settings);    DataStreamSource<Long> stream = env.fromElements(1L, 21L, 22L);    
Table table = tableEnv.fromDataStream(stream);
    tableEnv.registerTable("data", table);    tableEnv
        .connect(new FileSystem().path("file://./data.json"))
        .withSchema(new Schema().field("f0", Types.LONG))
        .withFormat(new Json().failOnMissingField(false).deriveSchema())
        .inAppendMode()
        .registerTableSink("sink");    
env.execute();


 