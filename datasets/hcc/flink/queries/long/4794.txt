partition_by_hash() crashes if no parameter is provided.
Looks like a line of code was missed, check distinct()


def distinct(self, *fields): 
        f = None 
        if len(fields) == 0: 
            f = lambda x: (x,) 
            fields = (0,) 

