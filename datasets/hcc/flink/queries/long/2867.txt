In RollingSink#restoreState():

    Set<Long> pastCheckpointIds = bucketState.pendingFilesPerCheckpoint.keySet();
    LOG.debug("Moving pending files to final location on restore.");
    for (Long pastCheckpointId : pastCheckpointIds) {
      // All the pending files are buckets that have been completed but are waiting to be renamed
      // to their final name
      for (String filename : bucketState.pendingFilesPerCheckpoint.get(pastCheckpointId)) {


Access to pendingFilesPerCheckpoint should be covered under synchronized keyword.
The other methods in this class use synchronized access.