This code: https://github.com/apache/flink/blob/9071e3befb8c279f73c3094c9f6bddc0e7cce9e5/flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/ZooKeeperCompletedCheckpointStore.java#L201 can be stuck forever if at least one checkpoint is not readable because CompletedCheckpoint does not have a proper equals()/hashCode() anymore.

We have to fix this and also add a unit test that verifies the loop still works if we make one snapshot unreadable.