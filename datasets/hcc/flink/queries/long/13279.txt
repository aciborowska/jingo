When querying a simple table in catalog, SQL CLI reports "org.apache.flink.table.api.TableException: No table was registered under the name ArrayBuffer(default: select * from hivetable)."

Kurt Young can you please help to triage this ticket to proper person?

Repro steps in SQL CLI (to set up dependencies of HiveCatalog, please refer to dev/table/catalog.md):



Flink SQL> show catalogs;
default_catalog
myhive

Flink SQL> use catalog myhive
> ;

Flink SQL> show databases;
default

Flink SQL> show tables;
hivetable
products
test

Flink SQL> describe hivetable;
root
 |-- name: STRING
 |-- score: DOUBLE

Flink SQL> select * from hivetable;
[ERROR] Could not execute SQL statement. Reason:
org.apache.flink.table.api.TableException: No table was registered under the name ArrayBuffer(default: select * from hivetable).



Exception in log:




2019-07-15 14:59:12,273 WARN  org.apache.flink.table.client.cli.CliClient                   - Could not execute SQL statement.
org.apache.flink.table.client.gateway.SqlExecutionException: Invalid SQL query.
	at org.apache.flink.table.client.gateway.local.LocalExecutor.executeQueryInternal(LocalExecutor.java:485)
	at org.apache.flink.table.client.gateway.local.LocalExecutor.executeQuery(LocalExecutor.java:317)
	at org.apache.flink.table.client.cli.CliClient.callSelect(CliClient.java:469)
	at org.apache.flink.table.client.cli.CliClient.callCommand(CliClient.java:291)
	at java.util.Optional.ifPresent(Optional.java:159)
	at org.apache.flink.table.client.cli.CliClient.open(CliClient.java:200)
	at org.apache.flink.table.client.SqlClient.openCli(SqlClient.java:123)
	at org.apache.flink.table.client.SqlClient.start(SqlClient.java:105)
	at org.apache.flink.table.client.SqlClient.main(SqlClient.java:194)
Caused by: org.apache.flink.table.api.TableException: No table was registered under the name ArrayBuffer(default: select * from hivetable).
	at org.apache.flink.table.api.internal.TableEnvImpl.insertInto(TableEnvImpl.scala:529)
	at org.apache.flink.table.api.internal.TableEnvImpl.insertInto(TableEnvImpl.scala:507)
	at org.apache.flink.table.api.internal.BatchTableEnvImpl.insertInto(BatchTableEnvImpl.scala:58)
	at org.apache.flink.table.api.internal.TableImpl.insertInto(TableImpl.java:428)
	at org.apache.flink.table.api.internal.TableImpl.insertInto(TableImpl.java:416)
	at org.apache.flink.table.client.gateway.local.LocalExecutor.lambda$executeQueryInternal$10(LocalExecutor.java:476)
	at org.apache.flink.table.client.gateway.local.ExecutionContext.wrapClassLoader(ExecutionContext.java:202)
	at org.apache.flink.table.client.gateway.local.LocalExecutor.executeQueryInternal(LocalExecutor.java:474)
	... 8 more




However, select * from myhive.`default`.hivetable; seems to work well

Also note this is tested with changes in https://github.com/apache/flink/pull/9049