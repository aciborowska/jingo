LaunchableMesosWorker makes Mesos expose these ports for a Task Manager:

private static final String[] TM_PORT_KEYS = {
{{ "taskmanager.rpc.port",}}
{{ "taskmanager.data.port"};}}

But when running Prometheus Exporter on a TM, another port needs to be exposed to make Flink's Prometheos endpoint externally scrapable by the Prometheus server. By default this is port 9249, but it is configurable according to:

https://ci.apache.org/projects/flink/flink-docs-release-1.6/monitoring/metrics.html#prometheus-orgapacheflinkmetricsprometheusprometheusreporter

 

My plan is to make a PR, that just adds another config option for mesos, to enable custom ports to be exposed in the provisioned TMs.



I considered carrying parts of the Metrics config into the Mesos code to automatically map metrics ports in mesos. But making such a "shortcut" between Flink's metrics and mesos modules would probably need some sort of integration testing, so I prefer the simple solution of just adding another Mesos config option. But comments are welcome.