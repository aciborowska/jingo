The type of state created from windowState and globalState in ProcessWindowFunction.process() is inconsistency. For detail,


context.windowState().getListState(); // return type is HeapListState or RocksDBListState
context.globalState().getListState(); // return type is UserFacingListState



This cause the problem in the following code,


Iterable<T> iterableState = listState.get();
 if (terableState.iterator().hasNext()) {
   for (T value : iterableState) {
     value.setRetracting(true);
     collector.collect(value);
   }
   state.clear();
}


If the listState is created from context.globalState() is fine, but when it created from context.windowState() this will cause NPE. I met this in 1.3.2 but I found it also affect 1.5.0.