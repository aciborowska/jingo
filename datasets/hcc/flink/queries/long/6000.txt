Right know it is impossible to start a cluster in zookeeper HA mode as described in the documentation by setting:

in con/flink-conf.yaml:

high-availability: zookeeper
...



in conf/masters:

localhost:8081
localhost:8082



The problem is with the bin/config.sh file. If value "zookeeper" is read from config file the variable HIGH_AVAILABILITY will be reset to "none" with the else branch. See the below code:


if [ -z "${HIGH_AVAILABILITY}" ]; then
     HIGH_AVAILABILITY=$(readFromConfig ${KEY_HIGH_AVAILABILITY} "" "${YAML_CONF}")
     if [ -z "${HIGH_AVAILABILITY}" ]; then
        # Try deprecated value
        DEPRECATED_HA=$(readFromConfig "recovery.mode" "" "${YAML_CONF}")
        if [ -z "${DEPRECATED_HA}" ]; then
            HIGH_AVAILABILITY="none"
        elif [ ${DEPRECATED_HA} == "standalone" ]; then
            # Standalone is now 'none'
            HIGH_AVAILABILITY="none"
        else
            HIGH_AVAILABILITY=${DEPRECATED_HA}
        fi
     else
         HIGH_AVAILABILITY="none" <-- it exits here
     fi
fi

