The current implementation causes deadlocks when the end of stream event comes from a currently blocked channel.