The "SQL Client end-to-end test for modern Kafka" (aka. test_sql_client_kafka.sh) test is failed in my local environment with following exception:




Exception in thread "main" org.apache.flink.table.client.SqlClientException: Unexpected exception. This is a bug. Please consider filing an issue.
	at org.apache.flink.table.client.SqlClient.main(SqlClient.java:190)
Caused by: org.apache.flink.table.client.gateway.SqlExecutionException: Could not create execution context.
	at org.apache.flink.table.client.gateway.local.ExecutionContext$Builder.build(ExecutionContext.java:759)
	at org.apache.flink.table.client.gateway.local.LocalExecutor.openSession(LocalExecutor.java:228)
	at org.apache.flink.table.client.SqlClient.start(SqlClient.java:98)
	at org.apache.flink.table.client.SqlClient.main(SqlClient.java:178)
Caused by: java.lang.NoClassDefFoundError: org/apache/avro/io/DatumReader
	at org.apache.flink.formats.avro.AvroRowFormatFactory.createDeserializationSchema(AvroRowFormatFactory.java:64)
	at org.apache.flink.streaming.connectors.kafka.KafkaTableSourceSinkFactoryBase.getDeserializationSchema(KafkaTableSourceSinkFactoryBase.java:281)
	at org.apache.flink.streaming.connectors.kafka.KafkaTableSourceSinkFactoryBase.createStreamTableSource(KafkaTableSourceSinkFactoryBase.java:161)
	at org.apache.flink.table.factories.StreamTableSourceFactory.createTableSource(StreamTableSourceFactory.java:49)
	at org.apache.flink.table.client.gateway.local.ExecutionContext.createTableSource(ExecutionContext.java:371)
	at org.apache.flink.table.client.gateway.local.ExecutionContext.lambda$initializeCatalogs$6(ExecutionContext.java:552)
	at java.util.LinkedHashMap.forEach(LinkedHashMap.java:684)
	at org.apache.flink.table.client.gateway.local.ExecutionContext.initializeCatalogs(ExecutionContext.java:550)
	at org.apache.flink.table.client.gateway.local.ExecutionContext.initializeTableEnvironment(ExecutionContext.java:487)
	at org.apache.flink.table.client.gateway.local.ExecutionContext.<init>(ExecutionContext.java:159)
	at org.apache.flink.table.client.gateway.local.ExecutionContext.<init>(ExecutionContext.java:118)
	at org.apache.flink.table.client.gateway.local.ExecutionContext$Builder.build(ExecutionContext.java:748)
	... 3 more
Caused by: java.lang.ClassNotFoundException: org.apache.avro.io.DatumReader
	at java.net.URLClassLoader.findClass(URLClassLoader.java:382)
	at java.lang.ClassLoader.loadClass(ClassLoader.java:424)
	at java.lang.ClassLoader.loadClass(ClassLoader.java:357)
	... 15 more
[FAIL] Test script contains errors.
Checking of logs skipped.

[FAIL] 'flink-end-to-end-tests/test-scripts/test_sql_client_kafka.sh' failed after 0 minutes and 27 seconds! Test exited with exit code 1



I guess the reason why nightly travis didn't report this is that "e2e - misc - hadoop 2.8" is failed on the "Streaming File Sink s3 end-to-end test", that result in all the following cases (including SQL Client end-to-end tests) are not triggered. For example https://api.travis-ci.org/v3/job/633275285/log.txt