Hello everybody,

we're currently encountering an exception while generating an ExecutionGraph JSON in Flink v1.3.2.

Actually executing the job does not cause an exception and everything works as inteded.

 

This happens since we started adding side-outputs to many of our operators.

 

Below is the stacktrace. The problem seems to be a contract violation in the comparator implementation.

 


org.apache.flink.client.program.ProgramInvocationException: The main method caused an error.

        at org.apache.flink.client.program.PackagedProgram.callMainMethod(PackagedProgram.java:545)

        at org.apache.flink.client.program.PackagedProgram.invokeInteractiveModeForExecution(PackagedProgram.java:419)

        at org.apache.flink.client.program.ClusterClient.run(ClusterClient.java:381)

        at org.apache.flink.client.CliFrontend.executeProgram(CliFrontend.java:838)

        at org.apache.flink.client.CliFrontend.run(CliFrontend.java:259)

        at org.apache.flink.client.CliFrontend.parseParameters(CliFrontend.java:1086)

        at org.apache.flink.client.CliFrontend$2.call(CliFrontend.java:1133)

        at org.apache.flink.client.CliFrontend$2.call(CliFrontend.java:1130)

        at org.apache.flink.runtime.security.HadoopSecurityContext$1.run(HadoopSecurityContext.java:43)

        at java.security.AccessController.doPrivileged(Native Method)

        at javax.security.auth.Subject.doAs(Subject.java:422)

        at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1656)

        at org.apache.flink.runtime.security.HadoopSecurityContext.runSecured(HadoopSecurityContext.java:40)

        at org.apache.flink.client.CliFrontend.main(CliFrontend.java:1130)

Caused by: java.lang.RuntimeException: JSON plan creation failed

        at org.apache.flink.streaming.api.graph.StreamGraph.getStreamingPlanAsJSON(StreamGraph.java:668)

        at org.apache.flink.streaming.api.environment.StreamExecutionEnvironment.getExecutionPlan(StreamExecutionEnvironment.java:1538)

        at com.example.Main.main(Main.java:262)

        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)

        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)

        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)

        at java.lang.reflect.Method.invoke(Method.java:498)

        at org.apache.flink.client.program.PackagedProgram.callMainMethod(PackagedProgram.java:528)

        ... 13 more

Caused by: java.lang.IllegalArgumentException: Comparison method violates its general contract!

        at java.util.TimSort.mergeLo(TimSort.java:777)

        at java.util.TimSort.mergeAt(TimSort.java:514)

        at java.util.TimSort.mergeCollapse(TimSort.java:441)

        at java.util.TimSort.sort(TimSort.java:245)

        at java.util.Arrays.sort(Arrays.java:1512)

        at java.util.ArrayList.sort(ArrayList.java:1454)

        at java.util.Collections.sort(Collections.java:175)

        at org.apache.flink.streaming.api.graph.JSONGenerator.getJSON(JSONGenerator.java:60)

        at org.apache.flink.streaming.api.graph.StreamGraph.getStreamingPlanAsJSON(StreamGraph.java:665)

        ... 21 more


 

 

Best Regards,

 

Julian