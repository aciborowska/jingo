AbstractServerTest failed on Travis. The Travis link is https://api.travis-ci.org/v3/job/588761985/log.txt. The error message is as follows.


05:53:23.924 [ERROR] Tests run: 2, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 0.113 s <<< FAILURE! - in org.apache.flink.queryablestate.network.AbstractServerTest
05:53:23.924 [ERROR] testPortRangeSuccess(org.apache.flink.queryablestate.network.AbstractServerTest)  Time elapsed: 0.064 s  <<< FAILURE!
java.lang.AssertionError: expected:<0> but was:<1>
	at org.apache.flink.queryablestate.network.AbstractServerTest.testPortRangeSuccess(AbstractServerTest.java:126)


The failure can be reproduced by running the test case multi times (until failure) locally.

The failure reason is that the requestStats is shared by two instance of TestServer which relies on AutoCloseable interface for connection release. If one of the server has been shut down and the anther is not, the assertion in the close method can fail. To fix the problem, we can move the assertion out of the close method.