Currently the ACC TypeInformation of org.apache.flink.table.functions.AggregateFunction[T, ACC] is extracted using TypeInformation.of(Class). When ACC is a Scala case class or tuple class, the TypeInformation will fall back to GenericType which result in bad performance when state de/serialization. 

I suggest to extract the ACC TypeInformation when called TableEnvironment.registerFunction().

Here is an example:


case class Accumulator(sum: Long, count: Long)

class MyAgg extends AggregateFunction[Long, Accumulator] {

  //Overloaded accumulate method
  def accumulate(acc: Accumulator, value: Long): Unit = {
  }

  override def createAccumulator(): Accumulator = Accumulator(0, 0)

  override def getValue(accumulator: Accumulator): Long = 1
}



The Accumulator will be recognized as GenericType<Accumulator>.