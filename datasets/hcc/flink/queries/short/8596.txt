Custom command line code does not correctly catch errors