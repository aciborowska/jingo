Fix Race Condition when releasing shared memory resource