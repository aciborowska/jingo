Found using revision 10796.
The problem appeared in revision 10781.

Scenario (with je mode):
*************************
=> problem can be reproduced with replication.totalupdate testsuite

=> in the logs/errors file we have the following traces:


[11/Jun/2014:11:41:22 +0100] category=SYNC severity=NOTICE msgID=15138840 msg=Error closing Replication Server database 21997 dc=com : ThreadInterruptedException: (JE 5.0.103) Environment must be closed, caused by: com.sleepycat.je.ThreadInterruptedException: Environment invalid because of previous exception: (JE 5.0.103) /home/user/results/20140611-102408/replication/opendj-inst2-totalupdate/opendj/changelogDb Thread interrupted prior to logging the commit THREAD_INTERRUPTED: InterruptedException may cause incorrect internal state, unable to continue. Environment is invalid and must be closed. (ThreadInterruptedException.java:99 EnvironmentImpl.java:1618 Environment.java:2225 Database.java:2153 Database.java:540 Database.java:508 Database.java:438 ReplicationDB.java:268 JEReplicaDB.java:202 JEChangelogDB.java:571 ReplicationServerDomain.java:2127 ReplicationServerDomain.java:1849 ReplicationServerDomain.java:1893 ServerHandler.java:1178 ServerReader.java:203)



=> seems that there is also another impact in replication.external_changelog testsuite (External Changelog LastExternalChangelogCookie And LastChangenumber Virtual Attributes) in which the ECL changenumber and the lastchangenumber virtual attribute are no more in sync.