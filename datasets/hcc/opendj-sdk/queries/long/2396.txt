With OpenDJ 3.0.0 rev 6292beaede500c125091a84263ed7cda454ba299
we setup 2 servers, enable and initialize replication between them.

We are then using pre-external-initialization subcommand of dsreplication,
import an ldif file with some data on first server, check the import went successfully and that expected data is there and replicated on both servers.

we backup the first instance, online, and restore the backup on the second instance.

Then  we use the post-external-initialisation subcommand of dsreplication. it fails with the following error:


./DJ1/opendj/bin/dsreplication post-external-initialization -b dc=com -I admin -w password  -X -n
20151028 16:15:04.682 - FAIL - CmdException: ERROR:
-- rc --
returned 24, expected 0
-- stdout --
Updating replication information on base DN dc=com ..... 
Post initialization procedure completed successfully.
-- stderr --
Unexpected error during the operation.  Last log details:
[28/Oct/2015:16:15:03 +0100] severity="NOTICE" msgCount=0
msgID=org.opends.messages.backend-413 message="Set Generation ID task
dsreplication-reset-generation-id-3 started execution".  Task state:
STOPPED_BY_ERROR.  Check the error logs of cforel-Dell-Precision-M3800:4444
for more information.
See /tmp/opendj-replication-3416358619696434795.log for a detailed log of this
operation.



in the log, we have the following messages:


[28/10/2015:16:15:01 +0100] category=org.opends seq=0 severity=INFO msg=Application launched October 28, 2015 4:15:01 PM CET
[28/10/2015:16:15:03 +0100] category=EXTENSIONS seq=1 severity=INFO msg=Loaded extension from file '/local/GIT/pyforge/results/20151028-161349/replication_group/BinaryCopy/DJ1/opendj/lib/extensions/snmp-mib2605.jar' (build 3.0.0-SNAPSHOT, revision 6292beaede500c125091a84263ed7cda454ba299)
[28/10/2015:16:15:03 +0100] category=TOOLS seq=2 severity=INFO msg=created task entry: {ds-task-reset-generation-id-domain-base-dn=ds-task-reset-generation-id-domain-base-dn: dc=com, objectclass=objectclass: top, ds-task, ds-task-reset-generation-id, ds-task-class-name=ds-task-class-name: org.opends.server.tasks.SetGenerationIdTask, ds-task-id=ds-task-id: dsreplication-reset-generation-id-3}
[28/10/2015:16:15:04 +0100] category=TOOLS seq=3 severity=INFO msg=[28/Oct/2015:16:15:03 +0100] severity="NOTICE" msgCount=0 msgID=org.opends.messages.backend-413 message="Set Generation ID task dsreplication-reset-generation-id-3 started execution"
[28/10/2015:16:15:04 +0100] category=TOOLS seq=4 severity=WARNING msg=Error: Unexpected error during the operation.  Last log details: [28/Oct/2015:16:15:03 +0100] severity="NOTICE" msgCount=0 msgID=org.opends.messages.backend-413 message="Set Generation ID task dsreplication-reset-generation-id-3 started execution".  Task state: STOPPED_BY_ERROR.  Check the error logs of cforel-Dell-Precision-M3800:4444 for more information.
[28/10/2015:16:15:04 +0100] category=TOOLS seq=5 severity=SEVERE msg=Complete error stack: exception=ReplicationCliException: Unexpected error during the operation.  Last log details: [28/Oct/2015:16:15:03 +0100] severity="NOTICE" msgCount=0 msgID=org.opends.messages.backend-413 message="Set Generation ID task dsreplication-reset-generation-id-3 started execution".  Task state: STOPPED_BY_ERROR.  Check the error logs of cforel-Dell-Precision-M3800:4444 for more information. (ReplicationCliMain.java:7125 ReplicationCliMain.java:7009 ReplicationCliMain.java:4243 ReplicationCliMain.java:824 ReplicationCliMain.java:525 ReplicationCliMain.java:458 ReplicationCliMain.java:334 ReplicationCliMain.java:286)



script in attachment for reproducing the problem.

NOTE
Moreover this is very difficult to determine/find when the problem appears as we have a lot of noise in the errors logs.

The following error appears 146 times in the errors log of the first instance:

[17/Nov/2015:00:09:53 +0100] category=SYNC severity=ERROR msgID=org.opends.messages.replication.79 msg=The following error has been received : Replication server RS(18769) at localhost/127.0.0.1:55485 presented generation ID -1 for domain "dc=com", but the generation ID of this replication server RS(17269) is 3079061. This usually indicates that one or more directory servers in the replication topology have not been initialized with the same data, and re-initialization is required



And the following message appears 1252 times in the errors logs of both instances:

[17/Nov/2015:00:10:41 +0100] category=UTIL severity=NOTICE msgID=org.opends.messages.extension.637 msg=Handshake for 'Replication Server': cipher requires the aliase(s) '[ads-certificate]'  to contain key(s) of type(s) '[EC_EC]'



I also notice a NPE in the errors log for both instances:

[17/Nov/2015:00:11:04 +0100] category=org.opends.server.api.DirectoryThread severity=ERROR msgID=org.opends.messages.core.140 msg=An uncaught exception during processing for thread Replica DS(4155) listener for domain "dc=com" has caused it to terminate abnormally. The stack trace for that exception is: NullPointerException (ReplicationDomain.java:2965 Thread.java:745)

