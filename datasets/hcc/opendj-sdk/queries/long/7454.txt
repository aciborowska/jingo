Using the ds-base docker image, do a


mkdir db/ 

And then run setup.  The command fails 


Configuring server.....Error......
An error occurred while writing password in configuration file:
'/opt/opendj/db/rootUser/rootUser.ldif'
See /tmp/opendj-setup-8846075894546343712.log for a detailed log of the failed
operation.
Please report this error and provide the log file mentioned above.
 

The log file does not contain any meaningful information.


[14/09/2020:22:36:00 +0000] category=org.forgerock.opendj.setup.model seq=0 severity=INFO msg=Setup tool launched September 14, 2020 at 10:36:00
PM UTC

I speculate this is because setup does not like the existing db/ directory, even though it is empty. I understand why it does not want to overwrite good backend data - but I think the check for "is this empty" could be modified?

Motivation (Why do I want to do this  ):

I'm experimenting with an alternate deployment style - call it "mutable DS" or "DS is a database".  The idea is to defer the initial setup to a K8S init container. 

To do this more easily, it would be much nicer if the data PVC could be mounted on db/, and setup could populate the persistent db/ pvc using a profile. 

I think this might eliminate some of the sym link tricks we do - which to some extent complicate the deployment. 

A possible alternative is to run setup in an init container, but mount the PVC on data/. At the conclusion of setup, the script copies from db/* to data/*. When the "main" DS container starts up, the PVC is now mounted on db/ and not data/.

There may be better ways to solve this.. so let's discuss.  

CC: Matthew Swift Jean-Noël Rouvignac Ludovic Poitou

 