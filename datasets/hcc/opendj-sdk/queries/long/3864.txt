Found with OpenDJ 4.0.0 rev 1b042cdf009

Scenario:

We setup 2 DJs with data, replicated on dc=example,dc=com.
We setup a proxy with replication discovery service mechanism, pointing to these 2 DJs:


./PROXY1/opendj/setup proxy-server --proxyUserBindDn cn=myself --proxyUserBindPassword password \
 --replicationServer localhost:1394 --replicationServer localhost:1395 --loadBalancingAlgorithm affinity \
 -h localhost -p 1397 -D "cn=myself" -w password --adminConnectorPort 4452

 

=> requests on dc=example,dc=com are correctly forwarded.
We create a new backend on each DJ, with dc=org and some data in it, then enable replication for this suffix.

We change the settings of the proxy so that it routes only dc=org requests:

PROXY1/opendj/bin/dsconfig -h localhost -p 4452 -D "cn=myself" -w password -X \
 set-backend-prop --backend-name proxyRoot --set route-all:False --set base-dn:dc=org -n



=> requests for dc=org are correctly forwarded to these DJs.

The problem is that, when we change the proxy configuration, we get the following error messages:


[14/Mar/2017:14:37:20 +0100] category=BACKEND severity=ERROR msgID=615 msg=Proxy backend 'proxyRoot' is non functional because it could not find any primary nor secondary servers via the service discovery mechanism 'Replication Service Discovery Mechanism' 
[14/Mar/2017:14:37:20 +0100] category=BACKEND severity=ERROR msgID=611 msg=Proxy backend 'proxyRoot' could not discover remote servers capabilities: Connect Error

