Found with opendj 4.0.0 rev efc41e456f715abe57a69d6136a2d1a1098eae4c
backend is pdb.

Scenario:

We setup a server.
We remove global ACI and import some data (users and groups).

We add an aci to allow search and read of a specific user attribute:

./opendj/bin/ldapmodify -h dj-robot-linux.internal.forgerock.com -p 1389 -D "cn=myself" -w password 	
dn: ou=aci branch,o=Bind Type Tests,o=ACI Tests,dc=example,dc=com
changetype: modify
add: aci
aci: (targetattr="*")(version 3.0; acl "add_userattr_aci1"; allow (search,read) userattr="l#Austin";)



Then we bind with a specific user and search for a user in the branch mentioned above (ie ou=aci branch,o=Bind Type Tests,o=ACI Tests,dc=example,dc=com) that has the attribute mentioned above (ie l#Austin)

./opendj/bin/ldapsearch -h dj-robot-linux.internal.forgerock.com -p 1389 -D "uid=cuser,ou=people,o=ACI Tests,dc=example,dc=com" -w ACIRules -T -b "uid=scarter,ou=people,ou=aci branch,o=bind type tests,o=aci tests,dc=example,dc=com" "objectclass=*" 



We were expecting to see the user and its attribute in the output (dn: uid=scarter,ou=people,ou=aci branch,o=bind type tests,o=aci tests,dc=example,dc=com) but the command did not return anything.

When using JE, the result is as expected:

dn: uid=scarter,ou=People,ou=aci branch,o=Bind Type Tests,o=ACI Tests,dc=example,dc=com 
cn: Sam Carter 
sn: Carter 
uid: scarter 
l: Austin


Script attached to reproduce the problem.




