We see perf degradation since commit 561453327e4 on 6.5.0-SNAPSHOT in following test case:


python3 run-pybot.py -v -c perf -s perf_comparison.GroupComparison -t ModRate_And_SearchRate DJ


The degradation was time to time hitting 5% limit, but since above commit the degradation is more than 10% and with commit 1fcf9ab9231 it's even more.

The test is running searchrate and modrate at the same time on groups.

Modrate command:


./modrate -h pyforge.example.com -p 1390 -D "cn=Directory Manager" -w password -d 210 -S -B 60 -c 10 -t 4 -i 2 -F -b "cn=Group {1},ou=Groups,dc=example,dc=com" -g "rand(0,999)" -g "rand(0,4999)" "member: uid=user.{2},ou=People1,dc=example,dc=com"


Searchrate command:


./searchrate -h pyforge.example.com -p 1390 -D "cn=Directory Manager" -w password -d 210 -b "ou=People,dc=example,dc=com" -S -F -B 60 -c 10 -i 2 -t 4 -g "rand(0,4999)" "(uid=user.{1})" isMemberOf


The output for git bisect is this commit: `1fcf9ab9231` however I saw that one run failed due to opendj compilation error, so I tried few other commits and looks like first significant degradation started few commits earlier with `561453327e4`.  With `561453327e4` ( I saw around 13% degradation) with  `1fcf9ab9231` it was more. 

Measured throughtputs:

Before "561453327e4": 
 modrate: 5680
 searchrate: 5708
 After "561453327e4" (commit included):
 modrate: 4794
 searchrate: 4824

After "1fcf9ab9231" (commit included): 
 modrate: 3139-3700 but never over 4000
 searchrate: 3160-3800 but never over 4000

RC3
 modrate: 3434
 searchrate: 3442

On the other side results for 6.0.0 are constantly around 5400-5700 never below 5000 (modrate and similar for searchrate). (edited)

Above numbers are from personal machine. On lab machine or perf machines like beaufort the numbers are higher, but the difference between 6.0.0 and 6.5.0-RC3 is still around 2000.

Around same commits we see also perf regression on searches and mods on nested groups.

This is reproducible with test:


python3 run-pybot.py -v -c perf -s perf_comparison.GroupComparison -t ModRate_And_SearchRate_NestedGroups OpenDJ

