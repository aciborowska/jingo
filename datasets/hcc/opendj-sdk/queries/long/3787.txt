The operation hang when the authenticated user performing the operation is part of the branch which is moved

A test for an example in the dev guide, https://ea.forgerock.com/docs/opendj/doc/bootstrap/dev-guide/index.html#rename-moddn, has been hanging the doc tests lately.

When I try the example against a build of OpenDJ from earlier this morning, the modify DN request doesn't seem to complete:


ldapmodify \
> --port 1389 \
> --bindDN "uid=kvaughan,ou=people,dc=example,dc=com" \
> --bindPassword bribery
dn: ou=People,dc=example,dc=com
changetype: modrdn
newrdn: ou=Subscribers
deleteoldrdn: 1
newsuperior: dc=example,dc=com

Processing MODIFY DN request for ou=People,dc=example,dc=com

^D
^C



When the server is then stopped, the stop operation takes a while, and the thread is interrupted:


$ stop-ds 
Stopping Server...
[27/Feb/2017:12:13:14 +0100] category=CORE severity=ERROR msgID=140 msg=An uncaught exception during processing for thread Worker Thread 1 has caused it to terminate abnormally. The stack trace for that exception is: LdapException: Other: com.sleepycat.je.ThreadInterruptedException: (JE 7.3.7) Environment must be closed, caused by: com.sleepycat.je.ThreadInterruptedException: Environment invalid because of previous exception: (JE 7.3.7) /path/to/opendj/db/userRoot java.lang.InterruptedException THREAD_INTERRUPTED: InterruptedException may cause incorrect internal state, unable to continue. Environment is invalid and must be closed. (LdapException.java:202 ReactiveHandlersUtils.java:422 LdapClientConnection.java:400 ModifyDNOperationBasis.java:434 TraditionalWorkerThread.java:148)
[27/Feb/2017:12:13:14 +0100] category=CORE severity=NOTICE msgID=139 msg=The Directory Server has sent an alert notification generated by class org.opends.server.api.DirectoryThread (alert type org.opends.server.UncaughtException, alert ID org.opends.messages.core-140): An uncaught exception during processing for thread Worker Thread 1 has caused it to terminate abnormally. The stack trace for that exception is: LdapException: Other: com.sleepycat.je.ThreadInterruptedException: (JE 7.3.7) Environment must be closed, caused by: com.sleepycat.je.ThreadInterruptedException: Environment invalid because of previous exception: (JE 7.3.7) /path/to/opendj/db/userRoot java.lang.InterruptedException THREAD_INTERRUPTED: InterruptedException may cause incorrect internal state, unable to continue. Environment is invalid and must be closed. (LdapException.java:202 ReactiveHandlersUtils.java:422 LdapClientConnection.java:400 ModifyDNOperationBasis.java:434 TraditionalWorkerThread.java:148)
[27/Feb/2017:12:13:14 +0100] category=CORE severity=NOTICE msgID=203 msg=The Directory Server is now stopped

