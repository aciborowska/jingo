An issue spotted during our daily jobs with rest2ldap tests when we try to access an entiry which is referenced but it can not be fetched.
Doing a request: 


http://ig-robot-windows2.internal.forgerock.com:8080/api/query/users?_sortKeys=manager/_id&_queryFilter=true&_prettyPrint=true

the response is:


{
"code" : 400,
"reason" : "Bad Request",
"message" : "The query request cannot be processed because this sort directive requires the page size to be set to a value between 1 and 1000."
}

^^ expected, but in the logs we have an error message:


[03/Apr/2018:23:59:36 +0100] category=CORE severity=NOTICE msgID=139 msg=The Directory Server has sent an alert notification generated by class org.opends.server.api.DirectoryThread (alert type org.opends.server.UncaughtException, alert ID org.opends.messages.core-140): An uncaught exception during processing for thread Worker Thread 3 has caused it to terminate abnormally. The stack trace for that exception is: UndeliverableException: Canceled: Client Unbind (RxJavaPlugins.java:366 ObservableConcatMapEager.java:153 PromiseImpl.java:275 PromiseImpl.java:373 PromiseImpl.java:531 PromiseImpl.java:572 PromiseImpl.java:233 PromiseImpl.java:188 LdapPromiseImpl.java:56 SdkConnectionAdapter.java:214 LambdaSubscriber.java:79 FlowableOnErrorNext.java:82 EmptySubscription.java:54 FlowableError.java:39 Flowable.java:13234 Flowable.java:13180 FlowableOnErrorNext.java:109 FlowableDoOnEach.java:111 BasicFuseableSubscriber.java:101 FlowableDoFinally.java:90 RequestState.java:140 ...)

Same test with rest2ldap gateway works and doesn't produce an error message.

To reproduce the error it's possible to use test framework with following command:

./run-pybot.py -s "rest2ldap_group.Query*" -v opendj

 

 