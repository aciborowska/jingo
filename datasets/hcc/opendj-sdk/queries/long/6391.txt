Unable to run backup or rebuild-index commands in offline mode if there is an LDAP Pass Through Authentication Policy configured for SSL with trust-manager-provider. Online, the tools work as expected.

 

To reproduce, create a password policy as described above.

Example:

dsconfig create-password-policy \
 --set primary-remote-ldap-server:dj2.example.com:1689 \
 --set use-ssl:true \
 --set trust-manager-provider:JVM\ Trust\ Manager \
 --type ldap-pass-through \
 --policy-name PTA \
 --hostname dj1.example.com \
 --port 4444 \
 --bindDn cn=Directory\ Manager \
 --bindPassword ****** \
 --trustAll \
 --no-prompt


 

Stop DS, then run offline backup/rebuild-index (other offline tools may be also affected), for example:

./backup --offline --backendID amIdentityStore --backupDirectory ../bak


 

This results in the following NullPointerException referencing the password policy:

An error occurred while attempting to initialize server components to run the
 tool: An error occurred while attempting to initialize the password policy
 components: The password policy defined in configuration entry
 cn=PTA,cn=Password Policies,cn=config is invalid: NullPointerException
 (DirectoryServer.java:2354 LDAPPassThroughAuthenticationPolicyFactory.java:599
 LDAPPassThroughAuthenticationPolicyFactory.java:581
 LDAPPassThroughAuthenticationPolicyFactory.java:95
 LDAPPassThroughAuthenticationPolicyFactory.java:464
 LDAPPassThroughAuthenticationPolicyFactory.java:447
 LDAPPassThroughAuthenticationPolicyFactory.java:421
 LDAPPassThroughAuthenticationPolicyFactory.java:345
 LDAPPassThroughAuthenticationPolicyFactory.java:112
 LDAPPassThroughAuthenticationPolicyFactory.java:611
 LDAPPassThroughAuthenticationPolicyFactory.java:95
 PasswordPolicyConfigManager.java:313 PasswordPolicyConfigManager.java:105
 DirectoryServer.java:1594 DirectoryServer.java:193 DirectoryServer.java:734
 DirectoryServer.java:634 BackUpDb.java:305 TaskTool.java:291 BackUpDb.java:237
 TaskTool.java:265 ...) (id=org.opends.messages.tool-373)


 

One workaround is to disable SSL on the password policy temporarily, this is also possible to do offline with "dsconfig --offline", i.e.

dsconfig set-password-policy-prop \
                    --policy-name PTA \
                    --set use-ssl:false \
                    --offline \
                    --configFile /path/to/DS/config/config.ldif \
                    --no-prompt

