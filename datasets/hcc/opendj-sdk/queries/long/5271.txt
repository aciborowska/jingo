Found with rev cca1f50dab3

We set up 2Â servers, replicated on 2 suffixes.
We add a new server in this topology for one suffix.
Then we add the second suffix to this 3rd server and replicate it.
We add an entry on first suffix.
We query cn=changelog to retrieve the last cookie (we know our last change number is 5):


./DJ1/opendj/bin/ldapsearch -h nameserver.example.com -p 1389 -D "cn=Directory Manager" -w password -b "cn=changelog"  "(changenumber>=5)" "*" changeinitiatorsname targetentryuuid changelogcookie

dn: changeNumber=5,cn=changelog
objectclass: top
objectclass: changeLogEntry
changeNumber: 5
changes:: b2JqZWN0Q2xhc3M6IHRvcApvYmplY3RDbGFzczogaW5ldG9yZ3BlcnNvbgpvYmplY3RDbGFzczogb3JnYW5pemF0aW9uYWxwZXJzb24Kb2JqZWN0Q2xhc3M6IHBlcnNvbgpjbjogbmV3ZHNycwpkZXNjcmlwdGlvbjogMQpkZXNjcmlwdGlvbjogMgpzbjogbmV3ZHNycwp1aWQ6IE5FV0RTUlMKY3JlYXRlVGltZXN0YW1wOiAyMDE4MDcwOTE1MTAwM1oKY3JlYXRvcnNOYW1lOiBjbj1EaXJlY3RvcnkgTWFuYWdlcgplbnRyeVVVSUQ6IDkyM2IxY2U3LWYyNWQtNGMyMC1iZmYxLTNkMmUyMWNmMDJhZAo=
changeTime: 20180709151003Z
changeType: add
targetDN: cn=newdsrs,ou=people,dc=example,dc=com
changeinitiatorsname: cn=Directory Manager
changelogcookie: dc=com:000001647f97acdb0001000000da;
targetentryuuid: 923b1ce7-f25d-4c20-bff1-3d2e21cf02ad




We would have expected to have the second suffix as well in the changelogcookie so we did another query on cn=changelog to see it all:


./DJ1/opendj/bin/ldapsearch -h nameserver.example.com -p 1389 -D "cn=Directory Manager" -w password -b "cn=changelog"  "(objectclass=*)" "*" changeinitiatorsname targetentryuuid changelogcookie
dn: cn=changelog
objectclass: top
objectclass: container
cn: changelog

dn: changeNumber=1,cn=changelog
objectclass: top
objectclass: changeLogEntry
changeNumber: 1
changes:: b2JqZWN0Q2xhc3M6IHRvcApvYmplY3RDbGFzczogaW5ldG9yZ3BlcnNvbgpvYmplY3RDbGFzczogb3JnYW5pemF0aW9uYWxwZXJzb24Kb2JqZWN0Q2xhc3M6IHBlcnNvbgpjbjogZW50cnkgYQpzbjogUmVwbGljYXRlZApjcmVhdGVUaW1lc3RhbXA6IDIwMTgwNzA5MTUwOTAxWgpjcmVhdG9yc05hbWU6IGNuPURpcmVjdG9yeSBNYW5hZ2VyCmVudHJ5VVVJRDogM2UzMDY1NjUtNmZlYy00YTBiLWFjNjctNWUxMTg2MmRhZGY5Cg==
changeTime: 20180709150901Z
changeType: add
targetDN: cn=entry a,ou=people,dc=example,dc=com
changeinitiatorsname: cn=Directory Manager
changelogcookie: dc=com:000001647f96b9ad000100000030;
targetentryuuid: 3e306565-6fec-4a0b-ac67-5e11862dadf9

dn: changeNumber=2,cn=changelog
objectclass: top
objectclass: changeLogEntry
changeNumber: 2
changes:: b2JqZWN0Q2xhc3M6IHRvcApvYmplY3RDbGFzczogb3JnYW5pemF0aW9uCm86IG5ld19zdWZmaXhfcmVwbApjcmVhdGVUaW1lc3RhbXA6IDIwMTgwNzA5MTUwOTEyWgpjcmVhdG9yc05hbWU6IGNuPURpcmVjdG9yeSBNYW5hZ2VyCmVudHJ5VVVJRDogMzA1OTA3NjAtYmNkYi00YzY2LThiM2UtYTYxMGI3ZGM4NmU1Cg==
changeTime: 20180709150912Z
changeType: add
targetDN: o=new_suffix_repl
changeinitiatorsname: cn=Directory Manager
changelogcookie: dc=com:000001647f96b9ad000100000030;o=new_suffix_repl:000001647f96e4af000100000048;
targetentryuuid: 30590760-bcdb-4c66-8b3e-a610b7dc86e5

dn: changeNumber=3,cn=changelog
objectclass: top
objectclass: changeLogEntry
changeNumber: 3
changes:: b2JqZWN0Q2xhc3M6IHRvcApvYmplY3RDbGFzczogb3JnYW5pemF0aW9uYWx1bml0Cm91OiBwZW9wbGUKY3JlYXRlVGltZXN0YW1wOiAyMDE4MDcwOTE1MDkxNFoKY3JlYXRvcnNOYW1lOiBjbj1EaXJlY3RvcnkgTWFuYWdlcgplbnRyeVVVSUQ6IGQ2OGMwZGZiLTdkYzctNDA5NS04ZmZjLTVjYmQ0Nzg3NmU2MQo=
changeTime: 20180709150914Z
changeType: add
targetDN: ou=people,o=new_suffix_repl
changeinitiatorsname: cn=Directory Manager
changelogcookie: dc=com:000001647f96b9ad000100000030;o=new_suffix_repl:000001647f96eaf000010000004e;
targetentryuuid: d68c0dfb-7dc7-4095-8ffc-5cbd47876e61

dn: changeNumber=4,cn=changelog
objectclass: top
objectclass: changeLogEntry
changeNumber: 4
changes:: b2JqZWN0Q2xhc3M6IHRvcApvYmplY3RDbGFzczogaW5ldG9yZ3BlcnNvbgpvYmplY3RDbGFzczogb3JnYW5pemF0aW9uYWxwZXJzb24Kb2JqZWN0Q2xhc3M6IHBlcnNvbgpjbjogZW50cnkgYQpzbjogUmVwbGljYXRlZApjcmVhdGVUaW1lc3RhbXA6IDIwMTgwNzA5MTUwOTE0WgpjcmVhdG9yc05hbWU6IGNuPURpcmVjdG9yeSBNYW5hZ2VyCmVudHJ5VVVJRDogYTA3NmM3NGItYzY1ZC00YjRiLWIzMWUtNDc0ZDNiZGU3MWFjCg==
changeTime: 20180709150914Z
changeType: add
targetDN: cn=entry a,ou=people,o=new_suffix_repl
changeinitiatorsname: cn=Directory Manager
changelogcookie: dc=com:000001647f96b9ad000100000030;o=new_suffix_repl:000001647f96eaf0000100000050;
targetentryuuid: a076c74b-c65d-4b4b-b31e-474d3bde71ac

dn: changeNumber=5,cn=changelog
objectclass: top
objectclass: changeLogEntry
changeNumber: 5
changes:: b2JqZWN0Q2xhc3M6IHRvcApvYmplY3RDbGFzczogaW5ldG9yZ3BlcnNvbgpvYmplY3RDbGFzczogb3JnYW5pemF0aW9uYWxwZXJzb24Kb2JqZWN0Q2xhc3M6IHBlcnNvbgpjbjogbmV3ZHNycwpkZXNjcmlwdGlvbjogMQpkZXNjcmlwdGlvbjogMgpzbjogbmV3ZHNycwp1aWQ6IE5FV0RTUlMKY3JlYXRlVGltZXN0YW1wOiAyMDE4MDcwOTE1MTAwM1oKY3JlYXRvcnNOYW1lOiBjbj1EaXJlY3RvcnkgTWFuYWdlcgplbnRyeVVVSUQ6IDkyM2IxY2U3LWYyNWQtNGMyMC1iZmYxLTNkMmUyMWNmMDJhZAo=
changeTime: 20180709151003Z
changeType: add
targetDN: cn=newdsrs,ou=people,dc=example,dc=com
changeinitiatorsname: cn=Directory Manager
changelogcookie: dc=com:000001647f97acdb0001000000da;o=new_suffix_repl:000001647f96eaf0000100000050;
targetentryuuid: 923b1ce7-f25d-4c20-bff1-3d2e21cf02ad



surprisingly, the changelogcookie field now show up this second suffix ie:

changelogcookie: dc=com:000001647f97acdb0001000000da;o=new_suffix_repl:000001647f96eaf0000100000050;



we check again with the preceding filter and with another filter:


/DJ1/opendj/bin/ldapsearch -h nameserver.example.com -p 1389 -D "cn=Directory Manager" -w password -b "cn=changelog"  "(changenumber>=5)" "*" changeinitiatorsname targetentryuuid changelogcookie
dn: changeNumber=5,cn=changelog
objectclass: top
objectclass: changeLogEntry
changeNumber: 5
changes:: b2JqZWN0Q2xhc3M6IHRvcApvYmplY3RDbGFzczogaW5ldG9yZ3BlcnNvbgpvYmplY3RDbGFzczogb3JnYW5pemF0aW9uYWxwZXJzb24Kb2JqZWN0Q2xhc3M6IHBlcnNvbgpjbjogbmV3ZHNycwpkZXNjcmlwdGlvbjogMQpkZXNjcmlwdGlvbjogMgpzbjogbmV3ZHNycwp1aWQ6IE5FV0RTUlMKY3JlYXRlVGltZXN0YW1wOiAyMDE4MDcwOTE1MTAwM1oKY3JlYXRvcnNOYW1lOiBjbj1EaXJlY3RvcnkgTWFuYWdlcgplbnRyeVVVSUQ6IDkyM2IxY2U3LWYyNWQtNGMyMC1iZmYxLTNkMmUyMWNmMDJhZAo=
changeTime: 20180709151003Z
changeType: add
targetDN: cn=newdsrs,ou=people,dc=example,dc=com
changeinitiatorsname: cn=Directory Manager
changelogcookie: dc=com:000001647f97acdb0001000000da;
targetentryuuid: 923b1ce7-f25d-4c20-bff1-3d2e21cf02ad

./DJ1/opendj/bin/ldapsearch -h nameserver.example.com -p 1389 -D "cn=Directory Manager" -w password -b "cn=changelog"  "(changenumber>=4)" "*" changeinitiatorsname targetentryuuid changelogcookie
dn: changeNumber=4,cn=changelog
objectclass: top
objectclass: changeLogEntry
changeNumber: 4
changes:: b2JqZWN0Q2xhc3M6IHRvcApvYmplY3RDbGFzczogaW5ldG9yZ3BlcnNvbgpvYmplY3RDbGFzczogb3JnYW5pemF0aW9uYWxwZXJzb24Kb2JqZWN0Q2xhc3M6IHBlcnNvbgpjbjogZW50cnkgYQpzbjogUmVwbGljYXRlZApjcmVhdGVUaW1lc3RhbXA6IDIwMTgwNzA5MTUwOTE0WgpjcmVhdG9yc05hbWU6IGNuPURpcmVjdG9yeSBNYW5hZ2VyCmVudHJ5VVVJRDogYTA3NmM3NGItYzY1ZC00YjRiLWIzMWUtNDc0ZDNiZGU3MWFjCg==
changeTime: 20180709150914Z
changeType: add
targetDN: cn=entry a,ou=people,o=new_suffix_repl
changeinitiatorsname: cn=Directory Manager
changelogcookie: dc=com:000001647f96b9ad000100000030;o=new_suffix_repl:000001647f96eaf0000100000050;
targetentryuuid: a076c74b-c65d-4b4b-b31e-474d3bde71ac

dn: changeNumber=5,cn=changelog
objectclass: top
objectclass: changeLogEntry
changeNumber: 5
changes:: b2JqZWN0Q2xhc3M6IHRvcApvYmplY3RDbGFzczogaW5ldG9yZ3BlcnNvbgpvYmplY3RDbGFzczogb3JnYW5pemF0aW9uYWxwZXJzb24Kb2JqZWN0Q2xhc3M6IHBlcnNvbgpjbjogbmV3ZHNycwpkZXNjcmlwdGlvbjogMQpkZXNjcmlwdGlvbjogMgpzbjogbmV3ZHNycwp1aWQ6IE5FV0RTUlMKY3JlYXRlVGltZXN0YW1wOiAyMDE4MDcwOTE1MTAwM1oKY3JlYXRvcnNOYW1lOiBjbj1EaXJlY3RvcnkgTWFuYWdlcgplbnRyeVVVSUQ6IDkyM2IxY2U3LWYyNWQtNGMyMC1iZmYxLTNkMmUyMWNmMDJhZAo=
changeTime: 20180709151003Z
changeType: add
targetDN: cn=newdsrs,ou=people,dc=example,dc=com
changeinitiatorsname: cn=Directory Manager
changelogcookie: dc=com:000001647f97acdb0001000000da;o=new_suffix_repl:000001647f96eaf0000100000050;
targetentryuuid: 923b1ce7-f25d-4c20-bff1-3d2e21cf02ad



The test that fails used to work on rev (e34681d9f1d)
To reproduce this behaviour:



./run-pybot.py -n -s replication_group2.ExternalChangelogFailover -t "Two_Suffixes_(Both_Replicated)" -t New_RS_Joining_Existing_Topology_Multiple_Suffixes dj


