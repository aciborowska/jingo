Unable to rebuild indexes offline when the "Error Log Handler" is assigned to a password policy in DS 6.5.0.  An upgrade from 3.5.0 to 6.5.0 also fails during the post-upgrade process of rebuilding indexes when the "Error Log Handler" is assigned to any password policy (attached upgrade.log file). Rebuilding indexes online works as expected.

Steps to reproduce:

1. Install DS 6.5.0 and stop DS.

$ bin/stop-ds

2. Check Error Log Handler is enabled:

$ bin/dsconfig --offline get-account-status-notification-handler-prop --handler-name "Error Log Handler"

Property : Value(s)

--------:--------

enabled  : true

3. Add Error Log Handler to Default Password Policy:

$ bin/dsconfig set-password-policy-prop --policy-name Default\ Password\ Policy --set account-status-notification-handler:Error\ Log\ Handler --offline --configFile config/config.ldif --no-prompt

4. Rebuild Indexes offline:

$ bin/rebuild-index -b dc=example,dc=com --rebuildAll --offline

An error occurred while attempting to initialize server components to run the tool: An error occurred while attempting to initialize the password policy components:  The password policy defined in configuration entry cn=Default Password Policy,cn=Password Policies,cn=config is invalid: ConfigException: No notification handler enabled with DN: cn=Error Log Handler,cn=Account Status Notification Handlers,cn=config (PasswordPolicyFactory.java:295PasswordPolicyFactory.java:214 PasswordPolicyFactory.java:153PasswordPolicyFactory.java:73 PasswordPolicyFactory.java:634PasswordPolicyFactory.java:69 PasswordPolicyConfigManager.java:313PasswordPolicyConfigManager.java:105 DirectoryServer.java:1594DirectoryServer.java:193 DirectoryServer.java:734 DirectoryServer.java:634RebuildIndex.java:262 RebuildIndex.java:222 TaskTool.java:291RebuildIndex.java:170 TaskTool.java:265 Utils.java:972 Utils.java:949RebuildIndex.java:80)

5. Start DS and rebuild indexes online and it works:

$ bin/start-ds$ bin/rebuild-index -b dc=example,dc=com --rebuildAll -p 4444 -D 'cn=directory manager' -w password -X

Rebuild Index task 20190103181526875 scheduled to start immediately[03/Jan/2019:18:15:26 +0000] severity="NOTICE" msgCount=0 msgID=org.opends.messages.backend-413 message="Rebuild Index task 20190103181526875 started execution"[03/Jan/2019:18:15:26 +0000] severity="NOTICE" msgCount=1 msgID=org.opends.messages.backend-370 message="The backend userRoot is now taken offline"[03/Jan/2019:18:15:26 +0000] severity="INFORMATION" msgCount=2 msgID=org.opends.messages.backend-410 message="JE backend 'userRoot' does not specify the number of cleaner threads: defaulting to 2 threads"[03/Jan/2019:18:15:26 +0000] severity="INFORMATION" msgCount=3 msgID=org.opends.messages.backend-411 message="JE backend 'userRoot' does not specify the number of lock tables: defaulting to 17"[03/Jan/2019:18:15:26 +0000] severity="NOTICE" msgCount=4 msgID=org.opends.messages.backend-537 message="Rebuild of all indexes started with 102 total entries to process"[03/Jan/2019:18:15:27 +0000] severity="NOTICE" msgCount=5 msgID=org.opends.messages.backend-528 message="The amount of free memory available to the import task is 1905947984 bytes. The number of phase one buffers required is 88 buffers"[03/Jan/2019:18:15:27 +0000] severity="NOTICE" msgCount=6 msgID=org.opends.messages.backend-520 message="Setting DB cache size to 33554432 bytes and phase one buffer size to 4194304 bytes"[03/Jan/2019:18:15:27 +0000] severity="NOTICE" msgCount=7 msgID=org.opends.messages.backend-540 message="Rebuild complete. Processed 102 entries in 0 seconds (average rate 390.8/sec)"[03/Jan/2019:18:15:27 +0000] severity="INFORMATION" msgCount=8 msgID=org.opends.messages.backend-410 message="JE backend 'userRoot' does not specify the number of cleaner threads: defaulting to 2 threads"[03/Jan/2019:18:15:27 +0000] severity="INFORMATION" msgCount=9 msgID=org.opends.messages.backend-411 message="JE backend 'userRoot' does not specify the number of lock tables: defaulting to 17"[03/Jan/2019:18:15:27 +0000] severity="NOTICE" msgCount=10 msgID=org.opends.messages.backend-513 message="The database backend userRoot containing 102 entries has started"[03/Jan/2019:18:15:27 +0000] severity="NOTICE" msgCount=11 msgID=org.opends.messages.backend-414 message="Rebuild Index task 20190103181526875 finished execution in the state Completed successfully"Rebuild Index task 20190103181526875 has been successfully completed[03/01/2019:18:15:27 +0000] category=SDK seq=0 severity=FINE msg=LdapClientImpl 'org.forgerock.opendj.ldap.LdapClientImpl@2f465398' is closing while 1 active connections remain

 

 