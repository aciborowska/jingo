OpenDJ. 2 servers replicated. Continuous modify rate for 2.7k per second to 1 server. After stopping server with bin/stop-ds the server does not stop.

Looking at jstack we are waiting for the "Change number indexer" to finish,

jstack:

"Change number indexer" prio=10 tid=0x00007f9f54048000 nid=0x18449 runnable [0x00007f9e7fdfc000]
   java.lang.Thread.State: RUNNABLE
        at java.io.RandomAccessFile.readBytes0(Native Method)
        at java.io.RandomAccessFile.readBytes(RandomAccessFile.java:350)
        at java.io.RandomAccessFile.read(RandomAccessFile.java:385)
        at java.io.RandomAccessFile.readFully(RandomAccessFile.java:444)
        at org.forgerock.opendj.ldap.ByteStringBuilder.append(ByteStringBuilder.java:522)
        at org.opends.server.replication.server.changelog.file.BlockLogReader.readNextRecord(BlockLogReader.java:326)
        at org.opends.server.replication.server.changelog.file.BlockLogReader.readRecord(BlockLogReader.java:253)
        at org.opends.server.replication.server.changelog.file.BlockLogReader.searchClosestBlockStartToKey(BlockLogReader.java:404)
        at org.opends.server.replication.server.changelog.file.BlockLogReader.seekToRecord(BlockLogReader.java:167)
        at org.opends.server.replication.server.changelog.file.LogFile$LogFileCursor.positionTo(LogFile.java:582)
        at org.opends.server.replication.server.changelog.file.Log$InternalLogCursor.positionTo(Log.java:1253)
        at org.opends.server.replication.server.changelog.file.Log$AbortableLogCursor.positionTo(Log.java:1499)
        at org.opends.server.replication.server.changelog.file.FileReplicaDBCursor.nextWhenCursorIsExhaustedOrNotCorrectlyPositionned(FileReplicaDBCursor.java:126)
        at org.opends.server.replication.server.changelog.file.FileReplicaDBCursor.next(FileReplicaDBCursor.java:120)
        at org.opends.server.replication.server.changelog.file.ReplicaCursor.next(ReplicaCursor.java:121)
        at org.opends.server.replication.server.changelog.file.CompositeDBCursor.addCursor(CompositeDBCursor.java:179)
        at org.opends.server.replication.server.changelog.file.CompositeDBCursor.recycleExhaustedCursors(CompositeDBCursor.java:135)
        at org.opends.server.replication.server.changelog.file.CompositeDBCursor.next(CompositeDBCursor.java:115)
        at org.opends.server.replication.server.changelog.file.DomainDBCursor.next(DomainDBCursor.java:43)
        at org.opends.server.replication.server.changelog.file.CompositeDBCursor.addCursor(CompositeDBCursor.java:179)
        at org.opends.server.replication.server.changelog.file.CompositeDBCursor.next(CompositeDBCursor.java:118)
        at org.opends.server.replication.server.changelog.file.MultiDomainDBCursor.next(MultiDomainDBCursor.java:43)
        at org.opends.server.replication.server.changelog.file.ECLMultiDomainDBCursor.next(ECLMultiDomainDBCursor.java:92)
        at org.opends.server.replication.server.changelog.file.ChangeNumberIndexer.moveForwardMediumConsistencyPoint(ChangeNumberIndexer.java:584)
        at org.opends.server.replication.server.changelog.file.ChangeNumberIndexer.run(ChangeNumberIndexer.java:472)


Full stack trace attached.

The "Change number indexer" is moving so suspect it continues to process.


[testuser@tomme opendj-systests]$ diff /tmp/j4.txt /tmp/j5.txt 
1c1
< 2015-06-29 16:22:46
---
> 2015-06-29 16:28:01
44,49c44,46
< 	at java.io.RandomAccessFile.readBytes0(Native Method)
< 	at java.io.RandomAccessFile.readBytes(RandomAccessFile.java:350)
< 	at java.io.RandomAccessFile.read(RandomAccessFile.java:385)
< 	at java.io.RandomAccessFile.readFully(RandomAccessFile.java:444)
< 	at org.forgerock.opendj.ldap.ByteStringBuilder.append(ByteStringBuilder.java:522)
< 	at org.opends.server.replication.server.changelog.file.BlockLogReader.readNextRecord(BlockLogReader.java:313)
---
> 	at java.io.RandomAccessFile.length(Native Method)
> 	at java.io.RandomAccessFile.skipBytes(RandomAccessFile.java:476)
> 	at org.opends.server.replication.server.changelog.file.BlockLogReader.readNextRecord(BlockLogReader.java:316)



[testuser@tomme opendj-systests]$ /usr/lib/jvm/jdk1.7.0_75/bin/jstack 99043 > /tmp/j6.txt
[testuser@tomme opendj-systests]$ diff /tmp/j5.txt /tmp/j6.txt
1c1
< 2015-06-29 16:28:01
---
> 2015-06-29 16:30:48
44,46c44,49
< 	at java.io.RandomAccessFile.length(Native Method)
< 	at java.io.RandomAccessFile.skipBytes(RandomAccessFile.java:476)
< 	at org.opends.server.replication.server.changelog.file.BlockLogReader.readNextRecord(BlockLogReader.java:316)
---
> 	at java.io.RandomAccessFile.readBytes0(Native Method)
> 	at java.io.RandomAccessFile.readBytes(RandomAccessFile.java:350)
> 	at java.io.RandomAccessFile.read(RandomAccessFile.java:385)
> 	at java.io.RandomAccessFile.readFully(RandomAccessFile.java:444)
> 	at org.forgerock.opendj.ldap.ByteStringBuilder.append(ByteStringBuilder.java:522)
> 	at org.opends.server.replication.server.changelog.file.BlockLogReader.readNextRecord(BlockLogReader.java:326)

