Found with OpenDJ 3.0.0 rev 143e0e9d336bb7b394a080c3196ab6adc909eba2

Scenario:


	Install and setup 2 replicated servers
	set a 2mins purge delay
	add entries to fill one file of the replicaDB (this forces a log rotation) and get the initial cookie from the first change in cn=changelog
	sleep during the purge delay
	perform a search based on the initial cookie and expect it to be outdated => it fails, changelog hasn't been purged.
	add some more entries to fill a second file
	sleep during the purge delay
	perform a search based on the initial cookie and expect it to be outdated => it finally works, changelog has been purged.



To sum up, from the tests we have performed in that configuration, it takes about twice the purge delay to be actually purged.

See script in attachment to help setting up everything.
After playing the script, you need to retrieve the cookie value with the following command:


${INSTANCE1}/opendj/bin/ldapsearch -h localhost -p 1389 -D "cn=myself" -w password -T -b "cn=changelog" --control "1.3.6.1.4.1.26027.1.5.4:false:;" "(objectclass=*)" changeLogCookie



the sleep for 120s and search with the previous cookie:


${INSTANCE1}/opendj/bin/ldapsearch -h localhost -p 1389 -D "cn=myself" -w password -T -b "cn=changelog" --control "1.3.6.1.4.1.26027.1.5.4:false:<initial cookie>" "(objectclass=*)" "*" changeinitiatorsname targetentryuuid changelogcookie



we expect to get:
Result Code:  53 (Unwilling to Perform)
The provided cookie is older than the start of historical in the server for the replicated domain : dc=com

but the problem is you need to wait for at least another 120 s for the file to be purged.