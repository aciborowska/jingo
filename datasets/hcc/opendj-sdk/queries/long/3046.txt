When the various tools run in offline mode they initialise some parts of the directory server in order to perform their tasks.

Usually the tool will exit when it has finished processing and the state of this environment is not a problem.

However, if the tool is used within another process then some initialised components may be left over.

After some of the changes relating to OPENDJ-2616, this includes the ads-truststore and admin data backends.

OpenAM embeds the RebuildIndex tool and when this finishes it leaves left over backends, this causes inconsistent behaviour on these backends when the DirectoryServer is then started in the same JVM.

Alternatively, a public method could be provided that OpenAM can call explicitly to perform the cleanup.