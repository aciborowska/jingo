Customer reported an issue where replication is completely aborted when trying to query cn=changelog database.

category=SYNC severity=FATAL_ERROR msgID=-1 msg=Error Trying to use the underlying database. The Replication Server is going to shut down(JE 4.1.6) Lock expired. Locker 619044304 -1_Worker Thread 12_ThreadLocker: waited for lock on database=draftcndb LockAddr:1866831260 node=4001391 type=READ grant=WAIT_NEW timeoutMillis=500 startTime=1307099369379 endTime=1307099369881
Owners: []
Waiters: []
(LockManager.java:608 LockManager.java:567 SyncedLockManager.java:75 LockManager.java:385 LockManager.java:272 BasicLocker.java:134 Locker.java:453 CursorImpl.java:2696 CursorImpl.java:2615 CursorImpl.java:2545 CursorImpl.java:1545 CursorImpl.java:1692 CursorImpl.java:1617 Cursor.java:1909 Cursor.java:1837 Cursor.java:900 DraftCNDB.java:289 DraftCNDbHandler.java:158 ECLServerHandler.java:597 ECLServerHandler.java:1064 ECLServerHandler.java:450 ...)


Looking at the DraftCNDB code, the error handling is pretty rough, doesn't take into account possible lock timeout and always shutdown the whole replication service.

We should have a better handling of errors in the access to the changelog, possibly returning busy or errors but keep replication active. 