This issue was originally found by the daily tests.

A test that was referencing cn=userRoot Storage,cn=monitor now fails as the entry no longer exists.

On Mac at least another test fails attempting to rebuild a degraded index, possibly leading to subsequent failures.


$ mvn clean -Ptest verify -Dexec.args="install_with_generated_data.bats admin-guide/indexing.bats"
...
[INFO] --- exec-maven-plugin:1.5.0:exec (run-tests) @ doc-tests ---
1..1
ok 1 install OpenDJ with generated entries
1..32
ok 1 before starting the server check index status
ok 2 startup
ok 3 enable index filter analysis
ok 4 perform unindexed searches
ok 5 grep access log for unindexed searches
ok 6 perform indexed searches
not ok 7 read index filter analysis
# (from function `check_expected_status' in file admin-guide/../bats_helper.bash, line 27,
#  in test file admin-guide/indexing.bats, line 137)
#   `check_expected_status "0" "$status"' failed
# Failed with exit status 32
# Output: # The LDAP search request failed: 32 (No Such Entry)
# # Additional Information:  Entry cn=userRoot Storage,cn=monitor does not exist in the "monitor" backend
# # Matched DN:  cn=monitor
ok 8 disable index filter analysis
ok 9 try unindexed search
ok 10 try indexed debugsearchindex
ok 11 try unindexed debugsearchindex
ok 12 enable SN approximate index
ok 13 replace generated data with Example LDIF
ok 14 list entries with ACIs
ok 15 get IDs of entries with ACIs
ok 16 search for Babs
ok 17 get IDs of entries with SN of Jensen
ok 18 search approximately for Babs
ok 19 get IDs of entries with SN approximately Jensen
ok 20 search cn for values starting with Barb
ok 21 get IDs of entries in substring index
ok 22 search sn for values greater than or equal to Winter
ok 23 create equality index
ok 24 create extensible matching rule index
ok 25 create JSON index
ok 26 create VLV index
ok 27 rebuild cn index online
ok 28 rebuild degraded indexes online
not ok 29 rebuild unused degraded index
# (from function `check_expected_status' in file admin-guide/../bats_helper.bash, line 27,
#  in test file admin-guide/indexing.bats, line 549)
#   `check_expected_status "0" "$status"' failed
# Failed with exit status 1
# Output: 
# The Backend Index could not be created due to a communications problem: Other:
# The attempt to apply the configuration add failed. The preliminary checks were
# all successful and the entry was added to the server configuration, but at
# least one of the configuration add listeners reported an error when attempting
# to apply the change: This storage is read-only.
not ok 30 verify cn index offline
# (from function `check_expected_status' in file admin-guide/../bats_helper.bash, line 27,
#  in test file admin-guide/indexing.bats, line 594)
#   `check_expected_status "0" "$status"' failed
# Failed with exit status 1
# Output: [07/10/2017:18:34:31 +0200] category=BACKEND seq=0 severity=FINE msg=JE backend 'userRoot' does not specify the number of cleaner threads: defaulting to 8 threads
# [07/10/2017:18:34:31 +0200] category=BACKEND seq=1 severity=FINE msg=JE backend 'userRoot' does not specify the number of lock tables: defaulting to 53
# An error occurred while attempting to perform index verification:  The
# database environment could not be opened:
# com.sleepycat.je.EnvironmentLockedException: (JE 7.4.5)
# /Users/mark/Documents/opendj-docs/doc-tests/target/bats/opendj/db/userRoot The
# environment cannot be locked for single writer access. ENV_LOCKED: The je.lck
# file could not be locked. Environment is invalid and must be closed.
not ok 31 change index-entry-limit settings
# (from function `check_expected_status' in file admin-guide/../bats_helper.bash, line 27,
#  in test file admin-guide/indexing.bats, line 599)
#   `check_expected_status "0" "$status"' failed
# Failed with exit status 98
# Output: The Directory Server could not acquire an exclusive lock on file /Users/mark/Documents/opendj-docs/doc-tests/target/bats/opendj/locks/server.lock: The exclusive lock requested for file /Users/mark/Documents/opendj-docs/doc-tests/target/bats/opendj/locks/server.lock was not granted, which indicates that another process already holds a shared or exclusive lock on that file. This generally means that another instance of this server is already running
ok 32 shutdown


