If you build a patch for OpenDJ, it will update the DynamicConstants class with a new VCS revision string, ie the git commit hash.

The server will fail to start up:


[08/Apr/2016:11:07:53 +0100] category=CORE severity=NOTICE msgID=org.opends.messages.core.139 msg=The Directory Server has sent an alert notification generated by class org.opends.server.core.DirectoryServer (alert type org.opends.server.DirectoryServerShutdown, alert ID org.opends.messages.core-141): The Directory Server has started the shutdown process. The shutdown was initiated by an instance of class org.opends.server.core.DirectoryServer and the reason provided for the shutdown was An error occurred while trying to start the Directory Server: The OpenDJ binary version '3.0.0.15ec87e764ad6b87fe2684b2eca6d9d316bcc7e3' does not match the installed version '3.0.0.185acee3ba68d8da1782007eebacb3701dc996d6'. Please run upgrade before continuing



This is due to checkVersionMismatch() incorrectly converting both BuildVersions to strings, and comparing the strings. It should use BuildVersion.equals(). The copy of BuildVersion in the opendj-config module needs a similar fix.

However after you fix that, an additional problem is that the schema backend no longer starts up, as it fails to open the concatenated schema file. The on disk file is called "schema.ldif.<build revision>" and the patched code tries to open "schema.ldif.<patch revision>".

Running the upgrade tool as suggested "helps", but it removes the patches. Restoring them breaks the schema backend again.