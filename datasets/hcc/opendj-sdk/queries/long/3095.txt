Found with upgrade from OpenDJ 3.0.0 to 4.0.0 rev 4.0.0.1aa67b085c51f71b565baece6acfc8845c024641

We setup 2 servers, import some data and enable replication.
We stop one server,  upgrade it and start it again.
We do the same for the second server. It looks ok but there are errors in second server logs:


[08/Jun/2016:16:25:04 +0200] category=SYNC severity=ERROR msgID=org.opends.messages.replication.67 msg=Could not replay operation ModifyOperation(connID=-1, opID=54, dn=cn=schema) with ChangeNumber 000001553066c76f11ab00000001 error Constraint Violation There should be no warnings on the schema, but instead got 1 warnings: Validation of object class definition ( 1.3.6.1.4.1.36733.2.1.2.15 NAME 'ds-cfg-http-connection-handler' SUP ds-cfg-connection-handler STRUCTURAL MUST ds-cfg-listen-port MAY ( ds-cfg-listen-address $ ds-cfg-keep-stats $ ds-cfg-use-tcp-keep-alive $ ds-cfg-use-tcp-no-delay $ ds-cfg-allow-tcp-reuse-address $ ds-cfg-max-request-size $ ds-cfg-num-request-handlers $ ds-cfg-use-ssl $ ds-cfg-ssl-client-auth-policy $ ds-cfg-ssl-cert-nickname $ ds-cfg-accept-backlog $ ds-cfg-key-manager-provider $ ds-cfg-trust-manager-provider $ ds-cfg-ssl-protocol $ ds-cfg-ssl-cipher-suite $ ds-cfg-max-blocked-write-time-limit $ ds-cfg-buffer-size $ ds-cfg-config-file $ ds-cfg-authentication-required $ ds-cfg-max-concurrent-ops-per-connection ) X-ORIGIN 'OpenDJ Directory Server' ) failed and will be removed from the schema: The object class "ds-cfg-http-connection-handler" specifies the optional attribute type "ds-cfg-authentication-required" which is not defined in the schema ...



Then we uninstall both servers.
Second server uninstallation throws a NPE:


${INSTANCE3}/opendj/uninstall --cli -n --server-libraries --databases --backup-files --ldif-files --forceOnError

This server is configured to replicate some of its base DNs.  There was an
error retrieving the references to it in the replicated servers.  Note that to
be able to remove remote references you must provide Global Administrator
credentials using the --adminUID and --bindPassword (or --bindPasswordFile)
options.
Continuing uninstall as we are on force on error mode.

The error found was:
An unexpected error occurred.  Details: java.lang.NullPointerException

Stopping Directory Server ..... Done.
Deleting Files under the Installation Path ..... Done.

The Uninstall Completed Successfully.



script in attachment to reproduce