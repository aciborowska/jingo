The upgrade from 2.x to 3.5.0 (or 4.0.0) fails during the post upgrade index rebuilds with a similar DirectoryException as seen in OPENDJ-2548.



>>>> Performing post upgrade tasks

  Rebuilding all indexes..............................................   FAIL
  [!] An error occurred during post upgrade task. Process aborted. Please
  check log for further details





[13/10/2016:09:11:54 -0600] category=TOOLS seq=411 severity=SEVERE msg=An error occurred while attempting to perform index rebuild:  org.opends.server.types.DirectoryException: Unable to decode the provided object class set because it used an undefined token 14 / CompressedSchema.java:261 / Entry.java:3356 / Entry.java:3302 / ID2Entry.java:223 / ID2Entry.java:149 / ID2Entry.java:108 / ID2Entry.java:390 / OnDiskMergeImporter.java:815 / Executors.java:511 / FutureTask.java:266 / ThreadPoolExecutor.java:1142 / ThreadPoolExecutor.java:617 / Thread.java:745 (id=null--1)
An error occurs during the rebuild index process in dc=example,dc=com, rebuild index(es) aborted.
[13/10/2016:09:11:54 -0600] category=TOOLS seq=412 severity=WARNING msg=An error occurred during post upgrade task. Process aborted. Please check log for further details



Workaround:  Export/Import the backends after the upgrade failure.