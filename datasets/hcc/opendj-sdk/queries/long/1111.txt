When there is an invalid schema file under config/schema (see attachment), then upgrade will fail with an NPE, like this:

java.lang.NullPointerException
        at org.opends.server.tools.upgrade.UpgradeUtils.updateConfigUpgradeSchemaFile(UpgradeUtils.java:755)
        at org.opends.server.tools.upgrade.UpgradeTasks$8.perform(UpgradeTasks.java:541)
        at org.opends.server.tools.upgrade.Upgrade.perform(Upgrade.java:465)
        at org.opends.server.tools.upgrade.Upgrade.upgrade(Upgrade.java:410)
        at org.opends.server.tools.upgrade.UpgradeCli.run(UpgradeCli.java:370)
        at org.opends.server.tools.upgrade.UpgradeCli.main(UpgradeCli.java:149)


Further debugging showed that reader.hasNext() has most likely failed to read the entry (since it's an invalid LDIF file) with a DecodeException, and as a result the finally block has been reached. There the writer object was actually null, and there is the NPE.
Proposed solution would be:

	use closeIfNotNull mechanism to close resources
	catch DecodeException and deal with it specifically if some schema files can be skipped.

