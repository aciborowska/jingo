Found with OpenDJ 4.0.0 rev b93c8bf6f5bb9560e9ba219eb6be1ea9bb12f3be

We setup 2 servers with data and enable replication.
We enable the property to encrypt the changelog of both servers.
We add a new entry on first server and check the entry is replicated.

Then we query the changelog and get the following error:


SEARCH operation failed
Result Code:  53 (Unwilling to Perform)
Additional Information:  An error occurred when retrieving attribute value for attribute 'hasSubordinates' for entry DN 'cn=changelog' in changelog backend : ChangelogException: Could not decode a record from data read in log file 'java.io.RandomAccessFile@35195487' (BlockLogReader.java:249 BlockLogReader.java:195 LogFile.java:610 Log.java:1244 Log.java:1508 FileReplicaDBCursor.java:98 ReplicaCursor.java:111 CompositeDBCursor.java:170 DomainDBCursor.java:95 CompositeDBCursor.java:113 DomainDBCursor.java:32 CompositeDBCursor.java:170 MultiDomainDBCursor.java:77 CompositeDBCursor.java:113 MultiDomainDBCursor.java:32 ChangelogBackend.java:336 ChangelogBackend.java:1435 ChangelogBackend.java:1422 ChangelogBackend.java:953 ChangelogBackend.java:522 LocalBackendSearchOperation.java:224 ...)



script in attachement to reproduce the issue