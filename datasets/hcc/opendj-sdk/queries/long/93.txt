While attempting to upgrade an OpenDS 2.2.0 installation to OpenDJ 2.4.1, the updater stops after printing the following

Initializing Upgrade ..... Done.
Calculating Schema Customizations ..... Done.
Calculating Configuration Customizations ..... Done.
Backing Up Files ..... Done.
Upgrading Components ..... Done.
Preparing Customizations ..... Done.
Applying Configuration Customizations ..... Done.
Verifying Upgrade .....

The output from the log file says that java.exe is not found or not compatible (can't find the exact error right now).

I narrowed that down to the fact that stop-ds.bat in OpenDJ.2.4.1 clears the PATH environment variable (relies on OPENDS_JAVA_HOME instead?)

After removing that line from stop-ds.bat this error occurs (had to modify a few more files to get the text):

INFO: server: C:\OpenDS-2.2.0\bat>"C:\Progra~2\Java\jre6\bin\java.exe" -client -Xms8m org.opends.server.tools.InstallDS -t  2>&1 
INFO: server: Exception in thread "main" java.lang.NoSuchMethodError: org.opends.quicksetup.util.Utils.getInstancePathFromClasspath(Ljava/lang/String;)Ljava/lang/String;
INFO: server: 	at org.opends.server.tools.InstallDSArgumentParser.getDefaultConfigFile(InstallDSArgumentParser.java:756)
INFO: server: 	at org.opends.server.tools.InstallDSArgumentParser.initializeArguments(InstallDSArgumentParser.java:135)
INFO: server: 	at org.opends.server.tools.InstallDS.execute(InstallDS.java:352)
INFO: server: 	at org.opends.server.tools.InstallDS.mainCLI(InstallDS.java:335)
INFO: server: 	at org.opends.server.tools.InstallDS.main(InstallDS.java:261)
