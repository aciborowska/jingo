 I was adding a new index with TTL (createTimestamp, equality, ttl enabled), and when I tried to rebuild the index, the rebuild-index failed with an UNWILLING TO PERFORM error.

Same error with the master branch.

$ rebuild-index -p 4444 -D cn=directory\ manager -w secret12 -b dc=example,dc=com -i cn -X
 Rebuild Index task 20180522210657742 scheduled to start immediately
 [22/May/2018:21:06:57 +0200] severity="NOTICE" msgCount=0 msgID=org.opends.messages.backend-413 message="Rebuild Index task 20180522210657742 started execution"
 [22/May/2018:21:06:57 +0200] severity="ERROR" msgCount=1 msgID=null--1 message="Unwilling to Perform: The task could not disable a backend: ds-cfg-backend-id=userRoot,cn=Backends,cn=config"
 [22/May/2018:21:06:57 +0200] severity="NOTICE" msgCount=2 msgID=org.opends.messages.backend-414 message="Rebuild Index task 20180522210657742 finished execution in the state Stopped by error"
 [22/05/2018:21:06:58 +0200] category=SDK seq=0 severity=FINE msg=LdapClientImpl 'org.forgerock.opendj.ldap.LdapClientImpl@6e509ffa' is closing while 1 active connections remain
 Rebuild Index task 20180522210657742 did not complete successfully

So, I started to do things in different steps:

First create the createTimestamp index with equality, rebuild index. And it worked.

Then I tried to enable TTL on that index. And it failed:

The Backend Index could not be modified because of the following reason:
   Unwilling to Perform: Entry ds-cfg-attribute=createtimestamp,cn=Index,ds-cfg-backend-id=userRoot,cn=Backends,cn=config
   cannot be modified because one of the configuration change listeners registered for that entry rejected the change:
   The time-to-live (TTL) feature can only be enabled for generalized time ordering indexes

Which put me on the right issue: 

Using dsconfig interactive, I can create a new index with TTL enabled, but invalid configuration. And once I have the invalid configuration, I cannot rebuild any index as it fails to disable the backend.

Easy Steps to reproduce:

Setup default DS with 20 users.

$ dsconfig create-backend-index --backend-name userRoot --index-name modifytimestamp --set ttl-enabled:true --set index-type:equality --hostname lpmbp.local --port 4444 --bindDn cn=Directory\ Manager --bindPassword secret12 --trustAll --no-prompt

The Backend Index was created successfully

$ rebuild-index -p 4444 -D cn=directory\ manager -w secret12 -b dc=example,dc=com -i cn -X
 Rebuild Index task 20180522212754623 scheduled to start immediately
 [22/May/2018:21:27:54 +0200] severity="NOTICE" msgCount=0 msgID=org.opends.messages.backend-413 message="Rebuild Index task 20180522212754623 started execution"
 [22/May/2018:21:27:54 +0200] severity="ERROR" msgCount=1 msgID=null--1 message="Unwilling to Perform: The task could not disable a backend: ds-cfg-backend-id=userRoot,cn=Backends,cn=config"
 [22/May/2018:21:27:54 +0200] severity="NOTICE" msgCount=2 msgID=org.opends.messages.backend-414 message="Rebuild Index task 20180522212754623 finished execution in the state Stopped by error"
 [22/05/2018:21:27:55 +0200] category=SDK seq=0 severity=FINE msg=LdapClientImpl 'org.forgerock.opendj.ldap.LdapClientImpl@6e509ffa' is closing while 1 active connections remain
 Rebuild Index task 20180522212754623 did not complete successfully

 

 

 

 