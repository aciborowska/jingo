Found with rev (d370c5695e1)

We set up a server with some users.

When querying ldapsearch with verbose option, it triggers an exception:


./DJ1/opendj/bin/ldapsearch -h nameserver.example.com -p 1389 -D "cn=myself" -w password -b "ou=ldapsearch,o=clu tests,dc=example,dc=com" --verbose "uid=user.10*" 

# [14/09/2018:10:35:05 +0200] category=PROTOCOL seq=0 severity=FINEST msg=ENCODE LDAP BIND REQUEST(messageID=1, auth=0x80, request=BindRequest(version=3, name=cn=myself, authenticationType=simple, password=******, controls=[]))
# [14/09/2018:10:35:05 +0200] category=PROTOCOL seq=1 severity=FINEST msg=WRITE ASN.1 START SEQUENCE(type=0x30)
# [14/09/2018:10:35:05 +0200] category=PROTOCOL seq=2 severity=FINEST msg=WRITE ASN.1 INTEGER(type=0x2, length=1, value=1)
# [14/09/2018:10:35:05 +0200] category=PROTOCOL seq=3 severity=FINEST msg=WRITE ASN.1 START SEQUENCE(type=0x60)
# [14/09/2018:10:35:05 +0200] category=PROTOCOL seq=4 severity=FINEST msg=WRITE ASN.1 INTEGER(type=0x2, length=1, value=3)
# [14/09/2018:10:35:05 +0200] category=PROTOCOL seq=5 severity=FINEST msg=WRITE ASN.1 OCTETSTRING(type=0x4, length=9, value=cn=myself)
# [14/09/2018:10:35:05 +0200] category=PROTOCOL seq=6 severity=FINEST msg=WRITE ASN.1 OCTETSTRING(type=0x80, length=8)
# [14/09/2018:10:35:05 +0200] category=PROTOCOL seq=7 severity=FINEST msg=WRITE ASN.1 END SEQUENCE(length=0)

....


# [14/09/2018:10:35:05 +0200] category=PROTOCOL seq=1433 severity=FINEST msg=WRITE ASN.1 END SEQUENCE(length=0)
java.util.logging.ErrorManager: 5
java.lang.RuntimeException: java.io.IOException: Stream closed
	at com.forgerock.opendj.ldap.tools.LdapTool.writeLdifComment(LdapTool.java:49)
	at com.forgerock.opendj.ldap.tools.LdapTool.report(LdapTool.java:67)
	at com.forgerock.opendj.ldap.tools.LdapSearch.report(LdapSearch.java:88)
	at com.forgerock.opendj.ldap.tools.LdapTool.logVerboseMessage(LdapTool.java:76)
	at com.forgerock.opendj.cli.Tool$1.publish(Tool.java:836)
	at java.util.logging.Logger.log(Logger.java:738)
	at org.slf4j.impl.JDK14LoggerAdapter.log(JDK14LoggerAdapter.java:582)
	at org.slf4j.impl.JDK14LoggerAdapter.debug(JDK14LoggerAdapter.java:178)
	at org.slf4j.helpers.MarkerIgnoringBase.debug(MarkerIgnoringBase.java:71)
	at org.forgerock.i18n.slf4j.LocalizedLogger.debug(LocalizedLogger.java:880)
	at org.forgerock.opendj.ldap.LdapClientImpl.close(LdapClientImpl.java:258)
	at com.forgerock.opendj.cli.LdapClientProvider.close(LdapClientProvider.java:1111)
	at com.forgerock.opendj.ldap.tools.LdapSearch.runLdapSearch(LdapSearch.java:401)
	at com.forgerock.opendj.ldap.tools.LdapSearch.run(LdapSearch.java:131)
	at com.forgerock.opendj.cli.Utils.runTool(Utils.java:965)
	at com.forgerock.opendj.cli.Utils.runToolAndExit(Utils.java:947)
	at com.forgerock.opendj.ldap.tools.LdapSearch.main(LdapSearch.java:97)
Caused by: java.io.IOException: Stream closed
	at java.io.BufferedWriter.ensureOpen(BufferedWriter.java:116)
	at java.io.BufferedWriter.write(BufferedWriter.java:221)
	at java.io.Writer.write(Writer.java:157)
	at java.io.Writer.append(Writer.java:227)
	at org.forgerock.opendj.ldif.AbstractLdifWriter$LdifWriterOutputStreamImpl.print(AbstractLdifWriter.java:133)
	at org.forgerock.opendj.ldif.AbstractLdifWriter.writeComment0(AbstractLdifWriter.java:179)
	at org.forgerock.opendj.ldif.LdifEntryWriter.writeComment(LdifEntryWriter.java:236)
	at com.forgerock.opendj.ldap.tools.LdapTool.writeLdifComment(LdapTool.java:47)
	... 16 more



To reproduce:



./run-pybot.py -n -s clu_group.LdapSearchDJ -t *verbose* opendj

