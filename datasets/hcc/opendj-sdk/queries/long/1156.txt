See attached demo application for example code, execution should be done:

	start OpenDJ
	start app
	shut down OpenDJ



After this you should see an NPE in the logs:

java.lang.NullPointerException
	at com.forgerock.opendj.util.ReferenceCountedObject$Reference.get(ReferenceCountedObject.java:62)
	at com.forgerock.opendj.ldap.LDAPConnectionFactoryImpl.getConnectionAsync(LDAPConnectionFactoryImpl.java:266)
	at com.forgerock.opendj.ldap.LDAPConnectionFactoryImpl.getConnection(LDAPConnectionFactoryImpl.java:256)
	at org.forgerock.opendj.ldap.LDAPConnectionFactory.getConnection(LDAPConnectionFactory.java:142)
	at org.forgerock.opendj.ldap.HeartBeatConnectionFactory.getConnection(HeartBeatConnectionFactory.java:1237)
	at org.forgerock.opendj.ldap.AuthenticatedConnectionFactory.getConnection(AuthenticatedConnectionFactory.java:166)
	at org.forgerock.opendj.ldap.AbstractLoadBalancingAlgorithm$MonitoredConnectionFactory.getConnection(AbstractLoadBalancingAlgorithm.java:79)
	at org.forgerock.opendj.ldap.LoadBalancer.getConnection(LoadBalancer.java:53)



Another interesting part of this problem is that the LBEventListener#handleConnectionFactoryOffline method was never actually invoked.