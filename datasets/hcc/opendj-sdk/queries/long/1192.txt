In some recent testing of the OpenAM CTS I saw the following errors:


 [21/Aug/2013:16:08:25 +0100] category=SYNC severity=MILD_ERROR msgID=14876739 msg=Could not replay operation ModifyOperation(connID=-1, opID=32535, dn=coreTokenId=-4282364212813318290,ou=famrecords,ou=openam-session,ou=tokens,dc=config,dc=test,dc=forgerock,dc=com) with ChangeNumber 00000140a16b41d76ee200003dd8 error No Such Attribute Entry coreTokenId=-4282364212813318290,ou=famrecords,ou=openam-session,ou=tokens,dc=config,dc=test,dc=forgerock,dc=com cannot be modified because the attempt to update attribute coreTokenObject would have removed one or more values from the attribute that were not present:  {"clientDomain":"dc=config.....



Replayed modify requests should always succeed unless the entry has been deleted. We should investigate whether this error is benign or not. It could be benign if the replay thread correctly detects the error, adjusts the modify operation accordingly, and replays it. I suspect that this is not the case though.

One possible solution could be to use the permissive modify request control.

Edit by JNR:

The message coming in the issue description has the following origins:
Lower level error:
CoreMessages.ERR_MODIFY_DELETE_MISSING_VALUES used in LocalBackendModifyOperation.processInitialDeleteSchema(Attribute)

Higher level error:
ReplicationMessages.ERR_ERROR_REPLAYING_OPERATION used in LDAPReplicationDomain.solveNamingConflict(ModifyOperation, ModifyMsg)