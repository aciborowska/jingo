As a follow up of our stress testing of the new proxy distribution mechanism, I ran some perf comparison tests *rate tools through the proxy vs. directly on the directory server.
On authrate and searchrate we saw a significant difference in throughput between using the proxy or not, and should investigate if this can be tuned in configuration, or is a problem in the proxy.

The setup used to get the appended results:
machine1 (AWS m4.4xlarge):
SDK as a client for the * rate tools
PROXY with static discovery mechanism, proxy_backend with 1 shard pointing to the DJ instance

machine2 (AWS m4.4xlarge):

DJ with default configuration, 100k auto-gen entries

Commands used:


authrate -h ip-172-31-46-117.us-east-2.compute.internal -p 1392 -D "uid=user.{1},ou=People,o=example" -w password -d 300 -b o=example -S -f -B 60 -c 40 -i 3 -g "rand(0,99999)"
searchrate -h ip-172-31-46-117.us-east-2.compute.internal -p 1392 -D "cn=proxy,o=example" -w password -d 300 -b uid=user.{1},ou=People,o=example -S -F -B 60 -c 40 -i 3 -g "rand(0,99999)" -s base "(objectClass=*)"
searchrate -h ip-172-31-46-117.us-east-2.compute.internal -p 1392 -D "cn=proxy,o=example" -w password -d 300 -b o=example -S -F -B 60 -c 40 -i 3 -g "rand(0,99999)" -s sub "(uid=user.{1})"
searchrate -h ip-172-31-46-117.us-east-2.compute.internal -p 1392 -d 300 -b o=example -S -F -B 60 -c 40 -i 3 -g "rand(0,99999)" -s sub "(uid=user.{1})"

Approx results (full graphs apended):


authrate; ~78k; ~48k
binded searchrate; ~75k; ~37k
binded searchrate (base scope with specific dns); ~73k; ~37k
anonymous searchrate; ~74k; ~38k


System metrics for the proxy server also included (authrate/searchrate tests are the first 4 spikes)

 

 