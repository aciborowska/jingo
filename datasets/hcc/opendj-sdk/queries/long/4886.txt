The issue occurs when a path to key-store-pin is changed before upgrade from older versions (< 6.0.0). to latest 6.0.0-SNAPSHOT (rev 96ddbdf6062)

For instance let's have a keystore and keystore.pin files under /path/to/ds/certs/ .

As first change the key manager provider:

/path/to/ds/bin/dsconfig -h pyforge.example.com -p 4444 -D "cn=Directory Manager" -w password -X set-key-manager-provider-prop --provider-name "JKS" --set key-store-pin-file:certs/keystore.pin --set key-store-file:certs/keystore -n

After stop DS, do an upgrade and start the server

/path/to/ds/bin/start-ds
[14/Mar/2018:12:04:20 +0100] category=CORE severity=NOTICE msgID=134 msg=ForgeRock Directory Services 6.0.0-SNAPSHOT (build 20180314004404Z, revision number 96ddbdf6062dd70b3ed26fdb12c9925ef747cca3) starting up
 
[14/Mar/2018:12:04:21 +0100] category=JVM severity=NOTICE msgID=21 msg=Installation Directory: /path/to/ds

[14/Mar/2018:12:04:21 +0100] category=JVM severity=NOTICE msgID=23 msg=Instance Directory: /path/to/ds

[14/Mar/2018:12:04:21 +0100] category=JVM severity=NOTICE msgID=17 msg=JVM Information: 1.8.0_161-b12 by Oracle Corporation, 64-bit architecture, 3707764736 bytes heap size 

[14/Mar/2018:12:04:21 +0100] category=JVM severity=NOTICE msgID=18 msg=JVM Host: ondrej.fuchsik, running Linux 4.13.0-31-generic amd64, 16678371328 bytes physical memory size, number of processors available 8 

[14/Mar/2018:12:04:21 +0100] category=JVM severity=NOTICE msgID=19 msg=JVM Arguments: "-Dorg.opends.server.scriptName=start-ds" 

[14/Mar/2018:12:04:21 +0100] category=CORE severity=NOTICE msgID=139 msg=The Directory Server has sent an alert notification generated by class org.opends.server.core.DirectoryServer (alert type org.opends.server.DirectoryServerShutdown, alert ID org.opends.messages.core-141): The Directory Server has started the shutdown process. The shutdown was initiated by an instance of class org.opends.server.core.DirectoryServer and the reason provided for the shutdown was An error occurred while attempting to bootstrap the Directory Server: An error occurred while trying to decode the managed object configuration entry cn=PKCS12,cn=Key Manager Providers,cn=config: The File Based Key Manager Provider could not be decoded due to the following reason: The configuration expression "&{file:config/keystore.pin}" could not be resolved for the property "key-store-pin" : File "/path/to/ds/config/keystore.pin" does not exist or is a directory, content of the file cannot be read 

[14/Mar/2018:12:04:21 +0100] category=CORE severity=NOTICE msgID=203 msg=The Directory Server is now stopped 

In the error message there is a wrong value of key-store-pin property:

The configuration expression "&{file:config/keystore.pin}" could not be resolved for the property "key-store-pin" : File "/path/to/ds/config/keystore.pin"

This file really doesn't exist, however the value should be 

&{file:certs/keystore.pin} instead of &{file:config/keystore.pin}

 