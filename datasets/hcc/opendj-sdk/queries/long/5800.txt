For stress testing the write distribution, we use a fake ldap server that responds with a configurable throughput (for add/modify/search with specific dn) or instantly (for bind/unbind/delete/search on baseDN/rootDSE).

When running addrate against the proxy (connected through the distribution backend to the fake server), the proxy very soon disconnects from the fake server, and for 210s, all the addrate operations fail with "No operational connection factories available". Also we see this warning in the errors log:


[01/Dec/2018:11:42:56 +0100] category=BACKEND severity=WARNING msgID=632 msg=The server 'comte.internal.forgerock.com:1390' for proxy backend 'proxyRoot' is unavailable. The last failure that prevented the server from being used was: Operations Error: Bind or Start TLS operation in progress
[01/Dec/2018:11:42:56 +0100] category=BACKEND severity=NOTICE msgID=631 msg=The server 'comte.internal.forgerock.com:1390' for proxy backend 'proxyRoot' is available and will be used for proxying requests
[01/Dec/2018:11:42:56 +0100] category=BACKEND severity=WARNING msgID=632 msg=The server 'comte.internal.forgerock.com:1390' for proxy backend 'proxyRoot' is unavailable. The last failure that prevented the server from being used was: Operations Error: Bind or Start TLS operation in progress
[01/Dec/2018:11:43:40 +0100] category=BACKEND severity=WARNING msgID=611 msg=Proxy backend 'proxyRoot' could not discover remote servers capabilities: Connect Error: No operational connection factories available
[01/Dec/2018:11:43:56 +0100] category=BACKEND severity=NOTICE msgID=631 msg=The server 'comte.internal.forgerock.com:1390' for proxy backend 'proxyRoot' is available and will be used for proxying requests

After that the connection goes back to normal and the rest of the addrate is OK.

Note the same test is OK if we use normal proxy backend instead of distribution.

Cmd to reproduce:


./run-pybot.py -c stress -s proxy.WriteScalability -v DJ

