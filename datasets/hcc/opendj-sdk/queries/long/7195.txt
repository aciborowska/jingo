We set up DS1 and DS2 on one side and RS1 RS2 on the other side and configured this as a split DS RS topology.
Then we set up a proxy configured with RS1 and a group id.

It seems that it can't find the servers to balance to:


proxy setup, localhost:4447 being RS1:

Users/carole.forel/wks/pyforge/results/20200513-160339/proxy_group/ReplicationDiscovery/PROXY1/opendj/setup --profile ds-proxy-server --set ds-proxy-server/rsConnectionSecurity:ssl --set ds-proxy-server/bootstrapReplicationServer:"localhost:4447" --set ds-proxy-server/primaryGroupId:"1"  -Z 1638  -h localhost -p 1391 -D "uid=admin" -w password --deploymentKey AI1QLGYmsSzDRjKDmQZu7l9sAD10aA5CBVN1bkVDC24LTccCYcFwGw --deploymentKeyPassword keypassword --adminConnectorPort 4446 --monitorUserDn "uid=Monitor" --monitorUserPassword password  -O

disable use-sasl-external:
/Users/carole.forel/wks/pyforge/results/20200513-160339/proxy_group/ReplicationDiscovery/PROXY1/opendj/bin/dsconfig --offline set-service-discovery-mechanism-prop --mechanism-name "Replication Service Discovery Mechanism" --set use-sasl-external:false --set bind-dn:uid=admin --set bind-password:password -n

/Users/carole.forel/wks/pyforge/results/20200513-160339/proxy_group/ReplicationDiscovery/PROXY1/opendj/bin/dsconfig --offline set-backend-prop --backend-name "proxyRoot" --set use-sasl-external:false --set proxy-user-dn:cn=proxy,dc=com --set proxy-user-password:password -n

Proxy starts, it is not discovering other servers:

[13/May/2020:16:07:13 +0200] category=CORE severity=NOTICE msgID=139 msg=The Directory Server has sent an alert notification generated by class org.opends.server.core.DirectoryServer (alert type org.opends.server.DirectoryServerStarted, alert ID org.opends.messages.core-135): The Directory Server has started successfully
[13/May/2020:16:07:13 +0200] category=CORE severity=WARNING msgID=766 msg=Settings for Replica 'dn: ds-mon-server-id=dj1,cn=servers,cn=topology,cn=monitor
ds-mon-server-id: dj1
ds-mon-group-id: 1
ds-mon-process-id: 03a01511-4d04-4e61-89fc-91e42bbc344a
ds-mon-last-seen: 20200513140637.034Z
ds-mon-replication-protocol-version: -1
ds-mon-replication-domain: dc=com
objectClass: top
objectClass: ds-monitor
objectClass: ds-monitor-topology-server

' do not allow connections for replication server group 'Replication Service Discovery Mechanism'
[13/May/2020:16:07:13 +0200] category=CORE severity=WARNING msgID=760 msg=Replication server 'localhost:4447' references server 'ds-mon-server-id=dj1,cn=servers,cn=topology,cn=monitor' that could not be parsed correctly; the definition will be skipped
[13/May/2020:16:07:14 +0200] category=BACKEND severity=NOTICE msgID=620 msg=Remote servers changed for the proxy backend 'proxyRoot'. The proxy was using: primary servers=[], secondary servers=[]; and it will now be using: primary servers=[localhost:1639], secondary servers=[]
[13/May/2020:16:07:14 +0200] category=BACKEND severity=WARNING msgID=613 msg=Proxy backend 'proxyRoot' cannot failover: only primary servers have been discovered via the service discovery mechanism '[Replication Service Discovery Mechanism]'. Primary servers are [localhost:1639]
[13/May/2020:16:07:14 +0200] category=BACKEND severity=WARNING msgID=624 msg=Proxy backend 'proxyRoot' cannot register itself against base DN uid=admin because this base DN is already registered against backend 'rootUser'
[13/May/2020:16:07:14 +0200] category=BACKEND severity=WARNING msgID=624 msg=Proxy backend 'proxyRoot' cannot register itself against base DN uid=Monitor because this base DN is already registered against backend 'monitorUser'
[13/May/2020:16:07:14 +0200] category=BACKEND severity=NOTICE msgID=621 msg=Proxy backend 'proxyRoot' automatically registered itself against the base DNs [uid=admin, dc=com, uid=Monitor]. It was previously registered against the base DNs []




To reproduce:

./run-pybot.py -nvs proxy_group.ReplicationDiscovery -t *verify* opendj

