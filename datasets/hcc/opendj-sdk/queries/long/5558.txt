The LdapUrl.valueOf() method does not correctly parse IPv6 addresses.



LdapUrl foo = LdapUrl.valueOf("ldap://[2001:470:1f09:8e7:95ef:465a:8ea3:792e]/");



Fails with:


Exception in thread "main" org.forgerock.i18n.LocalizedIllegalArgumentException: The provided string "ldap://[2001:470:1f09:8e7:95ef:465a:8ea3:792e]/" cannot be decoded as an LDAP URL because the port number portion 470:1f09:8e7:95ef:465a:8ea3:792e] cannot be decoded as an integer



Note the server's LDAPURL.decode() method calls HostPort.valueOf() which seems to do the right thing with IPv6 addresses.