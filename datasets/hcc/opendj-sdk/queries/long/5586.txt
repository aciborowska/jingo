We hit following error in full run tests on linux with upgraded proxy instance from 5.5.0 to latest snapshot of 6.5.0 rev. (b092df69eb5) and jdk11.

To reproduce following issue run test framework:


# please make sure the java_home points to jdk11 in config/config.cfg default section
run-pybot.py -s proxy_group.upgrade -v opendj


Used topology:

One proxy server (version 5.5.0) - PROXY1

Two directory servers behind proxy (version 5.5.0) - DJ1, DJ2.

Steps:

	On PROXY1 create new service discovery mechanism `myservice` with DJ1 as primary server
	On PROXY1 create new backend `testupgrade`  using service discovery mechanism from point n.1
	Upgrade PROXY1 to 6.5.0
	Export data from DJ1
	Check the export task from point 5. by manage-tasks
	
		At this point we hit following error:
		
			

STDOUT:
Error connecting to the directory server: 'Cannot send the simple bind request: SSLProtocolException(Read timed out)'. Verify that the connection options are correct and that the server is running

		
		
	
	




	
	
		
		
			

STDERR:
java.net.SocketException: Socket is closed at java.base/java.net.Socket.setSoTimeout(Socket.java:1137) at java.base/sun.security.ssl.BaseSSLSocketImpl.setSoTimeout(BaseSSLSocketImpl.java:637) at java.base/sun.security.ssl.SSLSocketImpl.setSoTimeout(SSLSocketImpl.java:73) at org.opends.server.tools.LDAPConnection.connectToHost(LDAPConnection.java:320) at org.opends.server.util.cli.LDAPConnectionArgumentParser.connect(LDAPConnectionArgumentParser.java:260) at org.opends.server.util.cli.LDAPConnectionArgumentParser.connect(LDAPConnectionArgumentParser.java:218) at org.opends.server.tools.ManageTasks.process(ManageTasks.java:203) at org.opends.server.tools.ManageTasks.mainManageTasks(ManageTasks.java:106) at org.opends.server.tools.ManageTasks.mainManageTasks(ManageTasks.java:89) at org.opends.server.tools.ManageTasks.main(ManageTasks.java:71) Error connecting to the directory server at dj-linux.internal.forgerock.com on 4462. Check this port is an administration port

		
		
	
	



Observations:

	During export-ldif I did jstacks of export-ldif process and DJ1 server process see attachment.
	After upgrade I can see following WARNINGS in PROXY1 error log:




	
	
		

[16/Oct/2018:10:47:23 +0200] category=BACKEND severity=WARNING msgID=611 msg=Proxy backend 'testupgrade' could not discover remote servers capabilities: Connect Error: No operational connection factories available
[16/Oct/2018:10:48:23 +0200] category=BACKEND severity=WARNING msgID=611 msg=Proxy backend 'testupgrade' could not discover remote servers capabilities: Connect Error: No operational connection factories available
[16/Oct/2018:10:49:23 +0200] category=BACKEND severity=WARNING msgID=611 msg=Proxy backend 'testupgrade' could not discover remote servers capabilities: Connect Error: No operational connection factories available
[16/Oct/2018:10:50:23 +0200] category=BACKEND severity=WARNING msgID=611 msg=Proxy backend 'testupgrade' could not discover remote servers capabilities: Connect Error: No operational connection factories available
[16/Oct/2018:10:51:23 +0200] category=BACKEND severity=WARNING msgID=611 msg=Proxy backend 'testupgrade' could not discover remote servers capabilities: Connect Error: No operational connection factories available
[16/Oct/2018:10:52:23 +0200] category=BACKEND severity=WARNING msgID=611 msg=Proxy backend 'testupgrade' could not discover remote servers capabilities: Connect Error: No operational connection factories available
[16/Oct/2018:10:53:23 +0200] category=BACKEND severity=WARNING msgID=611 msg=Proxy backend 'testupgrade' could not discover remote servers capabilities: Connect Error: No operational connection factories available
[16/Oct/2018:10:54:23 +0200] category=BACKEND severity=WARNING msgID=611 msg=Proxy backend 'testupgrade' could not discover remote servers capabilities: Connect Error: No operational connection factories available
[16/Oct/2018:10:55:23 +0200] category=BACKEND severity=WARNING msgID=611 msg=Proxy backend 'testupgrade' could not discover remote servers capabilities: Connect Error: No operational connection factories available
[16/Oct/2018:10:56:23 +0200] category=BACKEND severity=WARNING msgID=611 msg=Proxy backend 'testupgrade' could not discover remote servers capabilities: Connect Error: No operational connection factories available
[16/Oct/2018:10:57:23 +0200] category=BACKEND severity=WARNING msgID=611 msg=Proxy backend 'testupgrade' could not discover remote servers capabilities: Connect Error: No operational connection factories available
[16/Oct/2018:10:58:23 +0200] category=BACKEND severity=WARNING msgID=611 msg=Proxy backend 'testupgrade' could not discover remote servers capabilities: Connect Error: No operational connection factories available
[16/Oct/2018:10:59:23 +0200] category=BACKEND severity=WARNING msgID=611 msg=Proxy backend 'testupgrade' could not discover remote servers capabilities: Connect Error: No operational connection factories available

	
	




	After point 5. I tried to stop DJ1 and I noticed following messages:
	
		

STDOUT:
Stopping Server... [29/Sep/2018:03:17:29 +0100] category=CORE severity=WARNING msgID=113 msg=Worker Thread 2 was interrupted while waiting for new work: java.lang.InterruptedException. This should not happen, but the thread will resume waiting for new work so there should be no adverse effects [29/Sep/2018:03:17:29 +0100] category=CORE severity=WARNING msgID=113 msg=Worker Thread 1 was interrupted while waiting for new work: java.lang.InterruptedException. This should not happen, but the thread will resume waiting for new work so there should be no adverse effects [29/Sep/2018:03:17:29 +0100] category=CORE severity=WARNING msgID=113 msg=Worker Thread 4 was interrupted while waiting for new work: java.lang.InterruptedException. This should not happen, but the thread will resume waiting for new work so there should be no adverse effects [29/Sep/2018:03:17:29 +0100] category=CORE severity=WARNING msgID=113 msg=Worker Thread 5 was interrupted while waiting for new work: java.lang.InterruptedException. This should not happen, but the thread will resume waiting for new work so there should be no adverse effects [29/Sep/2018:03:17:29 +0100] category=CORE severity=WARNING msgID=113 msg=Worker Thread 6 was interrupted while waiting for new work: java.lang.InterruptedException. This should not happen, but the thread will resume waiting for new work so there should be no adverse effects [29/Sep/2018:03:17:29 +0100] category=CORE severity=WARNING msgID=113 msg=Worker Thread 7 was interrupted while waiting for new work: java.lang.InterruptedException. This should not happen, but the thread will resume waiting for new work so there should be no adverse effects [29/Sep/2018:03:17:29 +0100] category=CORE severity=WARNING msgID=113 msg=Worker Thread 9 was interrupted while waiting for new work: java.lang.InterruptedException. This should not happen, but the thread will resume waiting for new work so there should be no adverse effects [29/Sep/2018:03:17:29 +0100] category=CORE severity=WARNING msgID=113 msg=Worker Thread 10 was interrupted while waiting for new work: java.lang.InterruptedException. This should not happen, but the thread will resume waiting for new work so there should be no adverse effects [29/Sep/2018:03:17:29 +0100] category=CORE severity=WARNING msgID=113 msg=Worker Thread 11 was interrupted while waiting for new work: java.lang.InterruptedException. This should not happen, but the thread will resume waiting for new work so there should be no adverse effects [29/Sep/2018:03:17:29 +0100] category=CORE severity=WARNING msgID=113 msg=Worker Thread 13 was interrupted while waiting for new work: java.lang.InterruptedException. This should not happen, but the thread will resume waiting for new work so there should be no adverse effects [29/Sep/2018:03:17:29 +0100] category=CORE severity=WARNING msgID=113 msg=Worker Thread 14 was interrupted while waiting for new work: java.lang.InterruptedException. This should not happen, but the thread will resume waiting for new work so there should be no adverse effects [29/Sep/2018:03:17:29 +0100] category=CORE severity=WARNING msgID=113 msg=Worker Thread 3 was interrupted while waiting for new work: java.lang.InterruptedException. This should not happen, but the thread will resume waiting for new work so there should be no adverse effects [29/Sep/2018:03:17:29 +0100] category=CORE severity=WARNING msgID=113 msg=Worker Thread 15 was interrupted while waiting for new work: java.lang.InterruptedException. This should not happen, but the thread will resume waiting for new work so there should be no adverse effects [29/Sep/2018:03:17:29 +0100] category=CORE severity=WARNING msgID=113 msg=Worker Thread 8 was interrupted while waiting for new work: java.lang.InterruptedException. This should not happen, but the thread will resume waiting for new work so there should be no adverse effects [29/Sep/2018:03:17:29 +0100] category=CORE severity=WARNING msgID=113 msg=Worker Thread 0 was interrupted while waiting for new work: java.lang.InterruptedException. This should not happen, but the thread will resume waiting for new work so there should be no adverse effects [29/Sep/2018:03:17:29 +0100] category=CORE severity=WARNING msgID=113 msg=Worker Thread 12 was interrupted while waiting for new work: java.lang.InterruptedException. This should not happen, but the thread will resume waiting for new work so there should be no adverse effects The timeout of '200' seconds to start the server has been reached. You can use the argument '--timeout' to increase this timeout


	
	




	
	
		

STDERR:

ERROR: Cannot parse the value of the port argument as an integer value between 1 and 65535: The port argument does not have any value that may be retrieved as an integer See "stop-ds --help" to get more usage help

	
	




	When I killed all servers and started them again I wasn't able to hit this problem again.



When running same test with oracle jdk 1.8 we don't hit this problem and I can't see WARNINGS in errors logs.