The issue appears during our functional test and I was also able to reproduce the same issue with manual tests.

Current behavior

On replication topology with 2 DSRS it is not possible to reset change number.

When running following command:

 ./dj1/opendj/bin/dsreplication reset-change-number -h localhost -p 4444 --hostDestination localhost --portDestination 4445 -I admin -w password  -X -n

We hit following error message:

Cannot reset change-log change number because replicated baseDNs on server
localhost:4444 and server localhost:4445 differ. Since the change number is
computed across all the replicated baseDNs, the change-log change number can
only be reset between two replication servers replicating the exact same
baseDNs.

Both servers replicates the same baseDN dc=com .

 

To reproduce the issue you can use our test framework with following command:

./run-pybot.py -s replication_group2.externalchangelognewserver -t reset_change_number -v opendj

or you can use attached scripts:

reproduce_longer.sh

 - is based on test in our test framework (2DSRS and then 3rd instance is added to topology, the test use two suffixes (dc=com and dc=othersuffix)

reproduce_shorter.sh


	is based on same test, but I removed the third server and let only one baseDN (dc=com) to replicate



The error is same in both scenarios.

 