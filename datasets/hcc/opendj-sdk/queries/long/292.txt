With the following LDAP PTA Policy, if the primary server does not exist the secondary server is chosen, but the mapped-search-base-dn and mapped-search-bind-dn do not exist on the secondary renote-ldap-server we can get a NPE.

>>>> Configure the properties of the LDAP Pass Through Authentication Policy

         Property                                          Value(s)
         ----------------------------------------------------------------------
    1)   connection-timeout                                3 s
    2)   mapped-attribute                                  cn
    3)   mapped-search-base-dn                             "DC=internal,DC=forg
                                                           erock,DC=com"
    4)   mapped-search-bind-dn                             "cn=administrator,cn
                                                           =Users,DC=internal,D
                                                           C=forgerock,DC=com"
    5)   mapped-search-bind-password                       secret12
    6)   mapped-search-bind-password-environment-variable  -
    7)   mapped-search-bind-password-file                  -
    8)   mapped-search-bind-password-property              -
    9)   mapping-policy                                    mapped-search
    10)  primary-remote-ldap-server                        ad.example.com:389
    11)  secondary-remote-ldap-server                      gary-laptop:2389
    12)  trust-manager-provider                            By default, no trust
                                                           manager is specified
                                                           indicating that only
                                                           certificates signed
                                                           by the authorities
                                                           associated with this
                                                           JVM will be
                                                           accepted.
    13)  use-ssl                                           false



./ldapsearch -p 1389 -D "cn=LDAP PTA User,ou=unit1,o=People,dc=Europe,dc=com" -w secret12 -b "cn=LDAP PTA User,ou=unit1,o=People,dc=Europe,dc=com" "objectclass=*"
The simple bind attempt failed
Result Code:  49 (Invalid Credentials)

[22/Sep/2011:12:06:32 +0200] CONNECT conn=5 from=127.0.0.1:54677 to=127.0.0.1:1389 protocol=LDAP
[22/Sep/2011:12:06:32 +0200] BIND REQ conn=5 op=0 msgID=1 version=3 type=SIMPLE dn="cn=LDAP PTA User,ou=unit1,o=People,dc=Europe,dc=com"
[22/Sep/2011:12:06:35 +0200] BIND RES conn=5 op=0 msgID=1 result=49 authFailureID=1245773 authFailureReason="The user "cn=LDAP PTA User,ou=unit1,o=People,dc=Europe,dc=com" could not be authenticated using LDAP PTA policy "cn=LDAP PTA,cn=Password Policies,cn=config" because the search failed unexpectedly for the following reason: The remote LDAP server at gary-laptop:2389 for LDAP PTA policy "cn=LDAP PTA,cn=Password Policies,cn=config" has failed to authenticate user "cn=administrator,cn=Users,DC=internal,DC=forgerock,DC=com", returning the response code 49 (Invalid Credentials) and error message "null"" etime=3006
[22/Sep/2011:12:06:35 +0200] DISCONNECT conn=5 reason="Client Disconnect"

./ldapsearch -p 1389 -D "cn=LDAP PTA User,ou=unit1,o=People,dc=Europe,dc=com" -w secret12 -b "cn=LDAP PTA User,ou=unit1,o=People,dc=Europe,dc=com" "objectclass=*"
The simple bind attempt failed

[22/Sep/2011:12:06:40 +0200] CONNECT conn=6 from=127.0.0.1:54683 to=127.0.0.1:1389 protocol=LDAP
[22/Sep/2011:12:06:40 +0200] BIND REQ conn=6 op=0 msgID=1 version=3 type=SIMPLE dn="cn=LDAP PTA User,ou=unit1,o=People,dc=Europe,dc=com"
[22/Sep/2011:12:06:40 +0200] BIND RES conn=6 op=0 msgID=1 result=-1 etime=1
[22/Sep/2011:12:06:40 +0200] DISCONNECT conn=6 reason="Server Error" msg="Worker Thread 7 encountered an uncaught exception while processing operation BindOperation(connID=6, opID=0, protocol="LDAP 3, dn=cn=LDAP PTA User,ou=unit1,o=People,dc=Europe,dc=com, authType=Simple):  NullPointerException (LDAPPassThroughAuthenticationPolicyFactory.java:132 LDAPPassThroughAuthenticationPolicyFactory.java:88 LDAPPassThroughAuthenticationPolicyFactory.java:377 LDAPPassThroughAuthenticationPolicyFactory.java:1703 LocalBackendBindOperation.java:692 LocalBackendBindOperation.java:257 LocalBackendWorkflowElement.java:541 WorkflowImpl.java:197 WorkflowTopologyNode.java:100 BindOperationBasis.java:818 TraditionalWorkerThread.java:163)"

This is not a valid configuration, but better to avoid NPE.