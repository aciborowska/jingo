When DS is configured with idm-repo profile like:

./setup directory-server -h pyforge.example.com -p 31389 -D "cn=Directory Manager" -w password --adminConnectorPort 34444 -Z 1636   -O --profile idm-repo --set backendName:userRoot --set domainBaseDn:dc=forgerock,dc=com --set importEnabled:false --monitorUserDn uid=Monitor --monitorUserPassword password

it results in Object Class Violation during start-up of IDM.

[873] Sep 13, 2018 12:22:24.859 PM org.forgerock.openidm.repo.init.RepoInitService initRepo
WARNING: Failed to initialize the repo
org.forgerock.json.resource.BadRequestException: Object Class Violation: Entry "cn=openidm-admin,ou=roles,ou=internal,dc=openidm,dc=forgerock,dc=com" violates the schema because it contains attribute "fr-idm-name" which is not allowed by any of the object classes in the entry

Running manually all steps for external dj repo according to docs doesn't throw this error.

During investigations I noticed for instance that IDM's populate_users.ldif is different than DS's profile populate_users.ldif (for instance top domain dc=openidm,dc=forgerock,dc=com vs dc=forgerock,dc=com and more entries in DJ's ldif file). 

I hit above error with profile parameter importEnabled eq true (default value) and also with importEnabled eq false and with manual import of populate_users.ldif from IDM. 

Due to above error if you try to log in as admin through IDM UI, you will see an error message that password is incorrect.

When I didn't use the profile setup and did all steps mentioned here: https://backstage.forgerock.com/docs/idm/6/install-guide/#ds-external the IDM started and I was able to log in as openidm-admin user.

I am attaching a zip with two scripts to reproduce this issue (setupRegular.sh and setupProfile.sh). You need to download IDM-6.5.0-SNAPSHOT and DS-6.5.0-SNAPSHOT before using those. After each script you should manually stop IDM and DS.