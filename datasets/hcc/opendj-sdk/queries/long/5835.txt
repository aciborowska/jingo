DS Security Guide 6.5 9.6. Authenticating Client Applications With a Certificate

DS Security Guide 6.0 9.6. Authenticating Client Applications With a Certificate

DS Security Guide 5.5 9.6. Authenticating Client Applications With a Certificate

Steps to add to the procedure:

The default trust manager provider in the LDAP connection handler is the JVM keystore, the client certificates are in a local file-based truststore. The missing steps in the documentation require a file-based trust manager provider to be created and enabled, and then to point the connection handler to use this trust manager provider. I added these steps before verifying with ldapsearch:

1. List connection handler properties:

$ ./dsconfig get-connection-handler-properties -handler-name "LDAP Connection Handler" --property trust-manager-provider --port 4444 --hostname --bindn  "cn=Directory Manager" --bindPassword password-no-prompt --trustAll

2. Create a trust manager provider to use the local keystore file:

$ ./dsconfig create-trust-manager-provider -set enabled:true --set trust-storefile:config/keystore -set trust-store-pinfile:config/keystore.pin --type file-based --provider-name "Test Trust Manager Provider" --hostname devops  --port 4444 --hostname devops --bindn  "cn=Directory Manager" --bindPassword password --no-prompt --trustAll

3. Configure the LDAP connection handler to use the "Test Trust Manager Provider":

$ ./dsconfig set-connection-handler-prop -handler-name "LDAP Connection Handler"  set trust-manager-provider:"Test Trust Manager Provider" --hostname devops port 4444 -bindn  "cn=Directory Manager" --bindPassword password --no-prompt --trustAll

The search using client certificate authentication works instead of returning client credential errors:

$ ./ldapsearch  --hostname devops  --port 1389  --baseDN dc=example,dc=com  --useStartTLS  --trustStorePath ../../my-keystore --trustStorePasswordFile ../../my-keystore.pin --saslOption mech="EXTERNAL" --certNickName myapp-cert --keyStorePath ../../my-keystore --keyStorePasswordFile ../../my-keystore.pin "cn=my app"

dn: cn=My App,ou=Apps,dc=example,dc=com
objectClass: simpleSecurityObject
objectClass: ds-certificate-user
objectClass: top
objectClass: applicationProcess
ds-certificate-subject-dn: CN=My App, OU=Apps, DC=example, DC=com
userCertificate;binary:: MIIC+DCCAragAwIBAgIETYHI1jALBgcqhkjOOAQDBQAwTjETMBEGCgmSJomT8ixkARkWA2NvbTEXMBUGCgmSJomT8ixkARkWB2V4YW1wbGUxDTALBgNVBAsTBEFwcHMxDzANBgNVBAMTBk15IEFwcDAeFw0xODEyMTExNjI0NTJaFw0zODEyMDYxNjI0NTJaME4xEzARBgoJkiaJk/IsZAEZFgNjb20xFzAVBgoJkiaJk/IsZAEZFgdleGFtcGxlMQ0wCwYDVQQLEwRBcHBzMQ8wDQYDVQQDEwZNeSBBcHAwggG3MIIBLAYHKoZIzjgEATCCAR8CgYEA/X9TgR11EilS30qcLuzk5/YRt1I870QAwx4/gLZRJmlFXUAiUftZPY1Y+r/F9bow9subVWzXgTuAHTRv8mZgt2uZUKWkn5/oBHsQIsJPu6nX/rfGG/g7V+fGqKYVDwT7g/bTxR7DAjVUE1oWkTL2dfOuK2HXKu/yIgMZndFIAccCFQCXYFCPFSMLzLKSuYKi64QL8Fgc9QKBgQD34aCF1ps93su8q1w2uFe5eZSvu/o66oL5V0wLPQeCZ1FZV4661FlP5nEHEIGAtEkWcSPoTCgWE7fPCTKMyKbhPBZ6i1R8jSjgo64eK7OmdZFuo38L+iE1YvH7YnoBJDvMpPG+qFGQiaiD3+Fa5Z8GkotmXoB7VSVkAUw7/s9JKgOBhAACgYAgZtKCBVlqqqRlDD+F0g4bqFNdhpfk4iwnu4DVx9kO/W6WYJrMhQTaUOipe0biB1/HyB+pwDEBQcQW4/7CRCMklEd2Fz/OFkrP7W3mcCTOfF00b1S8YCNemgQLZqD5Kh72bb5QUqgBXunq4GFU5RCfevcN3r6q/wDSBG6NZj+adaMhMB8wHQYDVR0OBBYEFJUHOl62bL2NiaNRw2zzH3K/7hC0MAsGByqGSM44BAMFAAMvADAsAhQmdnRCz3+18kNFaMqh8SooDtsPRQIUI2CsePsQr/+XppzoN1C/GHO6O7U=
cn: My App
userPassword: {SSHA512}fkjolO8xkSauCSmkCIU7AMWgMtSbK3nxyJt0ldGjONX49805woSbdjROucn2cEqmS82uP4pnMJ5qlGVx53Pof/NDfry+JOBY
ds-certificate-fingerprint: EB:05:34:15:B5:AF:FF:5F:CB:28:82:17:AA:07:8A:D1