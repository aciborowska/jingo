Found with opendj 4.0.0 rev (6e562514f52)

We set up a server with some data.
We change the password policy control:

/opendj/bin/dsconfig -h localhost -p 4446 -D "cn=myself" -w password -X set-password-policy-prop --policy-name "Default Password Policy" --set "force-change-on-add:true" -n



we add the following user:

/opendj/bin/ldapmodify -h localhost -p 1391 -D "cn=myself" -w password 	
12:14:09.810 	INFO 	dn: uid=test.user1,ou=People,o=core tests,dc=example,dc=com
objectClass: top
objectClass: person
objectClass: organizationalPerson
objectClass: inetOrgPerson
uid: test.user1
givenName: Test
sn: User1
cn: Test User1
userPassword: password
ds-privilege-name: bypass-acl



Then we perform a search on this user:

/opendj/bin/ldapsearch -h localhost -p 1391 -D "uid=test.user1,ou=People,o=core tests,dc=example,dc=com" -w password -b "ou=People,o=core tests,dc=example,dc=com" -v --control "pwpolicy" "uid=test.user1"



the output does not show the control as expected:


expected:
...
[09/11/2016:12:18:14 +0100] category=TOOLS seq=23 severity=FINEST msg=LDAPMessage(msgID=1, protocolOp=BindResponse(resultCode=0), controls={ LDAPControl(oid=2.16.840.1.113730.3.4.4, criticality=false, value=    30                                                 0
) })
# Your password has expired
[09/11/2016:12:18:14 +0100] category=TOOLS seq=24 severity=FINEST msg=LDAPMessage(msgID=2, protocolOp=SearchRequest(baseDN=ou=People,o=core tests,dc=example,dc=com, scope=sub, derefPolicy=never, sizeLimit=0, timeLimit=0, typesOnly=false, filter=(uid=test.user1), attributes={}), controls={ LDAPControl(oid=1.3.6.1.4.1.42.2.27.8.5.1, criticality=false) })
...

got:
# Your password has expired
The LDAP search request failed: 19 (Constraint Violation)
Additional Information:  uid=test.user1,ou=People,o=core
tests,dc=example,dc=com must change their password before it will be allowed
to request any other operations

