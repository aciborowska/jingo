Failures when closing the temporary file for offline.state should be handled more carefully so that the file isn't replaced with a zero-length file:

The end result of a zero-length offline.state is:



[25/Jul/2016:09:14:35 +0100] category=SYNC severity=ERROR msgID=org.opends.messages.replication.11 msg=The replication server failed to start because the database /opt/opendj300_2/changelogDb could not be read : Could not read replica offline state file 'dc=optadata-one,dc=de' for domain /opt/opendj300_2/changelogDb/1.dom/9239.server/offline.state, it should contain exactly one line corresponding to the offline CSN



This prevents the replication server from starting.

Workarounds: Avoid running out of disk space, and delete zero-length offline.state files if they occur.