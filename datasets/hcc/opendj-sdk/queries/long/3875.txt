Found with OpenDJ 4.0.0 rev 1b042cdf009

Scenario:

We setup 2 DJs with data, replicated on dc=example,dc=com.
We setup a proxy with replication discovery service mechanism, pointing to these 2 DJs:


.\PROXY1\opendj\setup.bat proxy-server --proxyUserBindDn cn=myself --proxyUserBindPassword password \
 --replicationServer dj-robot-windows.internal.forgerock.com:1394 --replicationServer dj-robot-windows.internal.forgerock.com:1395 --loadBalancingAlgorithm affinity \
 -h  dj-robot-windows.internal.forgerock.com -p 1397 -D "cn=myself" -w password --adminConnectorPort 4452

 

=> requests on dc=example,dc=com are correctly forwarded.
We create a new backend on each DJ, with dc=org and some data in it, then enable replication for this suffix.

We change the settings of the proxy so that it routes only dc=org requests:

PROXY1\opendj\bat\dsconfig.bat -h dj-robot-windows.internal.forgerock.com -p 4452 -D "cn=myself" -w password -X \
 set-backend-prop --backend-name proxyRoot --set route-all:False --set base-dn:dc=org -n



This dsconfig command succeeds but takes one minute to run.
Plus, we get the following error messages:


[14/Mar/2017:05:54:07 +0000] category=org.opends.messages.external severity=WARNING msgID=1 msg=GRIZZLY0005: Can not set SO_KEEPALIVE to true exception=SocketException: Invalid argument: no further information (Net.java:-2 Net.java:373 SocketChannelImpl.java:189 SocketAdaptor.java:295 SocketAdaptor.java:397 TCPNIOTransport.java:795 TCPNIOConnectorHandler.java:219 TCPNIOConnectorHandler.java:158 TCPNIOConnection.java:258 TCPNIOTransport.java:517 AbstractIOStrategy.java:112 WorkerThreadIOStrategy.java:117 WorkerThreadIOStrategy.java:103 AbstractIOStrategy.java:89 SelectorRunner.java:415 SelectorRunner.java:384 SelectorRunner.java:348 SelectorRunner.java:279 AbstractThreadPool.java:593 AbstractThreadPool.java:573 Thread.java:745)
[14/Mar/2017:05:54:07 +0000] category=org.opends.messages.external severity=WARNING msgID=1 msg=GRIZZLY0004: Can not set TCP_NODELAY to true exception=SocketException: Invalid argument: no further information (Net.java:-2 Net.java:373 SocketChannelImpl.java:189 SocketAdaptor.java:295 SocketAdaptor.java:330 TCPNIOTransport.java:803 TCPNIOConnectorHandler.java:219 TCPNIOConnectorHandler.java:158 TCPNIOConnection.java:258 TCPNIOTransport.java:517 AbstractIOStrategy.java:112 WorkerThreadIOStrategy.java:117 WorkerThreadIOStrategy.java:103 AbstractIOStrategy.java:89 SelectorRunner.java:415 SelectorRunner.java:384 SelectorRunner.java:348 SelectorRunner.java:279 AbstractThreadPool.java:593 AbstractThreadPool.java:573 Thread.java:745)


