The --connectTimeout parameter has a default value of 30 seconds. Passing in 0 should instruct the tool to not have a timeout, which is useful when debugging, but instead it causes the tools to hang indefinitely.

Steps to reproduce:


	install OpenDJ with default entries
	observe that the following anonymous search hangs after connecting:


./bin/ldapsearch  --hostname matts-laptop-5520  --port 1389 --baseDN dc=example,dc=com --connectTimeout 0 "(objectClass=*)"





Note that there is also an ugly stack trace if the wrong port is specified:



./bin/ldapsearch  --hostname matts-laptop-5520  --port 13899 --baseDN dc=example,dc=com --connectTimeout 0 "(objectClass=*)"
io.reactivex.exceptions.UndeliverableException: Connect Error: Connection refused
	at io.reactivex.plugins.RxJavaPlugins.onError(RxJavaPlugins.java:349)
	at org.forgerock.opendj.ldap.TimeoutSingleOperator$TimeoutSubscriber.onError(TimeoutSingleOperator.java:102)
	at io.reactivex.internal.operators.single.SingleDoAfterSuccess$DoAfterObserver.onError(SingleDoAfterSuccess.java:83)
	at io.reactivex.internal.operators.single.SingleFlatMap$SingleFlatMapCallback.onError(SingleFlatMap.java:90)
	at io.reactivex.internal.operators.single.SingleMap$MapSingleObserver.onError(SingleMap.java:68)
	at org.forgerock.opendj.grizzly.GrizzlyLdapSocketConnector$CompletionHandlerAdapter.failed(GrizzlyLdapSocketConnector.java:174)
	at org.glassfish.grizzly.nio.transport.TCPNIOConnectorHandler.abortConnection(TCPNIOConnectorHandler.java:268)
	at org.glassfish.grizzly.nio.transport.TCPNIOConnectorHandler.onConnectedAsync(TCPNIOConnectorHandler.java:221)
	at org.glassfish.grizzly.nio.transport.TCPNIOConnectorHandler$1.connected(TCPNIOConnectorHandler.java:158)
	at org.glassfish.grizzly.nio.transport.TCPNIOConnection.onConnect(TCPNIOConnection.java:258)
	at org.glassfish.grizzly.nio.transport.TCPNIOTransport.fireIOEvent(TCPNIOTransport.java:530)
	at org.glassfish.grizzly.strategies.AbstractIOStrategy.fireIOEvent(AbstractIOStrategy.java:112)
	at org.glassfish.grizzly.strategies.SameThreadIOStrategy.executeIoEvent(SameThreadIOStrategy.java:103)
	at org.glassfish.grizzly.strategies.AbstractIOStrategy.executeIoEvent(AbstractIOStrategy.java:89)
	at org.glassfish.grizzly.nio.SelectorRunner.iterateKeyEvents(SelectorRunner.java:415)
	at org.glassfish.grizzly.nio.SelectorRunner.iterateKeys(SelectorRunner.java:384)
	at org.glassfish.grizzly.nio.SelectorRunner.doSelect(SelectorRunner.java:348)
	at org.glassfish.grizzly.nio.SelectorRunner.run(SelectorRunner.java:279)
	at org.glassfish.grizzly.threadpool.AbstractThreadPool$Worker.doWork(AbstractThreadPool.java:593)
	at org.glassfish.grizzly.threadpool.AbstractThreadPool$Worker.run(AbstractThreadPool.java:573)
	at java.lang.Thread.run(Thread.java:748)
Caused by: Connect Error: Connection refused
	at org.forgerock.opendj.ldap.LdapException.newLdapException(LdapException.java:204)
	at org.forgerock.opendj.ldap.LdapException.newLdapException(LdapException.java:142)
	at org.forgerock.opendj.ldap.LdapException.newLdapException(LdapException.java:111)
	at org.forgerock.opendj.grizzly.GrizzlyLdapSocketConnector$CompletionHandlerAdapter.adaptConnectionException(GrizzlyLdapSocketConnector.java:185)
	... 16 more
Caused by: java.net.ConnectException: Connection refused
	at sun.nio.ch.SocketChannelImpl.checkConnect(Native Method)
	at sun.nio.ch.SocketChannelImpl.finishConnect(SocketChannelImpl.java:717)
	at org.glassfish.grizzly.nio.transport.TCPNIOConnectorHandler.onConnectedAsync(TCPNIOConnectorHandler.java:210)
	... 13 more
Jan 03, 2018 5:10:24 PM org.glassfish.grizzly.threadpool.AbstractThreadPool uncaughtException
WARNING: GRIZZLY0011: Uncaught exception on thread Thread[OpenDJ LDAP SDK Client Selector(5) SelectorRunner,5,main]
io.reactivex.exceptions.UndeliverableException: Connect Error: Connection refused
	at io.reactivex.plugins.RxJavaPlugins.onError(RxJavaPlugins.java:349)
	at org.forgerock.opendj.ldap.TimeoutSingleOperator$TimeoutSubscriber.onError(TimeoutSingleOperator.java:102)
	at io.reactivex.internal.operators.single.SingleDoAfterSuccess$DoAfterObserver.onError(SingleDoAfterSuccess.java:83)
	at io.reactivex.internal.operators.single.SingleFlatMap$SingleFlatMapCallback.onError(SingleFlatMap.java:90)
	at io.reactivex.internal.operators.single.SingleMap$MapSingleObserver.onError(SingleMap.java:68)
	at org.forgerock.opendj.grizzly.GrizzlyLdapSocketConnector$CompletionHandlerAdapter.failed(GrizzlyLdapSocketConnector.java:174)
	at org.glassfish.grizzly.nio.transport.TCPNIOConnectorHandler.abortConnection(TCPNIOConnectorHandler.java:268)
	at org.glassfish.grizzly.nio.transport.TCPNIOConnectorHandler.onConnectedAsync(TCPNIOConnectorHandler.java:221)
	at org.glassfish.grizzly.nio.transport.TCPNIOConnectorHandler$1.connected(TCPNIOConnectorHandler.java:158)
	at org.glassfish.grizzly.nio.transport.TCPNIOConnection.onConnect(TCPNIOConnection.java:258)
	at org.glassfish.grizzly.nio.transport.TCPNIOTransport.fireIOEvent(TCPNIOTransport.java:530)
	at org.glassfish.grizzly.strategies.AbstractIOStrategy.fireIOEvent(AbstractIOStrategy.java:112)
	at org.glassfish.grizzly.strategies.SameThreadIOStrategy.executeIoEvent(SameThreadIOStrategy.java:103)
	at org.glassfish.grizzly.strategies.AbstractIOStrategy.executeIoEvent(AbstractIOStrategy.java:89)
	at org.glassfish.grizzly.nio.SelectorRunner.iterateKeyEvents(SelectorRunner.java:415)
	at org.glassfish.grizzly.nio.SelectorRunner.iterateKeys(SelectorRunner.java:384)
	at org.glassfish.grizzly.nio.SelectorRunner.doSelect(SelectorRunner.java:348)
	at org.glassfish.grizzly.nio.SelectorRunner.run(SelectorRunner.java:279)
	at org.glassfish.grizzly.threadpool.AbstractThreadPool$Worker.doWork(AbstractThreadPool.java:593)
	at org.glassfish.grizzly.threadpool.AbstractThreadPool$Worker.run(AbstractThreadPool.java:573)
	at java.lang.Thread.run(Thread.java:748)
Caused by: Connect Error: Connection refused
	at org.forgerock.opendj.ldap.LdapException.newLdapException(LdapException.java:204)
	at org.forgerock.opendj.ldap.LdapException.newLdapException(LdapException.java:142)
	at org.forgerock.opendj.ldap.LdapException.newLdapException(LdapException.java:111)
	at org.forgerock.opendj.grizzly.GrizzlyLdapSocketConnector$CompletionHandlerAdapter.adaptConnectionException(GrizzlyLdapSocketConnector.java:185)
	... 16 more
Caused by: java.net.ConnectException: Connection refused
	at sun.nio.ch.SocketChannelImpl.checkConnect(Native Method)
	at sun.nio.ch.SocketChannelImpl.finishConnect(SocketChannelImpl.java:717)
	at org.glassfish.grizzly.nio.transport.TCPNIOConnectorHandler.onConnectedAsync(TCPNIOConnectorHandler.java:210)
	... 13 more

