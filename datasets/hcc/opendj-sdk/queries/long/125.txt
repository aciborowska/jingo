Sometimes replicated OpenDJ instances are very slow to stop. Not only that, they can result in ugly log messages when the shutdown timeout is reached and worker threads are forcefully interrupted:


matt@matts-laptop:~/opendj-topology/m2/OpenDJ-2.4.2$ ./bin/stop-ds 
Stopping Server...

[20/Apr/2011:17:45:46 +0200] category=CORE severity=SEVERE_WARNING msgID=131185 msg=Worker Thread 0 was interrupted while waiting for new work:  java.lang.InterruptedException.  This should not happen, but the thread will resume waiting for new work so there should be no adverse effects
[20/Apr/2011:17:45:46 +0200] category=CORE severity=SEVERE_WARNING msgID=131185 msg=Worker Thread 11 was interrupted while waiting for new work:  java.lang.InterruptedException.  This should not happen, but the thread will resume waiting for new work so there should be no adverse effects
[20/Apr/2011:17:45:46 +0200] category=CORE severity=SEVERE_WARNING msgID=131185 msg=Worker Thread 1 was interrupted while waiting for new work:  java.lang.InterruptedException.  This should not happen, but the thread will resume waiting for new work so there should be no adverse effects
[20/Apr/2011:17:45:46 +0200] category=CORE severity=SEVERE_WARNING msgID=131185 msg=Worker Thread 10 was interrupted while waiting for new work:  java.lang.InterruptedException.  This should not happen, but the thread will resume waiting for new work so there should be no adverse effects
[20/Apr/2011:17:45:46 +0200] category=SYNC severity=SEVERE_ERROR msgID=14942317 msg=An Exception was caught while replaying replication message : InterruptedException (AbstractQueuedSynchronizer.java:1961 AbstractQueuedSynchronizer.java:2038 LinkedBlockingQueue.java:424 ReplayThread.java:102)
[20/Apr/2011:17:45:46 +0200] category=CORE severity=SEVERE_WARNING msgID=131185 msg=Worker Thread 2 was interrupted while waiting for new work:  java.lang.InterruptedException.  This should not happen, but the thread will resume waiting for new work so there should be no adverse effects
[20/Apr/2011:17:45:46 +0200] category=CORE severity=SEVERE_WARNING msgID=131185 msg=Worker Thread 13 was interrupted while waiting for new work:  java.lang.InterruptedException.  This should not happen, but the thread will resume waiting for new work so there should be no adverse effects
[20/Apr/2011:17:45:46 +0200] category=SYNC severity=SEVERE_ERROR msgID=14942317 msg=An Exception was caught while replaying replication message : InterruptedException (AbstractQueuedSynchronizer.java:1961 AbstractQueuedSynchronizer.java:2038 LinkedBlockingQueue.java:424 ReplayThread.java:102)
[20/Apr/2011:17:45:46 +0200] category=CORE severity=SEVERE_WARNING msgID=131185 msg=Worker Thread 9 was interrupted while waiting for new work:  java.lang.InterruptedException.  This should not happen, but the thread will resume waiting for new work so there should be no adverse effects
[20/Apr/2011:17:45:46 +0200] category=CORE severity=SEVERE_WARNING msgID=131185 msg=Worker Thread 14 was interrupted while waiting for new work:  java.lang.InterruptedException.  This should not happen, but the thread will resume waiting for new work so there should be no adverse effects
[20/Apr/2011:17:45:46 +0200] category=CORE severity=SEVERE_WARNING msgID=131185 msg=Worker Thread 8 was interrupted while waiting for new work:  java.lang.InterruptedException.  This should not happen, but the thread will resume waiting for new work so there should be no adverse effects
[20/Apr/2011:17:45:46 +0200] category=CORE severity=SEVERE_WARNING msgID=131185 msg=Worker Thread 23 was interrupted while waiting for new work:  java.lang.InterruptedException.  This should not happen, but the thread will resume waiting for new work so there should be no adverse effects
[20/Apr/2011:17:45:46 +0200] category=CORE severity=SEVERE_WARNING msgID=131185 msg=Worker Thread 6 was interrupted while waiting for new work:  java.lang.InterruptedException.  This should not happen, but the thread will resume waiting for new work so there should be no adverse effects
[20/Apr/2011:17:45:46 +0200] category=CORE severity=SEVERE_WARNING msgID=131185 msg=Worker Thread 4 was interrupted while waiting for new work:  java.lang.InterruptedException.  This should not happen, but the thread will resume waiting for new work so there should be no adverse effects
[20/Apr/2011:17:45:46 +0200] category=CORE severity=SEVERE_WARNING msgID=131185 msg=Worker Thread 12 was interrupted while waiting for new work:  java.lang.InterruptedException.  This should not happen, but the thread will resume waiting for new work so there should be no adverse effects
[20/Apr/2011:17:45:46 +0200] category=CORE severity=SEVERE_WARNING msgID=131185 msg=Worker Thread 7 was interrupted while waiting for new work:  java.lang.InterruptedException.  This should not happen, but the thread will resume waiting for new work so there should be no adverse effects
[20/Apr/2011:17:45:46 +0200] category=CORE severity=SEVERE_WARNING msgID=131185 msg=Worker Thread 3 was interrupted while waiting for new work:  java.lang.InterruptedException.  This should not happen, but the thread will resume waiting for new work so there should be no adverse effects
[20/Apr/2011:17:45:46 +0200] category=CORE severity=SEVERE_WARNING msgID=131185 msg=Worker Thread 15 was interrupted while waiting for new work:  java.lang.InterruptedException.  This should not happen, but the thread will resume waiting for new work so there should be no adverse effects
[20/Apr/2011:17:45:46 +0200] category=CORE severity=SEVERE_WARNING msgID=131185 msg=Worker Thread 5 was interrupted while waiting for new work:  java.lang.InterruptedException.  This should not happen, but the thread will resume waiting for new work so there should be no adverse effects
[20/Apr/2011:17:45:46 +0200] category=CORE severity=SEVERE_WARNING msgID=131185 msg=Worker Thread 16 was interrupted while waiting for new work:  java.lang.InterruptedException.  This should not happen, but the thread will resume waiting for new work so there should be no adverse effects
[20/Apr/2011:17:45:46 +0200] category=CORE severity=SEVERE_WARNING msgID=131185 msg=Worker Thread 18 was interrupted while waiting for new work:  java.lang.InterruptedException.  This should not happen, but the thread will resume waiting for new work so there should be no adverse effects
[20/Apr/2011:17:45:46 +0200] category=SYNC severity=SEVERE_ERROR msgID=14942317 msg=An Exception was caught while replaying replication message : InterruptedException (AbstractQueuedSynchronizer.java:1961 AbstractQueuedSynchronizer.java:2038 LinkedBlockingQueue.java:424 ReplayThread.java:102)
[20/Apr/2011:17:45:46 +0200] category=SYNC severity=SEVERE_ERROR msgID=14942317 msg=An Exception was caught while replaying replication message : InterruptedException (AbstractQueuedSynchronizer.java:1961 AbstractQueuedSynchronizer.java:2038 LinkedBlockingQueue.java:424 ReplayThread.java:102)
[20/Apr/2011:17:45:46 +0200] category=SYNC severity=SEVERE_ERROR msgID=14942317 msg=An Exception was caught while replaying replication message : InterruptedException (AbstractQueuedSynchronizer.java:1961 AbstractQueuedSynchronizer.java:2038 LinkedBlockingQueue.java:424 ReplayThread.java:102)
[20/Apr/2011:17:45:46 +0200] category=CORE severity=SEVERE_WARNING msgID=131185 msg=Worker Thread 19 was interrupted while waiting for new work:  java.lang.InterruptedException.  This should not happen, but the thread will resume waiting for new work so there should be no adverse effects
[20/Apr/2011:17:45:46 +0200] category=CORE severity=SEVERE_WARNING msgID=131185 msg=Worker Thread 17 was interrupted while waiting for new work:  java.lang.InterruptedException.  This should not happen, but the thread will resume waiting for new work so there should be no adverse effects
[20/Apr/2011:17:45:46 +0200] category=SYNC severity=SEVERE_ERROR msgID=14942317 msg=An Exception was caught while replaying replication message : InterruptedException (AbstractQueuedSynchronizer.java:1961 AbstractQueuedSynchronizer.java:2038 LinkedBlockingQueue.java:424 ReplayThread.java:102)
[20/Apr/2011:17:45:46 +0200] category=SYNC severity=SEVERE_ERROR msgID=14942317 msg=An Exception was caught while replaying replication message : InterruptedException (AbstractQueuedSynchronizer.java:1961 AbstractQueuedSynchronizer.java:2038 LinkedBlockingQueue.java:424 ReplayThread.java:102)
[20/Apr/2011:17:45:46 +0200] category=SYNC severity=SEVERE_ERROR msgID=14942317 msg=An Exception was caught while replaying replication message : InterruptedException (AbstractQueuedSynchronizer.java:1961 AbstractQueuedSynchronizer.java:2038 LinkedBlockingQueue.java:424 ReplayThread.java:102)
[20/Apr/2011:17:45:46 +0200] category=SYNC severity=SEVERE_ERROR msgID=14942317 msg=An Exception was caught while replaying replication message : InterruptedException (AbstractQueuedSynchronizer.java:1961 AbstractQueuedSynchronizer.java:2038 LinkedBlockingQueue.java:424 ReplayThread.java:102)
[20/Apr/2011:17:45:46 +0200] category=CORE severity=SEVERE_WARNING msgID=131185 msg=Worker Thread 21 was interrupted while waiting for new work:  java.lang.InterruptedException.  This should not happen, but the thread will resume waiting for new work so there should be no adverse effects
[20/Apr/2011:17:45:46 +0200] category=CORE severity=SEVERE_WARNING msgID=131185 msg=Worker Thread 22 was interrupted while waiting for new work:  java.lang.InterruptedException.  This should not happen, but the thread will resume waiting for new work so there should be no adverse effects
[20/Apr/2011:17:45:46 +0200] category=SYNC severity=SEVERE_ERROR msgID=14942317 msg=An Exception was caught while replaying replication message : InterruptedException (AbstractQueuedSynchronizer.java:1961 AbstractQueuedSynchronizer.java:2038 LinkedBlockingQueue.java:424 ReplayThread.java:102)
[20/Apr/2011:17:45:46 +0200] category=CORE severity=SEVERE_WARNING msgID=131185 msg=Worker Thread 20 was interrupted while waiting for new work:  java.lang.InterruptedException.  This should not happen, but the thread will resume waiting for new work so there should be no adverse effects

[20/Apr/2011:17:45:46 +0200] category=BACKEND severity=NOTICE msgID=9896306 msg=The backend userRoot is now taken offline
[20/Apr/2011:17:45:46 +0200] category=CORE severity=NOTICE msgID=458955 msg=The Directory Server is now stopped


This does not happen very often and the server does restart ok afterwards, so it is quite benign. I believe the problem is caused by replication threads being blocked. I would not be surprised if this is a result of lost/missed shutdown/interrupt notifications in the replication code as I've already encountered a few of these.