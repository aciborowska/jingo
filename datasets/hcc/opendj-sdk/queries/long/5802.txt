Found with 



7.0.0-SNAPSHOT (0374b368443)





I discovered the following issue by stress test:


python3 run-pybot.py -c perf -s perf_comparison.operationsComparison -t AddRate_DefaultIndexes  DJ


In the above test, there are two topologies 1st with old versions and 2nd with 7.0.0. The issue is with 7.0.0 version.

During a dsreplication configure step with 7.0.0 an error message with NPE is logged to replication log:

 


./NEW_DJ1/opendj/bin/dsreplication configure --host1 beaufort.internal.forgerock.com --port1 4445 --bindDN1 "cn=Directory Manager" --bindPassword1 "password" --replicationPort1 8990 --host2 beaufort.internal.forgerock.com --port2 4447 --bindDN2 "cn=Directory Manager" --bindPassword2 "password" --replicationPort2 8992 -b dc=com -I admin -w password -X -n	

20:55:50.861	INFO	SUCCESS: -- rc -- returned 0, effectively in [0] 
-- stdout -- 
Establishing connections ..... Done 
Checking registration information ..... Done 
Configuring Replication port on server beaufort.internal.forgerock.com:4445 .....Done 
Configuring Replication port on server beaufort.internal.forgerock.com:4447 .....Done 
Updating replication configuration for baseDN dc=com on server beaufort.internal.forgerock.com:4445 .....Done 
Updating replication configuration for baseDN dc=com on server beaufort.internal.forgerock.com:4447 .....Done 
Updating registration configuration on server beaufort.internal.forgerock.com:4445 .....Done Updating registration configuration on server beaufort.internal.forgerock.com:4447 .....Done 
Updating replication configuration for baseDN cn=schema on server beaufort.internal.forgerock.com:4445 .....
Done Updating replication configuration for baseDN cn=schema on server beaufort.internal.forgerock.com:4447 .....
Done Initializing registration information on server beaufort.internal.forgerock.com:4447 with the contents of server beaufort.internal.forgerock.com:4445 .....Done 
Initializing schema on server beaufort.internal.forgerock.com:4447 with the contents of server beaufort.internal.forgerock.com:4445 .....Done 
Replication has been successfully configured. 
Note that for replication to work you must initialize the contents of the base DNs that are being replicated (use dsreplication initialize to do so). 
See /tmp/opendj-replication-5008380703787652946.log for a detailed log of this operation.



message:

[08/Dec/2018:20:55:45 +0100] category=SYNC severity=ERROR msgID=173 msg=An error occurred when accessing the change number database : NullPointerException (FileChangeNumberIndexDB.java:84 FileChangelogDB.java:539 ReplicationServer.java:1131 ReplicationServer.java:1124 FirstChangeNumberVirtualAttributeProvider.java:62 Attributes.java:822 Attributes.java:818 Attributes.java:203 Attributes.java:117 Entries.java:268 Entries.java:250 AttributeFilter.java:235 AttributeFilter.java:224 AttributeFilter.java:147 AttributeFilter.java:183 Iterators.java:181 Ldap.java:637 LdapWriter.java:668 LdapWriter.java:158 Codecs.java:338 ExecutorResolver.java:111 ...)	
[08/Dec/2018:20:55:45 +0100] category=org.opends.messages.external severity=WARNING msgID=1 msg=GRIZZLY0013: Exception during FilterChain execution exception=NullPointerException (ReplicationServer.java:1132 ReplicationServer.java:1124 FirstChangeNumberVirtualAttributeProvider.java:62 Attributes.java:822 Attributes.java:818 Attributes.java:203 Attributes.java:117 Entries.java:268 Entries.java:250 AttributeFilter.java:235 AttributeFilter.java:224 AttributeFilter.java:147 AttributeFilter.java:183 Iterators.java:181 Ldap.java:637 LdapWriter.java:668 LdapWriter.java:158 Codecs.java:338 ExecutorResolver.java:111 DefaultFilterChain.java:284 DefaultFilterChain.java:201 ...)


Servers are set up with following commands:

 

 


./NEW_DJ1/opendj/setup directory-server -h beaufort.internal.forgerock.com
 -p 1390 -D "cn=Directory Manager" -w password --adminConnectorPort 4445 -Z 1637 -b dc=com --sampleData 100000 -O --monitorUserDn uid=Monitor --monitorUserPassword password

./NEW_DJ2/opendj/setup directory-server -h beaufort.internal.forgerock.com
 -p 1392 -D "cn=Directory Manager" -w password --adminConnectorPort 4447 -Z 1639 -b dc=com -O --monitorUserDn uid=Monitor --monitorUserPassword password


—

I don't see this issue in any other test so it can be a kind of random issue. I tried to run the test on my machine twice and I wasn't able to reproduce it.

 