With OPENDJ-6702, the doc tests are starting to take advantage of Docker containers and replication configuration at setup time. Since some test suites only require a single DS/RS, the only bootstrap replication server that can be counted on is the first DS/RS started.

The suite for testing replication examples sets up two DS/RS, and immediately runs dsrepl initialize --toAllServers to initialize from the first DS/RS to the other servers.

Perhaps the timing is bad, but at this point, the first DS/RS doesn't seem to know about any other servers. The command fails with the following output. (Sorry about the formatting from the doc test framework.)

not ok 4 initialize manually
# (from function `check_expected_status' in file config-guide/../bats_helper.bash, line 118,
#  in test file config-guide/replication.bats, line 69)
#   `check_expected_status "0" "$status"' failed
# Failed with exit status 1
# Output:
# Starting initialization from 'ds-0' to all replicas for base DNs:
# 'dc=example,dc=com'
# Starting initialization for base DN: 'dc=example,dc=com'
# An error occurred during initialization. Last log details:
# [26/May/2020:10:02:26 +0000] severity="NOTICE" msgCount=0
# msgID=org.opends.messages.backend-413 message="Initialize Backend task
# dsrepl-initialize-1 started execution"; [26/May/2020:10:02:26 +0000]
# severity="ERROR" msgCount=1 msgID=org.opends.messages.backend-99 message="An
# error occurred while executing the task defined in entry
# ds-task-id=dsrepl-initialize-1,cn=Scheduled Tasks,cn=Tasks:  LdapException:
# Unwilling to Perform: Cannot start total update in domain "dc=example,dc=com"
# from this directory server DS(ds-0): no remote directory servers found
# (LdapException.java:255 LdapException.java:145 LdapException.java:114
# LdapException.java:72 ReplicationDomain.java:1229
# LDAPReplicationDomain.java:1181 ReplicationDomain.java:1191
# InitializeTargetTask.java:91 Task.java:645 TaskThread.java:123)";
# [26/May/2020:10:02:26 +0000] severity="ERROR" msgCount=2 msgID=null--1
# message="Unwilling to Perform: Cannot start total update in domain
# "dc=example,dc=com" from this directory server DS(ds-0): no remote directory
# servers found"; [26/May/2020:10:02:26 +0000] severity="NOTICE" msgCount=3
# msgID=org.opends.messages.backend-414 message="Initialize Backend task
# dsrepl-initialize-1 finished execution in the state Stopped by error". Task
# state: STOPPED_BY_ERROR
# Check the server error logs for additional details 

If you read the whole thing, you see no remote directory servers found, but the message is buried in the output.

Furthermore, if there really are no remote directory servers found, then the task should just stop—having successfully initialized the empty set of 0 other servers—perhaps logging a message, but not failing with an error.

To work around the issue, add the second DS/RS, ds-1, to the set of bootstrap replication servers on both DS/RSs. That's what I'll do in my patch for the doc tests.