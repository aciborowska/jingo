ds1 and ds2 are both DS+RSes, with working replication.

Shut them both down and upgrade them both from either 2.6.0/2.6.4 to either 3.0.0/3.5.0/4.0.0-SNAPSHOT, and then restart them both.

Changes made to both DSes at this point will fail to replicate. Both servers log that the RS has a generation ID of -1:


[22/Aug/2016:10:14:34 +0100] category=SYNC severity=WARNING msgID=146 msg=Directory server DS(13119) at 10.0.1.22/10.0.1.22:58822 presented generation ID 8693 for domain "dc=example,dc=com", but the generation ID of this replication server RS(26392) is -1. This usually indicates that one or more directory servers in the replication topology have not been initialized with the same data, and re-initialization is required
[22/Aug/2016:10:14:34 +0100] category=SYNC severity=NOTICE msgID=62 msg=Directory server DS(13119) has connected to replication server RS(26392) for domain "dc=example,dc=com" at rih.local/10.0.1.22:9989 with generation ID 8693



On the customer system, the "cn=admin data" and "cn=schema" domains were also in the same odd state.

Doing an initialize on the affected domain does fix the problem.

Doing the upgrade one node at a time (ie sequentially) also results in working replication. I note that the procedure for upgrading replicated servers does say "Upgrade each server sequentially, as described above." Perhaps this should be emphasised somehow.

The attached shell script reproduces the problem. Edit the variables at the top of the script to suit.