Found with clean installation of 6.5.0-M126.2:

1. Install server
2. Create backup


./bin/backup -h fuchsik-pq -p 9944 -D "cn=myself" -w password -X -n userRoot -d /home/fuchsik/playground/Adj/tmp/backup1 -A



3. Stop server
4. Restore backup


./bin/restore  --offline -d /home/fuchsik/playground/Adj/tmp/backup1 -n


The error after 4. is:


java.lang.NullPointerException
	at org.opends.server.backends.jeb.JEStorage.computeSize(JEStorage.java:1091)
	at org.opends.server.backends.jeb.JEStorage.isConfigurationChangeAcceptable(JEStorage.java:1084)
	at org.opends.server.backends.jeb.JEStorage.isConfigurationChangeAcceptable(JEStorage.java:113)
	at org.forgerock.opendj.config.server.ServerManagedObjectChangeListenerAdaptor.isConfigurationChangeAcceptable(ServerManagedObjectChangeListenerAdaptor.java:66)
	at org.forgerock.opendj.config.server.ConfigChangeListenerAdaptor.configChangeIsAcceptable(ConfigChangeListenerAdaptor.java:339)
	at org.forgerock.opendj.config.server.ConfigChangeListenerAdaptor.configChangeIsAcceptable(ConfigChangeListenerAdaptor.java:300)
	at org.opends.server.config.ConfigurationHandler.replaceEntry(ConfigurationHandler.java:574)
	at org.opends.server.backends.ConfigurationBackend.replaceEntry(ConfigurationBackend.java:347)
	at org.opends.server.core.ModifyOperation.processModify(ModifyOperation.java:552)
	at org.opends.server.core.ModifyOperation.processLocalModify(ModifyOperation.java:380)
	at org.opends.server.core.ModifyOperation.run(ModifyOperation.java:298)
	at org.opends.server.protocols.internal.AbstractInternalClientConnection.handleRequest(AbstractInternalClientConnection.java:368)
	at org.opends.server.protocols.internal.AbstractInternalClientConnection.lambda$handle$0(AbstractInternalClientConnection.java:351)
	at io.reactivex.internal.operators.flowable.FlowableCreate.subscribeActual(FlowableCreate.java:72)
	at io.reactivex.Flowable.subscribe(Flowable.java:13234)
	at io.reactivex.Flowable.subscribe(Flowable.java:13180)
	at io.reactivex.internal.operators.flowable.FlowableLift.subscribeActual(FlowableLift.java:49)
	at io.reactivex.Flowable.subscribe(Flowable.java:13234)
	at io.reactivex.internal.operators.flowable.FlowableDoFinally.subscribeActual(FlowableDoFinally.java:47)
	at io.reactivex.Flowable.subscribe(Flowable.java:13234)
	at io.reactivex.internal.operators.flowable.FlowableMap.subscribeActual(FlowableMap.java:38)
	at io.reactivex.Flowable.subscribe(Flowable.java:13234)
	at io.reactivex.internal.operators.flowable.FlowableDoOnEach.subscribeActual(FlowableDoOnEach.java:50)
	at io.reactivex.Flowable.subscribe(Flowable.java:13234)
	at io.reactivex.internal.operators.flowable.FlowableOnErrorNext.subscribeActual(FlowableOnErrorNext.java:39)
	at io.reactivex.Flowable.subscribe(Flowable.java:13234)
	at io.reactivex.internal.operators.flowable.FlowableFilter.subscribeActual(FlowableFilter.java:37)
	at io.reactivex.Flowable.subscribe(Flowable.java:13234)
	at io.reactivex.internal.operators.flowable.FlowableMap.subscribeActual(FlowableMap.java:38)
	at io.reactivex.Flowable.subscribe(Flowable.java:13234)
	at io.reactivex.Flowable.blockingLast(Flowable.java:5576)
	at org.opends.server.protocols.internal.AbstractInternalClientConnection$InternalConnection.performRequest(AbstractInternalClientConnection.java:195)
	at org.opends.server.protocols.internal.AbstractInternalClientConnection$InternalConnection.modify(AbstractInternalClientConnection.java:125)
	at org.opends.server.tasks.TaskUtils.enableBackend(TaskUtils.java:138)
	at org.opends.server.tasks.TaskUtils.disableBackend(TaskUtils.java:122)
	at org.opends.server.tools.RestoreDb.processLocal(RestoreDb.java:285)
	at org.opends.server.tools.tasks.TaskTool.process(TaskTool.java:285)
	at org.opends.server.tools.RestoreDb.runTaskTool(RestoreDb.java:157)
	at org.opends.server.tools.tasks.TaskTool.run(TaskTool.java:258)
	at com.forgerock.opendj.cli.Utils.runTool(Utils.java:959)
	at com.forgerock.opendj.cli.Utils.runToolAndExit(Utils.java:941)
	at org.opends.server.tools.RestoreDb.main(RestoreDb.java:83)
Exception in thread "main" java.lang.NullPointerException
	at org.opends.server.backends.jeb.JEStorage.computeSize(JEStorage.java:1091)
	at org.opends.server.backends.jeb.JEStorage.isConfigurationChangeAcceptable(JEStorage.java:1084)
	at org.opends.server.backends.jeb.JEStorage.isConfigurationChangeAcceptable(JEStorage.java:113)
	at org.forgerock.opendj.config.server.ServerManagedObjectChangeListenerAdaptor.isConfigurationChangeAcceptable(ServerManagedObjectChangeListenerAdaptor.java:66)
	at org.forgerock.opendj.config.server.ConfigChangeListenerAdaptor.configChangeIsAcceptable(ConfigChangeListenerAdaptor.java:339)
	at org.forgerock.opendj.config.server.ConfigChangeListenerAdaptor.configChangeIsAcceptable(ConfigChangeListenerAdaptor.java:300)
	at org.opends.server.config.ConfigurationHandler.replaceEntry(ConfigurationHandler.java:574)
	at org.opends.server.backends.ConfigurationBackend.replaceEntry(ConfigurationBackend.java:347)
	at org.opends.server.core.ModifyOperation.processModify(ModifyOperation.java:552)
	at org.opends.server.core.ModifyOperation.processLocalModify(ModifyOperation.java:380)
	at org.opends.server.core.ModifyOperation.run(ModifyOperation.java:298)
	at org.opends.server.protocols.internal.AbstractInternalClientConnection.handleRequest(AbstractInternalClientConnection.java:368)
	at org.opends.server.protocols.internal.AbstractInternalClientConnection.lambda$handle$0(AbstractInternalClientConnection.java:351)
	at io.reactivex.internal.operators.flowable.FlowableCreate.subscribeActual(FlowableCreate.java:72)
	at io.reactivex.Flowable.subscribe(Flowable.java:13234)
	at io.reactivex.Flowable.subscribe(Flowable.java:13180)
	at io.reactivex.internal.operators.flowable.FlowableLift.subscribeActual(FlowableLift.java:49)
	at io.reactivex.Flowable.subscribe(Flowable.java:13234)
	at io.reactivex.internal.operators.flowable.FlowableDoFinally.subscribeActual(FlowableDoFinally.java:47)
	at io.reactivex.Flowable.subscribe(Flowable.java:13234)
	at io.reactivex.internal.operators.flowable.FlowableMap.subscribeActual(FlowableMap.java:38)
	at io.reactivex.Flowable.subscribe(Flowable.java:13234)
	at io.reactivex.internal.operators.flowable.FlowableDoOnEach.subscribeActual(FlowableDoOnEach.java:50)
	at io.reactivex.Flowable.subscribe(Flowable.java:13234)
	at io.reactivex.internal.operators.flowable.FlowableOnErrorNext.subscribeActual(FlowableOnErrorNext.java:39)
	at io.reactivex.Flowable.subscribe(Flowable.java:13234)
	at io.reactivex.internal.operators.flowable.FlowableFilter.subscribeActual(FlowableFilter.java:37)
	at io.reactivex.Flowable.subscribe(Flowable.java:13234)
	at io.reactivex.internal.operators.flowable.FlowableMap.subscribeActual(FlowableMap.java:38)
	at io.reactivex.Flowable.subscribe(Flowable.java:13234)
	at io.reactivex.Flowable.blockingLast(Flowable.java:5576)
	at org.opends.server.protocols.internal.AbstractInternalClientConnection$InternalConnection.performRequest(AbstractInternalClientConnection.java:195)
	at org.opends.server.protocols.internal.AbstractInternalClientConnection$InternalConnection.modify(AbstractInternalClientConnection.java:125)
	at org.opends.server.tasks.TaskUtils.enableBackend(TaskUtils.java:138)
	at org.opends.server.tasks.TaskUtils.disableBackend(TaskUtils.java:122)
	at org.opends.server.tools.RestoreDb.processLocal(RestoreDb.java:285)
	at org.opends.server.tools.tasks.TaskTool.process(TaskTool.java:285)
	at org.opends.server.tools.RestoreDb.runTaskTool(RestoreDb.java:157)
	at org.opends.server.tools.tasks.TaskTool.run(TaskTool.java:258)
	at com.forgerock.opendj.cli.Utils.runTool(Utils.java:959)
	at com.forgerock.opendj.cli.Utils.runToolAndExit(Utils.java:941)
	at org.opends.server.tools.RestoreDb.main(RestoreDb.java:83)
[09/08/2018:08:07:24 +0200] category=TOOLS seq=0 severity=SEVERE msg=Cannot disable backend userRoot before restore: Undefined: The task could not disable a backend: ds-cfg-backend-id=userRoot,cn=Backends,cn=config



To reproduce the issue with test framework run:



./run-pybot.py -s backends_group.restore -t restore_data -v opendj



