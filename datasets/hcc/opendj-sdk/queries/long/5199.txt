A customer tried this REST request, which failed for reasons that were not clear to him:


curl --request PUT --data '{"pwdReset": false}' http://localhost:8080/api/user/TEST_L7139343



The error was something like "Not Allowed on RDN: Entry cn=TEST_L7139343,ou=People,dc=example,dc=com cannot be modified because the change to attribute cn would have removed a value used in the RDN"

I think this is because the differences between the REST PUT and PATCH methods are not clearly described in the dev guide. Currently it says this for PUT:

To update a resource, perform an HTTP PUT with the changes to the resource. Use an If-Match header to ensure the resource already exists. For read-only fields, either include unmodified versions, or omit them from your updated version.

And it says this for PATCH:

DS software lets you patch JSON resources, updating part of the resource rather than replacing it. For example, you could change Babs Jensen's email address by issuing an HTTP PATCH request as in the following example:

The difference is that the PUT request includes the final modified entry, i.e. including all the writable fields. If you miss a writable field from the request, it will be deleted from the entry; so the customer's example above really was trying to delete every field except for pwdReset. The logic is in org.forgerock.opendj.rest2ldap.AbstractLdapPropertyMapper#update(Connection, Resource, JsonPointer, Entry, JsonValue)

It might be worth saying something different in the PUT text than just "the changes to the resource" as that suggests just including the fields you want to change, which is definitely not the case.