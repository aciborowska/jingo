Scenario 1, userCertificate;binary.

Add a specific aci to grant write for the attribute userCertificate;binary :


ds-cfg-global-aci: (targetattr="userCertificate;binary")(version 3.0; acl "Certificate modification by user.0"; allow (write) userdn="ldap:///uid=user.0,ou=people,dc=example,dc=com";)



Add the userCertificate;binary attribute to uid=user.1 :

$ bin/ldapmodify -p 1389 -D uid=user.0,ou=people,dc=example,dc=com -w passworddn: uid=user.1,ou=people,dc=example,dc=comchangetype: modify
add: userCertificate;binary
userCertificate;binary:<file:///Users/ludo/id_rsa.pub

Processing MODIFY request for uid=user.1,ou=people,dc=example,dc=com
MODIFY operation failed
Result Code:  50 (Insufficient Access Rights)
Additional Information:  The entry uid=user.1,ou=people,dc=example,dc=com cannot be modified due to insufficient access rights



Check aclRights:


$ bin/ldapsearch -h localhost -p 1389 -w secret12 -D "cn=Directory Manager" -g "dn:uid=user.0,ou=people,dc=example,dc=com" -b "uid=user.1,ou=people,dc=example,dc=com" -s base "(objectclass=*)" 'userCertificate;binary' aclRights
dn: uid=user.1,ou=People,dc=example,dc=com
aclRights;entryLevel: add:0,delete:0,read:1,write:1,proxy:0
aclRights;attributeLevel;usercertificate;binary: search:1,read:1,compare:1,write
 :1,selfwrite_add:0,selfwrite_delete:0,proxy:0



Check aclRightsInfo: 


$ bin/ldapsearch -T -h localhost -p 1389 -w secret12 -D "cn=Directory Manager" -g "dn:uid=user.0,ou=people,dc=example,dc=com" -b "uid=user.1,ou=people,dc=example,dc=com" -s base "(objectclass=*)" 'userCertificate;binary' aclRightsInfo
dn: uid=user.1,ou=People,dc=example,dc=com
aclRightsInfo;logs;entryLevel;read: acl_summary(main): access allowed(read) on entry/attr(uid=user.1,ou=People,dc=example,dc=com, objectClass) to (uid=user.0,ou=people,dc=example,dc=com) (not proxied) ( reason: evaluated allow , deciding_aci: Anonymous read access)
aclRightsInfo;logs;attributeLevel;selfwrite_add;usercertificate;binary: acl_summary(main): access not allowed(write) on entry/attr(uid=user.1,ou=People,dc=example,dc=com, distinguishedName) to (uid=user.0,ou=people,dc=example,dc=com) (not proxied) ( reason: no acis matched the resource )
aclRightsInfo;logs;attributeLevel;compare;usercertificate;binary: acl_summary(main): access allowed(compare) on entry/attr(uid=user.1,ou=People,dc=example,dc=com, usercertificate;binary) to (uid=user.0,ou=people,dc=example,dc=com) (not proxied) ( reason: evaluated allow , deciding_aci: Anonymous read access)
*aclRightsInfo;logs;entryLevel;write: acl_summary(main): access allowed(write) on entry/attr(uid=user.1,ou=People,dc=example,dc=com, NULL) to (uid=user.0,ou=people,dc=example,dc=com) (not proxied) ( reason: evaluated allow , deciding_aci: Certificate modification by user.0)*
aclRightsInfo;logs;attributeLevel;search;usercertificate;binary: acl_summary(main): access allowed(search) on entry/attr(uid=user.1,ou=People,dc=example,dc=com, usercertificate;binary) to (uid=user.0,ou=people,dc=example,dc=com) (not proxied) ( reason: evaluated allow , deciding_aci: Anonymous read access)
aclRightsInfo;logs;attributeLevel;read;usercertificate;binary: acl_summary(main): access allowed(read) on entry/attr(uid=user.1,ou=People,dc=example,dc=com, usercertificate;binary) to (uid=user.0,ou=people,dc=example,dc=com) (not proxied) ( reason: evaluated allow , deciding_aci: Anonymous read access)
aclRightsInfo;logs;entryLevel;add: acl_summary(main): access not allowed(add) on entry/attr(uid=user.1,ou=People,dc=example,dc=com, NULL) to (uid=user.0,ou=people,dc=example,dc=com) (not proxied) ( reason: no acis matched the subject )
aclRightsInfo;logs;entryLevel;proxy: acl_summary(main): access not allowed(proxy) on entry/attr(uid=user.1,ou=People,dc=example,dc=com, NULL) to (uid=user.0,ou=people,dc=example,dc=com) (not proxied) ( reason: no acis matched the subject )
aclRightsInfo;logs;attributeLevel;selfwrite_delete;usercertificate;binary: acl_summary(main): access not allowed(write) on entry/attr(uid=user.1,ou=People,dc=example,dc=com, distinguishedName) to (uid=user.0,ou=people,dc=example,dc=com) (not proxied) ( reason: no acis matched the resource )
aclRightsInfo;logs;entryLevel;delete: acl_summary(main): access not allowed(delete) on entry/attr(uid=user.1,ou=People,dc=example,dc=com, NULL) to (uid=user.0,ou=people,dc=example,dc=com) (not proxied) ( reason: no acis matched the subject )
*aclRightsInfo;logs;attributeLevel;write;usercertificate;binary: acl_summary(main): access allowed(write) on entry/attr(uid=user.1,ou=People,dc=example,dc=com, usercertificate;binary) to (uid=user.0,ou=people,dc=example,dc=com) (not proxied) ( reason: evaluated allow , deciding_aci: Certificate modification by user.0)*
aclRightsInfo;logs;attributeLevel;proxy;usercertificate;binary: acl_summary(main): access not allowed(proxy) on entry/attr(uid=user.1,ou=People,dc=example,dc=com, usercertificate;binary) to (uid=user.0,ou=people,dc=example,dc=com) (not proxied) ( reason: no acis matched the subject )



The same problem occurs with an ACI with a regular option :


ds-cfg-global-aci: (targetattr="description;lang-fr")(version 3.0; acl "French Description modification by user.0"; allow (write) userdn="ldap:///uid=user.0,ou=people,dc=example,dc=com";)




$ bin/ldapmodify -p 1389 -D uid=user.0,ou=people,dc=example,dc=com -w password
dn: uid=user.1,ou=people,dc=example,dc=com
changetype: modify
add: description;lang-fr
description;lang-fr: La description

Processing MODIFY request for uid=user.1,ou=people,dc=example,dc=com
MODIFY operation failed
Result Code:  50 (Insufficient Access Rights)
Additional Information:  The entry uid=user.1,ou=people,dc=example,dc=com cannot be modified due to insufficient access rights



Changing the ACI to remove the `;lang-fr` option solves the issue :


ds-cfg-global-aci: (targetattr="description")(version 3.0; acl "French Description modification by user.0"; allow (write) userdn="ldap:///uid=user.0,ou=people,dc=example,dc=com";)




$ bin/ldapmodify -p 1389 -D uid=user.0,ou=people,dc=example,dc=com -w password
dn: uid=user.1,ou=people,dc=example,dc=com
changetype: modify
add: description;lang-fr
description;lang-fr: La description

Processing MODIFY request for uid=user.1,ou=people,dc=example,dc=com
MODIFY operation successful for DN uid=user.1,ou=people,dc=example,dc=com

