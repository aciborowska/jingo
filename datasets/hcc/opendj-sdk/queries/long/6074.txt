Steps to reproduce the issue:

Create two branches (e.g. ou=users,dc=org and ou=users,dc=com) and enable the unique-attribute plugin in one of the branches for a custom attribute, e.g. myUserName


create-plugin \
    --plugin-name "MYUSERNAME unique attribute" \
    --type unique-attribute \
    --set enabled:true \
    --set type:myUserName
set-plugin-prop \
    --plugin-name "MYUSERNAME unique attribute" \
    --add base-dn:ou=users,dc=org

Create an entry under branch ou=users,dc=org with the attribute myUserName and value "test". Create another entry with the same attribute and value under branch ou=users,dc=com.

Perform a modify DN request for the entry in "ou=users,dc=com" with newSuperiorDN "ou=users,dc=org".

Expected behavior

An exception should be raised like the one below:

[LDAP: error code 19 - A unique attribute conflict was detected for attribute myUserName: value test already exists in entry uid=95463533-9001-4689-8a1a-8cae8b58f28e,ou=users,dc=org]

Current behavior

The entry is moved under the branch "ou=users,dc=org" creating a duplicate for the attribute myUserName.

Note

If you try to add an entry or to modify an existing entry, containing a duplicate value, the plugin works fine and an exception is correctly raised.