Configure a user's password policy with a maximum-age and a slightly shorter password-expiration-warning-interval:

    16)  max-password-age                           12 w 6 d
[...]
    21)  password-expiration-warning-interval       12 w 5 d 23 h 59 m


Change a user's password, and then do a search as that user using the --usePasswordPolicyControl flag:

$ bin/ldapmodify -h localhost -p 389 -D "uid=user.0,ou=people,dc=example,dc=com" -w password
dn: uid=user.0,ou=people,dc=example,dc=com
changetype: modify
replace: userPassword
userPassword: secret

$ bin/ldapsearch -h localhost -p 389 -D "uid=user.0,ou=people,dc=example,dc=com" -w secret --usePasswordPolicyControl -b "" -s base "(&)" 1.1
dn: 


In 3.5, the search would return the expiry time warning. In 6.5, the search does not print it out.

In fact, the search now returns a PasswordPolicyResponseControl with no warnings and no errors, ie a (valid) empty ASN.1 SEQUENCE.

This is due to a mistake in BindOperation.newPasswordPolicyResponseControl() that creates an empty control value if pwPolicyWarningType is not null but pwPolicyErrorType is null.

In the test case here, we have a pwPolicyWarningType of PasswordPolicyWarningType.TIME_BEFORE_EXPIRATION and a suitable value. The fix is straightforward.