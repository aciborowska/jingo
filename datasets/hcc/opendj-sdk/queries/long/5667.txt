Found with RC3:

We set up a proxy in front of 2 DJs with data.
We create a new backend on each DJ, import data in them, configure replication.
Then we configure the proxy to route only the new base dn (route-all=False, base-dn=dc=org)


/tmp/PROXY1/opendj/bin/dsconfig -h nameserver.example.com -p 4447 -D "cn=myself" -w password -X set-backend-prop --backend-name proxyRoot --set route-all:False --set base-dn:dc=org -n



Then we search through the proxy for this specific route to check requests are routed correctly.

Finally we set back route-all to true and unconfigure replication:


/tmp/DJ1/opendj/bin/dsreplication unconfigure -h nameserver.example.com -p 4444 -I admin -w password --unconfigureAll -X -n



We get the following error in the logs:


--- Check for error patterns in "/local/GIT/pyforge/results/20181106-112234/proxy_group/RouteConfigurationWithReplication/DJ1/opendj/logs/errors" file --- 	
11:25:06.308 	WARN 	(ERROR) [06/Nov/2018:11:24:57 +0100] category=CORE severity=ERROR msgID=140 msg=An uncaught exception during processing for thread Change number indexer has caused it to terminate abnormally. The stack trace for that exception is: RuntimeException: org.opends.server.replication.server.changelog.api.ChangelogException: Could not create replica database because the changelog database is shutting down (ChangeNumberIndexer.java:607)



This is a regression.

To reproduce:


./run-pybot.py -s proxy_group.RouteConfigurationWithReplication -t Search_With_Specific_Route opendj

