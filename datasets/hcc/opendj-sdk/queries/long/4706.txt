Found with OpenDJ 5.5.0 RC3

Scenario:

We have 2 servers replicated with data on dc=com.
We put a proxy in front of this topology.
We setup a 3rd server and add it to the replication topology:


./DJ1/opendj/bin/dsreplication configure --host1 localhost --port1 4446 --bindDN1 "cn=Directory Manager" --bindPassword1 "password" --replicationPort1 8989 --host2 localhost --port2 4451 --bindDN2 "cn=Directory Manager" --bindPassword2 "password" --replicationPort2 8992 -b dc=com -I admin -w password -X -n

./DJ1/opendj/bin/dsreplication initialize-all -h localhost -p 4446 -b dc=com -I admin -w password -X -n




We add this server as primary server for the proxy:

./PROXY1/opendj/bin/dsconfig -h localhost -p 4452 -D "cn=Directory Manager" -w password -X set-service-discovery-mechanism-prop --mechanism-name "Static Servers Service Discovery Mechanism" --set primary-server:localhost:1391 --set primary-server:localhost:1396 -n



We add 6 entries through the proxy and check the entries are available on all DJ.
Then we perform an export ldif on all 3 servers and a ldifdiff between them all.

data are ok except for the ds-sync-state which is not the correct one on 3rd DJ.