While testing https://bugster.forgerock.org/jira/browse/OPENDJ-6038 I noticed that the supportextract tool fails with NPE when there is Key Manager Provider without key-store-type set while the provider is not enabled.

 

Steps to reproduce:

Manualy:

	setup DS with default values
	add new key manager provider
	
		
./dsconfig -h pyforge.example.com -p 4444 -D "uid=admin" -w password -X create-key-manager-provider --provider-name keyManager0 --type file-based --set enabled:false --set key-store-file:config/keystore -n

	
	
	run support extract tool
	
		
./supportextract -D "uid=admin" -w "password" -d "/tmp" --jdkToolsDirectory /usr/lib/jvm/ojdk11/bin

		output: 

returned 1, expected to be in [0]
-- stdout --
The instance is running
VERSION: 7.0.0.0ef8b5f0ea4ca915fcfd606609424ceea8e28036
Collecting the monitoring info from cn=monitor
Collecting process statistics
Cannot extract process statistics (by running "top" command) on OS 'Linux'.
Only jcmd dump samples will be collected
- Generating stack dump, sample number : 1 using jcmd
- Collecting process thread information, sample number : 1
- Generating stack dump, sample number : 2 using jcmd
- Collecting process thread information, sample number : 2
- Generating stack dump, sample number : 3 using jcmd
- Collecting process thread information, sample number : 3
- Generating stack dump, sample number : 4 using jcmd
- Collecting process thread information, sample number : 4
- Generating stack dump, sample number : 5 using jcmd
- Collecting process thread information, sample number : 5
- Generating stack dump, sample number : 6 using jcmd
- Collecting process thread information, sample number : 6
- Generating stack dump, sample number : 7 using jcmd
- Collecting process thread information, sample number : 7
- Generating stack dump, sample number : 8 using jcmd
- Collecting process thread information, sample number : 8
- Generating stack dump, sample number : 9 using jcmd
- Collecting process thread information, sample number : 9
- Generating stack dump, sample number : 10 using jcmd
- Collecting process thread information, sample number : 10
Collecting the configuration files
- Adding rootUser.ldif
- Adding monitorUser.ldif
- Adding schema files
- Adding archived configs
- Adding HTTP configuration file(s)
- Listing the security stores
  * config/keystore

The following archive has been created :
/home/fuchsik/forks/pyforge/results/20200110-075143/clu_group/DJ1/opendj/tmp/opendj-support-data-20200110-075230.zip

-- stderr --
/home/fuchsik/forks/pyforge/results/20200110-075143/clu_group/DJ1/opendj/tmp/opendj-support-data-20200110-075230.zip.lock
NullPointerException(Objects.java:246)

	
	



Automated:

python3 run-pybot.py -v -s clu_group.supportExtract -t Multiple_Security_Stores_Missing_KeyStore_Type DJ

When I set the key-store-type the NPE is not here and only a message that keystore needs password is here:

...
- Listing the security stores
  * config/keystore
requested entry requires a password
Collecting system node information
...

When I set the key-store-pin property then all is good.

I wouldn't expect these issues when the key manager property is disabled.