When trying to upgrade the embedded OpenDJ in OpenAM, I ended up in an infinite loop with the following stacktrace:

"default task-37" prio=5 tid=0x00007ff461be1800 nid=0x13c07 runnable [0x0000700001eea000]
   java.lang.Thread.State: RUNNABLE
        at java.util.HashMap.initHashSeedAsNeeded(HashMap.java:346)
        at java.util.HashMap.inflateTable(HashMap.java:317)
        at java.util.HashMap.put(HashMap.java:488)
        at java.util.HashSet.add(HashSet.java:217)
        at org.forgerock.opendj.ldap.schema.ObjectClass.validate(ObjectClass.java:1042)
        at org.forgerock.opendj.ldap.schema.SchemaBuilder.validate(SchemaBuilder.java:2697)
        at org.forgerock.opendj.ldap.schema.SchemaBuilder.toSchema(SchemaBuilder.java:2199)
        at org.opends.server.core.SchemaConfigManager$1.update(SchemaConfigManager.java:473)
        at org.opends.server.types.Schema.updateSchema(Schema.java:2005)
        at org.opends.server.core.SchemaConfigManager.updateSchema(SchemaConfigManager.java:468)
        at org.opends.server.core.SchemaConfigManager.updateSchemaWithEntry(SchemaConfigManager.java:383)
        at org.opends.server.core.SchemaConfigManager.loadSchemaFile(SchemaConfigManager.java:370)
        at org.opends.server.core.SchemaConfigManager.initializeSchemaFromFiles(SchemaConfigManager.java:274)
        at org.opends.server.core.DirectoryServer.initializeSchema(DirectoryServer.java:1760)
        at org.opends.server.core.DirectoryServer$InitializationBuilder.initCoreConfig(DirectoryServer.java:846)
        at org.opends.server.core.DirectoryServer$InitializationBuilder.initialize(DirectoryServer.java:786)
        at org.opends.server.tools.RebuildIndex.initializeServer(RebuildIndex.java:352)
        at org.opends.server.tools.RebuildIndex.processLocal(RebuildIndex.java:280)
        at org.opends.server.tools.tasks.TaskTool.process(TaskTool.java:262)
        at org.opends.server.tools.RebuildIndex.process(RebuildIndex.java:208)
        at org.opends.server.tools.RebuildIndex.mainRebuildIndex(RebuildIndex.java:118)
        at com.sun.identity.setup.EmbeddedOpenDS.rebuildIndex(EmbeddedOpenDS.java:1337)
        at com.sun.identity.setup.EmbeddedOpenDS.rebuildIndex(EmbeddedOpenDS.java:1315)
        at com.sun.identity.setup.EmbeddedOpenDS.rebuildSMSIndex(EmbeddedOpenDS.java:1301)



This essentially prevents upgrade from ever completing unfortunately.