Found with opendj 6.5.0 rev 00fd47957e5

We set up 2 servers with data, replicated on 2 different suffixes, dc=com and dc=othersuffix.
We disable the ECL for dc=othersuffix.


/DJ1/opendj/bin/dsconfig -h localhost -p 4444 -D "cn=myself" -w password -X set-external-changelog-domain-prop --provider-name "Multimaster Synchronization" --domain-name dc=othersuffix --set enabled:false -n



We do a ldapmodify and check nothing appears in the changelog:


/DJ1/opendj/bin/ldapmodify -h localhost -p 1389 -D "cn=myself" -w password 	
dn: uid=suffix2,dc=othersuffix
changetype: add
objectclass: top
objectclass: person
objectclass: inetorgperson
sn: Test
cn: Suffix
street: Test Lane
uid: suffix2

/DJ1/opendj/bin/ldapsearch -h localhost -p 1389 -D "cn=myself" -w password -b "" -s base "(objectclass=*)" lastChangeNumber 	

dn: lastChangeNumber: 0



We enable the ECL on dc=othersuffix:

/DJ1/opendj/bin/dsconfig -h localhost -p 4444 -D "cn=myself" -w password -X set-external-changelog-domain-prop --provider-name "Multimaster Synchronization" --domain-name dc=othersuffix --set enabled:true -n



Do a ldapmodify:

/DJ1/opendj/bin/ldapmodify -h localhost -p 1389 -D "cn=myself" -w password 	
dn: uid=suffix3,dc=othersuffix
changetype: add
objectclass: top
objectclass: person
objectclass: inetorgperson
sn: Test
cn: Suffix
street: Test Lane
uid: suffix3



Expect to have 2 changes in the changelog but nothing shows up:


/DJ1/opendj/bin/ldapsearch -h localhost -p 1389 -D "cn=myself" -w password -b "" -s base "(objectclass=*)" lastChangeNumber 	

dn: 
lastChangeNumber: 0



This is a regression.

To reproduce:

./run-pybot.py -n -v -s replication_group2.ExternalChangelogDomainSettings -t Disable_And_Re_Enable_Ecl opendj

