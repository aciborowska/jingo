Trying to restore offline an incremental backup of adminRoot fails if the full backup has been performed with the hash option and then the incremental backups with no hash options.
Two incremental backups needs to be performed

Steps to reproduce


	install a DJ or use an installed version
	perform a backup of the adminRoot backend with the option --hash
	make a modification of adminRoot
	perform an incremental backup of the adminRoot backend without the option --hash
	make a modification of adminRoot
	perform an incremental backup of the adminRoot backend without the option --hash
	restore the last backup



Actual Result

We got an error message that warns the restore fails:



[17/06/2019:17:49:43 +0200] category=TOOLS seq=0 severity=INFO msg=Starting backup for backend adminRoot
[17/06/2019:17:49:43 +0200] category=UTIL seq=1 severity=INFO msg=Backup file has not changed: admin-backend.ldif
[17/06/2019:17:49:43 +0200] category=TOOLS seq=2 severity=INFO msg=The backup process completed successfully
[17/06/2019:17:49:44 +0200] category=TOOLS seq=0 severity=SEVERE msg=An unexpected error occurred while attempting to restore backup baz from zbak/bak2016:  Other: An error occurred while attempting to obtain the SHA-1 message digest to create the hash for the backup: NullPointerException (BackupManager.java:350 BackupManager.java:345 BackupManager.java:329 BackupManager.java:157 BackupManager.java:822 BackupManager.java:1248 BackupManager.java:1187 LDIFBackend.java:893 RestoreDb.java:272 TaskTool.java:295 RestoreDb.java:157 TaskTool.java:269 Utils.java:945 Utils.java:922 RestoreDb.java:82)



Expected Result

Restore being successfully performed

Notes

In attachment, a shell script to reproduce the issue is provided.
Once the issue occurs, it prevents the server from starting back.



 ./bin/start-ds
[17/Jun/2019:17:50:02 +0200] category=CORE severity=NOTICE msgID=134 msg=ForgeRock Directory Services 7.0.0-SNAPSHOT (build 20190617145911, revision number af188bfa3d36b6ad32076c5c0c5bb7ffdb6a2fbc) starting up
[17/Jun/2019:17:50:02 +0200] category=JVM severity=NOTICE msgID=21 msg=Installation Directory:  /home/ctranxuan/runtimes/forgerock/opendj-7.0.0-SNAPSHOT
[17/Jun/2019:17:50:02 +0200] category=JVM severity=NOTICE msgID=23 msg=Instance Directory:      /home/ctranxuan/runtimes/forgerock/opendj-7.0.0-SNAPSHOT
[17/Jun/2019:17:50:02 +0200] category=JVM severity=NOTICE msgID=17 msg=JVM Information: 1.8.0_172-b01 by Azul Systems, Inc., 64-bit architecture, 7411859456 bytes heap size
[17/Jun/2019:17:50:02 +0200] category=JVM severity=NOTICE msgID=18 msg=JVM Host: ctranxuan-laptop, running Linux 4.18.0-21-generic amd64, 33352634368 bytes physical memory size, number of processors available 12
[17/Jun/2019:17:50:02 +0200] category=JVM severity=NOTICE msgID=19 msg=JVM Arguments: "-Dorg.opends.server.scriptName=start-ds"
[17/Jun/2019:17:50:02 +0200] category=CORE severity=NOTICE msgID=139 msg=The Directory Server has sent an alert notification generated by class org.opends.server.core.DirectoryServer (alert type org.opends.server.DirectoryServerShutdown, alert ID org.opends.messages.core-141): The Directory Server has started the shutdown process. The shutdown was initiated by an instance of class org.opends.server.core.DirectoryServer and the reason provided for the shutdown was An error occurred while attempting to bootstrap the Directory Server: CryptoManager failed to publish the instance-key-pair public-key-certificate entry in ADS: No Such Entry: Failed to add entry "ds-cfg-key-id=4314252676B1FCCEB6A51129ACA4A19E,cn=instance keys,cn=admin data"
[17/Jun/2019:17:50:02 +0200] category=CORE severity=NOTICE msgID=203 msg=The Directory Server is now stopped

