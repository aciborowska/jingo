This is potentially two different issues. Firstly a generic performance regression for the use-case described below (which may turn out to be covered by other more specific Jira issues, or could be linked to the second issue).

The second issue is that the ability to check membership against a virtual static group no longer works (2.6.x vs 3.0+) unless 'allow-retrieving-membership' is set to true.

To demonstrate both issues, set up a script that does the following:

1) Install DJ with 50k test users
2) Add the attached LDIF, containing a dynamic group that resolves to 11 members and a virtual static group pointing to it.
3) Delete uniqueMember index.
4) If testing with 'allow-retrieving-membership', set this to true
5) Run the following searchrate:



./searchrate -p 1389 -D "cn=Directory Manager" -w password -F -b "ou=groups,dc=example,dc=com" "uniqueMember=uid=user.9991,ou=people,dc=example,dc=com" dn



Running this across different versions of OpenDJ with step 4) included or skipped gives the following results:




Â 
2.6.4 op/s
3.0.0 op/s
4.0.0 op/s


allow-retrieving-membership=true
3000
160
160


allow-retrieving-membership=false
3000
N/A*
N/A*






* = Group not returned


The 4.0.0 build was a build from master, approximately 17th June 2016.