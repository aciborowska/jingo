Found with rev (3c8553b5c90)

With COMMONS-529: When using substitution service, the escaping handling has been updated. The only characters that can be escaped are '&' '|' '}' .

To map this, i have updated the tests we had for escaping characters in tokens.
 It seems to be working fine with '}' and '&'. But I couldn't make that work with '|' on dj side:

ie

For & and }:
in env: LISTEN_PORT_ENV='8\}\&888'
in java args: '-Dlisten.port.property=\}88\&'

setting http connection handler:
/Users/carole.forel/wks/pyforge/results/20200117-150440/commons_config_group/DJ1/opendj/bin/dsconfig --offline set-connection-handler-prop --handler-name "HTTP Connection Handler" --set listen-port:"&{listen.port.env}&{listen.port.property}" -n

starting the server:
	/Users/carole.forel/wks/pyforge/results/20200117150440/commons_config_group/DJ1/opendj/bin/start-ds 	

[17/Jan/2020:15:05:10 +0100] category=CORE severity=NOTICE msgID=134 msg=ForgeRock Directory Services 7.0.0-SNAPSHOT (build 20200114102503, revision number 3c8553b5c90979b42bd22b70a012e6aba3e18248) starting up
[17/Jan/2020:15:05:10 +0100] category=JVM severity=NOTICE msgID=21 msg=Installation Directory:  /Users/carole.forel/wks/pyforge/results/20200117-150440/commons_config_group/DJ1/opendj
[17/Jan/2020:15:05:10 +0100] category=JVM severity=NOTICE msgID=23 msg=Instance Directory:      /Users/carole.forel/wks/pyforge/results/20200117-150440/commons_config_group/DJ1/opendj
[17/Jan/2020:15:05:10 +0100] category=JVM severity=NOTICE msgID=17 msg=JVM Information: 11.0.5+10 by AdoptOpenJDK, 64-bit architecture, 8589934592 bytes heap size
[17/Jan/2020:15:05:10 +0100] category=JVM severity=NOTICE msgID=18 msg=JVM Host: openam.example.com default/dj1, running Mac OS X 10.14.6 x86_64, 34359738368 bytes physical memory size, number of processors available 16
[17/Jan/2020:15:05:10 +0100] category=JVM severity=NOTICE msgID=19 msg=JVM Arguments: "-Dlisten.port.property=\}88\&", "-Dorg.opends.server.scriptName=start-ds"
[17/Jan/2020:15:05:11 +0100] category=BACKEND severity=NOTICE msgID=513 msg=The database backend appData containing 0 entries has started
[17/Jan/2020:15:05:11 +0100] category=CORE severity=NOTICE msgID=139 msg=The Directory Server has sent an alert notification generated by class org.opends.server.core.DirectoryServer (alert type org.opends.server.DirectoryServerShutdown, alert ID org.opends.messages.core-141): The Directory Server has started the shutdown process. The shutdown was initiated by an instance of class org.opends.server.core.DirectoryServer and the reason provided for the shutdown was An error occurred while attempting to bootstrap the Directory Server: An error occurred while trying to decode the managed object configuration entry cn=HTTP Connection Handler,cn=connection handlers,cn=config: The HTTP Connection Handler could not be decoded due to the following reason: The value "8}&888}88&" is not a valid value for the "listen-port" property, which must have the following syntax: 1 <= INTEGER <= 65535
[17/Jan/2020:15:05:11 +0100] category=BACKEND severity=NOTICE msgID=370 msg=The backend appData is now taken offline
[17/Jan/2020:15:05:11 +0100] category=CORE severity=NOTICE msgID=203 msg=The Directory Server is now stopped


We can see resolution matches expectations: The value "8}&888}88&" is not a valid value ...

When trying with |, it fails with the following:

[17/Jan/2020:17:09:20 +0100] category=BACKEND severity=NOTICE msgID=513 msg=The database backend appData containing 0 entries has started
[17/Jan/2020:17:09:20 +0100] category=CORE severity=NOTICE msgID=139 msg=The Directory Server has sent an alert notification generated by class org.opends.server.core.DirectoryServer (alert type org.opends.server.DirectoryServerShutdown, alert ID org.opends.messages.core-141): The Directory Server has started the shutdown process. The shutdown was initiated by an instance of class org.opends.server.core.DirectoryServer and the reason provided for the shutdown was An error occurred while attempting to bootstrap the Directory Server: An error occurred while trying to decode the managed object configuration entry cn=HTTP Connection Handler,cn=connection handlers,cn=config: The HTTP Connection Handler could not be decoded due to the following reason: The value "8}&\|888}88&\|" is not a valid value for the "listen-port" property, which must have the following syntax: 1 <= INTEGER <= 65535
[17/Jan/2020:17:09:20 +0100] category=BACKEND severity=NOTICE msgID=370 msg=The backend appData is now taken offline
[17/Jan/2020:17:09:20 +0100] category=CORE severity=NOTICE msgID=203 msg=The Directory Server is now stopped
Â 

'|' is still backslashed.
 Am i doing something wrong or is it a problem?