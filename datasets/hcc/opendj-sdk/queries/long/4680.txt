During preparation of new tests for json equality matching rule I noticed that json attribute is handled in a different way in rest2ldap gateway and with http connection handler.

The setting is same as in another issue I have opened =>  https://bugster.forgerock.org/jira/browse/OPENDJ-4588 .

The difference is that now the mapping of jsonAttr attribute in rest2ldap gateway and in http connection handler is configured to be type of "simple" . This was the output of previous issue, that json equality matching rule need a type simple to work with rest2ldap gateway.

The read request:

Url: http://pyforge.example.com:8080/api/action/users/pepe.roni_Embedded None method: get params: {'_fields': 'jsonAttr', '_prettyPrint': 'true'} headers: {'Content-Type': 'application/json'} certificate: None auth: ('admin_user', 'admin_password')

The result on gateway:

{ "_id" : "pepe.roni_Embedded", "_rev" : "00000000c508b12a", "jsonAttr" : "{\"name\":\"Pepe\",\"surname\":\"Roni\",\"age\":\"26\",\"language\":\"Italian\"}" }

The result on http connection handler:

{ "_id" : "pepe.roni_Embedded", "_rev" : "00000000fd62b338", "jsonAttr" : { "name" : "Pepe", "surname" : "Roni", "age" : "26", "language" : "Italian" } }

When we compare those results it looks like gateway evaluated the jsonAttr's value as string (from my point of view this is correct as we set type simple). However http connection handler evaluated the jsonAttr's value as json object (because there is no double quotes before "{" ).

Entry above looks like:

dn: uid=pepe.roni_Embedded,ou=people,dc=action,dc=com
objectClass: person
objectClass: jsonCustomObject
objectClass: inetOrgPerson
objectClass: organizationalPerson
objectClass: top
uid: pepe.roni_Embedded'
userpassword: password
givenname: Pepe
cn: Pepe Roni
sn: Roni
mail: pepe.roni@example.com
description: Original description'
jsonAttr:{"name":"Pepe","surname":"Roni","age":"26","language":"Italian"}

_______________________________________________________

To reproduce the problem try our framework with following command:

./run-pybot.py -s rest2ldap_group.jsonAttr -t Read_Json_Attribute_Equality_Matching_Rule -v opendj

When this run ends, one test is failed (with http connection handler).