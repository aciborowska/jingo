When restoring a signed hashed backup file provided by the customer, DS  gives a NullPointerException:


# restore -h localhost -p 4444 -D "cn=Directory Manager" -w password --backupDirectory /OpenDJ/opendj/bak/userstore/ --trustAll --backupID userstore-full-20200901003000000
Restore task 20200921101427852 scheduled to start immediately
[21/Sep/2020:10:14:27 -0400] severity="NOTICE" msgCount=0 msgID=org.opends.messages.backend-413 message="Restore task 20200921101427852 started execution"
[21/Sep/2020:10:14:27 -0400] severity="NOTICE" msgCount=1 msgID=org.opends.messages.backend-370 message="The backend userRoot is now taken offline"
[21/Sep/2020:10:14:27 -0400] severity="ERROR" msgCount=2 msgID=org.opends.messages.tool-317 message="An unexpected error occurred while attempting to restore backup userstore-full-20200901003000000 from /OpenDJ/opendj/bak/userstore:  NullPointerException(BackupManager.java:296)"
[21/Sep/2020:10:14:27 -0400] severity="INFORMATION" msgCount=3 msgID=org.opends.messages.backend-410 message="JE backend 'userRoot' does not specify the number of cleaner threads: defaulting to 2 threads"
[21/Sep/2020:10:14:27 -0400] severity="INFORMATION" msgCount=4 msgID=org.opends.messages.backend-411 message="JE backend 'userRoot' does not specify the number of lock tables: defaulting to 13"
[21/Sep/2020:10:14:28 -0400] severity="NOTICE" msgCount=5 msgID=org.opends.messages.backend-513 message="The database backend userRoot containing 1171 entries has started"
[21/Sep/2020:10:14:28 -0400] severity="INFORMATION" msgCount=6 msgID=org.opends.messages.access_control-50 message="Added 29 Access Control Instruction (ACI) attribute types found in context "dc=swisssign,dc=com" to the access control evaluation engine"
[21/Sep/2020:10:14:28 -0400] severity="NOTICE" msgCount=7 msgID=org.opends.messages.backend-414 message="Restore task 20200921101427852 finished execution in the state Completed with errors"
Restore task 20200921101427852 did not complete successfully 

The entry in backup.info was:


backup_id=userstore-full-20200901003000000
backup_date=20200901003001Z
incremental=false
compressed=true
encrypted=false
signed_hash=V0UGDU+ib+saxDFwpI3TAeJapok=
property.archive_file=backup-userstore-userstore-full-20200901003000000
property.last_logfile_size=40080575
property.last_logfile_name=00000000.jdb
property.mac_key_id=1aa80fd0-e928-4bd3-9fb0-802ac068ae25 

It was observed that if we remove the "signed_hash=V0UGDU+ib+saxDFwpI3TAeJapok=" line from the above file, then the restore completes successfully. Nevertheless, the error message is not helpful and does not offer a clue as to what is wrong.

I was able to reproduce the same issue by using the backup file provided by the customer.

I could not reproduce using a signed hashed backup file that I created myself.