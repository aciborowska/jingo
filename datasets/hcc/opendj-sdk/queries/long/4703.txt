Take the following script:


#!/bin/bash
cts1/bin/stop-ds
cts2/bin/stop-ds
rm -Rf cts1
rm -Rf cts2
unzip software/opendj-3.5.0.zip 
mv opendj cts1
cts1/setup --cli --rootUserDN "cn=Directory Manager" --rootUserPassword cangetindj --hostname ${HOSTNAME} --ldapPort 10389 --adminConnectorPort 10444 --baseDN dc=cts,dc=forgerock,dc=com --addBaseEntry --acceptLicense --backendType je --no-prompt --noPropertiesFile
sleep 10
unzip software/opendj-3.5.0.zip 
mv opendj cts2
cts2/setup --cli --rootUserDN "cn=Directory Manager" --rootUserPassword cangetindj --hostname ${HOSTNAME} --ldapPort 11389 --adminConnectorPort 11444 --baseDN dc=cts,dc=forgerock,dc=com --addBaseEntry --acceptLicense --backendType je --no-prompt --noPropertiesFile

This works fine.

If I switch the zip file to opendj-3.5.3.zip, the second server fails to install with the following error:


Creating Base Entry dc=cts,dc=forgerock,dc=com ..... 
Error Creating Base Entry.
See /tmp/opendj-setup-1421512543026008989.log for a detailed log of the failed
operation.

...and this in the log:


[25/01/2018:09:17:56 +0000] category=TOOLS seq=9 severity=SEVERE msg=An error occurred while attempting to process the LDIF import:  The database environment could not be opened: com.sleepycat.je.EnvironmentFailureException: (JE 7.3.7) /home/si/envs/cts2/db/userRoot Can not register /home/si/envs/cts2/db/userRoot or its sub-directories to WatchService. UNEXPECTED_EXCEPTION: Unexpected internal Exception, may have side effects. Environment is invalid and must be closed.

With help from Chris Ridd, I found that this is related to running out of available inotify watches. This is because DJ 3.5.3 is now built with JE 7, which uses inotify on linux.

Recomend updating install docs, release notes etc for DJ 3.5.3 to set the following (which is already described in the DS 5.5 docs):


sysctl --write fs.inotify.max_user_watches=524288

 

 

 

 