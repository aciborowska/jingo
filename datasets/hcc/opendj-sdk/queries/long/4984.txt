Found with M120.7

We set up a server.

We enable confidentiality on backend:

./DJ1/opendj/bin/dsconfig -h localhost -p 4447 -D "cn=myself" -w password -X set-backend-prop --backend-name userRoot --set confidentiality-enabled:true -n
 

We enable confidentiality for all indexes too.

We set up a second server.
 Enable confidentiality on its backend and the indexes for this backend.
 We configure replication between these 2 servers, enable confidentiality on changelog and initialize-all.

Our test then performs the following steps for binary copy in offline mode:

./DJ1/opendj/bin/dsreplication pre-external-initialization -h localhost -p 4447 -b dc=com -I admin -w password -X -n

./DJ1/opendj/bin/stop-ds 

./DJ2/opendj/bin/stop-ds

./DJ1/opendj/bin/import-ldif --offline -n userRoot -O -l /local/GIT/pyforge/PyBot/OpenDJ/testcases/data/replication_startup.ldif

./DJ1/opendj/bin/backup --offline -n userRoot -d /tmp/backup_offline 
./DJ2/opendj/bin/restore --offline -d /tmp/backup_offline 
./DJ1/opendj/bin/start-ds 
./DJ2/opendj/bin/start-ds 
./DJ1/opendj/bin/dsreplication post-external-initialization -h localhost -p 4447 -b dc=com -I admin -w password -X -n


When starting DJ1, we get the following error message in server.out and errors:

[09/Apr/2018:17:26:00 +0200] category=SYNC severity=ERROR msgID=119 msg=Directory server DS(18454) encountered an unexpected error while connecting to replication server localhost:8989 for domain "dc=com": SocketTimeoutException: Read timed out (SocketInputStream.java:-2 SocketInputStream.java:116 SocketInputStream.java:171 SocketInputStream.java:141 BufferedInputStream.java:246 BufferedInputStream.java:286 BufferedInputStream.java:345 Session.java:334 Session.java:305 ReplicationBroker.java:1014 ReplicationBroker.java:701 ReplicationBroker.java:267 ReplicationDomain.java:2431 LDAPReplicationDomain.java:521 MultimasterReplication.java:295 MultimasterReplication.java:271 MultimasterReplication.java:342 MultimasterReplication.java:85 SynchronizationProviderConfigManager.java:259 SynchronizationProviderConfigManager.java:94 DirectoryServer.java:1323 ...)

and in errors also:
category=SYNC severity=ERROR msgID=-1 msg=Other: Read timed out

and also, sometimes:
(ERROR) [09/Apr/2018:17:49:26 +0200] category=SYNC severity=NOTICE msgID=53 msg=Exception when reading messages from Replica DS(7432) for domain "dc=com": NumberFormatException: For input string: "���\xef\xbf\xbd\xef\xbf\xbd" (NumberFormatException.java:65 Integer.java:569 Session.java:327 ServerReader.java:82)




When starting DJ2, we also get that:

category=SYNC severity=ERROR msgID=108 msg=Unable to send monitor data request for domain "dc=com" to replication server RS(8187) due to the following error: Broken pipe (Write failed)


to reproduce: in config/config.cfg, in OpenDJ section, add:

database_encrypted = True
 indexes_encrypted = True
 changelog_encrypted = True

then run:
 ./run-pybot.py -s replication_group1.BinaryCopy -t Offline_Initialisation opendj

 

we did not get theses errors in 5.0.0