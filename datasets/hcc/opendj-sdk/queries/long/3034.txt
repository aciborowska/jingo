Steps to produce:

1) Install OpenDJ with test users.
2) Run a search:



./ldapsearch -b "dc=example,dc=com" "mail=test\ff"



(mail should have an equality index and 'test\ff' is invalid because \ff isn't allowed in an IA5String)

Result:

If user has unindexed-search privilege, every entry will be checked even though it's certain that nothing will match.

If user hasn't got the unindexed-search privilege, they will receive:



SEARCH operation failed
Result Code:  50 (Insufficient Access Rights)
Additional Information:  You do not have sufficient privileges to perform an unindexed search



In 2.6.x this behaviour was different, the invalid filter would evaluate to an empty result set rather than completely unindexed.

A quick initial debug shows that the following change would revert the behaviour (in this case) back to match 2.6.x:



--- a/opendj-server-legacy/src/main/java/org/opends/server/backends/pluggable/AttributeIndex.java
+++ b/opendj-server-legacy/src/main/java/org/opends/server/backends/pluggable/AttributeIndex.java
@@ -664,7 +664,7 @@ class AttributeIndex implements ConfigurationChangeListener<BackendIndexCfg>, Cl
     catch (DecodeException e)
     {
       logger.traceException(e);
-      return newUndefinedSet();
+      return newDefinedSet(0);
     }
   }

