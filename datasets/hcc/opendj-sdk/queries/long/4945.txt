With daily test we hit a new problem during a start up of server:


[29/Mar/2018:03:51:04 +0100] category=CONFIG severity=ERROR msgID=442 msg=An error occurred while trying to initialize an instance of class org.opends.server.extensions.ExactMatchIdentityMapper as an identity mapper as defined in configuration entry cn=id_mapper_cn,cn=Identity Mappers,cn=config: ConfigException: The baseDN 'ou=Auth,dc=com' specified as match base DN in the exact match identity mapper defined in configuration entry 'cn=id_mapper_cn,cn=Identity Mappers,cn=config', does not belong to a local backend (ExactMatchIdentityMapper.java:99 ExactMatchIdentityMapper.java:69 IdentityMapperConfigManager.java:268 IdentityMapperConfigManager.java:89 DirectoryServer.java:1275 DirectoryServer.java:4079)


 

I also noticed some errors in error log:


[29/Mar/2018:03:51:04 +0100] category=CONFIG severity=ERROR msgID=442 msg=An error occurred while trying to initialize an instance of class org.opends.server.extensions.ExactMatchIdentityMapper as an identity mapper as defined in configuration entry cn=id_mapper_cn,cn=Identity Mappers,cn=config: ConfigException: The baseDN 'ou=Auth,dc=com' specified as match base DN in the exact match identity mapper defined in configuration entry 'cn=id_mapper_cn,cn=Identity Mappers,cn=config', does not belong to a local backend (ExactMatchIdentityMapper.java:99 ExactMatchIdentityMapper.java:69 IdentityMapperConfigManager.java:268 IdentityMapperConfigManager.java:89 DirectoryServer.java:1275 DirectoryServer.java:4079)





 [29/Mar/2018:03:51:18 +0100] category=CORE severity=NOTICE msgID=139 msg=The Directory Server has sent an alert notification generated by class org.opends.server.core.DirectoryServer (alert type org.opends.server.DirectoryServerShutdown, alert ID org.opends.messages.core-141): The Directory Server has started the shutdown process. The shutdown was initiated by an instance of class org.opends.server.core.DirectoryServer and the reason provided for the shutdown was An error occurred while attempting to bootstrap the Directory Server: An error occurred while trying to initialize an instance of class org.opends.server.protocols.http.authz.HttpBasicAuthorizationMechanism as an HTTP endpoint as defined in configuration entry cn=HTTP Basic,cn=HTTP Authorization Mechanisms,cn=config: NullPointerException: identityMapper cannot be null (Reject.java:82 HttpBasicAuthorizationMechanism.java:103 HttpBasicAuthorizationMechanism.java:67 NativeConstructorAccessorImpl.java:-2 NativeConstructorAccessorImpl.java:62 DelegatingConstructorAccessorImpl.java:45 Constructor.java:423 HttpAuthorizationMechanismFactory.java:56 HttpEndpointConfigManager.java:330 HttpEndpointConfigManager.java:248 HttpEndpointConfigManager.java:95 DirectoryServer.java:1363 DirectoryServer.java:4079)


 

Steps:

1 We add new schema provider:


.\dsconfig.bat -h pyforge.example.com -p 4444 -D "cn=myself" -w password -X create-schema-provider --provider-name "testJsonEqMatchRule" --set enabled:true --set matching-rule-oid:1.3.6.1.4.1.36733.2.1.4.900.1 --set matching-rule-name:testJsonEqMatchRule --type json-equality-matching-rule --set json-keys:"/name" --set case-sensitive-strings:false -n


2 Basically we add new schema definition with ldapmodify, LDIF:


dn: cn=schema
changetype: modify
add: attributeTypes
attributeTypes: ( json-custom-attribute-oid NAME 'jsonAttr' SYNTAX 1.3.6.1.4.1.36733.2.1.3.1 EQUALITY testJsonEqMatchRule SINGLE-VALUE X-ORIGIN 'OpenDJ Documentation Examples' )
-
add: objectClasses
objectClasses: ( json-custom-object-class-oid NAME 'jsonCustomObject' SUP top AUXILIARY MAY ( jsonAttr ) X-ORIGIN 'OpenDJ Documentation Examples' )

3 We add few entries like:


dn: uid=hugh.morr_Embedded,ou=people,dc=jsonattr,dc=com 
objectClass: person
objectClass: jsonCustomObject 
objectClass: inetOrgPerson 
objectClass: organizationalPerson 
objectClass: top 
uid: hugh.morr_Embedded 
userpassword: password 
givenname: Hugh 
cn: Hugh Morr 
sn: Morr 
mail: hugh.morr@example.com 
description: Original description 
jsonAttr:{"name":"Hugh","surname":"Morr","age":"26","language":"English


4 Create index:


create-backend-index --backend-name userRoot --type generic --index-name jsonAttr --set index-type:equality 

The Backend Index was created successfully


5 Stop server and rebuild all indexes:


.\rebuild-index.bat --offline -b dc=com -i jsonAttr	

[29/03/2018:03:50:55 +0100] category=BACKEND seq=0 severity=FINE msg=JE backend 'userRoot' does not specify the number of cleaner threads: defaulting to 2 threads 
[29/03/2018:03:50:55 +0100] category=BACKEND seq=1 severity=FINE msg=JE backend 'userRoot' does not specify the number of lock tables: defaulting to 13 
[29/03/2018:03:50:56 +0100] category=BACKEND seq=35 severity=INFO msg=Rebuild of index(es) jsonAttr.extensibleJsonEqualityMatch:caseIgnoreStrings:ignoreWhiteSpace:/name started with 277 total entries to process 
[29/03/2018:03:50:56 +0100] category=BACKEND seq=36 severity=INFO msg=The amount of free memory available to the import task is 82239558 bytes. The number of phase one buffers required is 8 buffers 
[29/03/2018:03:50:56 +0100] category=BACKEND seq=37 severity=INFO msg=Setting DB cache size to 33554432 bytes and phase one buffer size to 10279944 bytes 
[29/03/2018:03:50:57 +0100] category=BACKEND seq=38 severity=INFO msg=Index /dc=com/jsonAttr.extensibleJsonEqualityMatch:caseIgnoreStrings:ignoreWhiteSpace:/name phase two started processing 1 buffers in 1 batches 
[29/03/2018:03:50:57 +0100] category=BACKEND seq=39 severity=INFO msg=Index /dc=com/jsonAttr.extensibleJsonEqualityMatch:caseIgnoreStrings:ignoreWhiteSpace:/name phase two processing completed 
[29/03/2018:03:50:57 +0100] category=BACKEND seq=40 severity=INFO msg=Rebuild complete. Processed 277 entries in 0 seconds (average rate 752.7/sec)



6 Start the server:


[29/Mar/2018:03:51:01 +0100] category=CORE severity=NOTICE msgID=134 msg=ForgeRock Directory Services 6.0.0-SNAPSHOT (build 20180328234626Z, revision number 2d006f3045406838bfdb00a36f61b59622d10490) starting up 
[29/Mar/2018:03:51:03 +0100] category=JVM severity=NOTICE msgID=21 msg=Installation Directory: E:\jenkins\workspace\tests_daily\Configs\results\20180329-033421\rest2ldap_group\DJ\opendj 
[29/Mar/2018:03:51:03 +0100] category=JVM severity=NOTICE msgID=23 msg=Instance Directory: E:\jenkins\workspace\tests_daily\Configs\results\20180329-033421\rest2ldap_group\DJ\opendj 
[29/Mar/2018:03:51:03 +0100] category=JVM severity=NOTICE msgID=17 msg=JVM Information: 1.8.0_121-b13 by Oracle Corporation, 64-bit architecture, 1908932608 bytes heap size 
[29/Mar/2018:03:51:03 +0100] category=JVM severity=NOTICE msgID=18 msg=JVM Host: ig-win2016.internal.forgerock.com, running Windows NT (unknown) 10.0 amd64, 8589463552 bytes physical memory size, number of processors available 4 [29/Mar/2018:03:51:03 +0100] category=JVM severity=NOTICE msgID=19 msg=JVM Arguments: "-Dorg.opends.server.scriptName=start-ds" 
[29/Mar/2018:03:51:04 +0100] category=CONFIG severity=ERROR msgID=442 msg=An error occurred while trying to initialize an instance of class org.opends.server.extensions.ExactMatchIdentityMapper as an identity mapper as defined in configuration entry cn=id_mapper_cn,cn=Identity Mappers,cn=config: ConfigException: The baseDN 'ou=Auth,dc=com' specified as match base DN in the exact match identity mapper defined in configuration entry 'cn=id_mapper_cn,cn=Identity Mappers,cn=config', does not belong to a local backend (ExactMatchIdentityMapper.java:99 ExactMatchIdentityMapper.java:69 IdentityMapperConfigManager.java:268 IdentityMapperConfigManager.java:89 DirectoryServer.java:1275 DirectoryServer.java:4079) 
[29/Mar/2018:03:51:13 +0100] category=BACKEND severity=NOTICE msgID=513 msg=The database backend userRoot containing 277 entries has started 
[29/Mar/2018:03:51:14 +0100] category=EXTENSIONS severity=NOTICE msgID=221 msg=DIGEST-MD5 SASL mechanism using a server fully qualified domain name of: ig-win2016.internal.forgerock.com 
[29/Mar/2018:03:51:18 +0100] category=PROTOCOL severity=NOTICE msgID=276 msg=Started listening for new connections on Administration Connector 0.0.0.0 port 4444[29/Mar/2018:03:51:18 +0100] category=PROTOCOL severity=NOTICE msgID=276 msg=Started listening for new connections on LDAP 0.0.0.0 port 1389 
[29/Mar/2018:03:51:18 +0100] category=PROTOCOL severity=NOTICE msgID=276 msg=Started listening for new connections on LDAPS 0.0.0.0 port 1636 
[29/Mar/2018:03:51:18 +0100] category=CORE severity=NOTICE msgID=135 msg=The Directory Server has started successfully 
[29/Mar/2018:03:51:18 +0100] category=CORE severity=NOTICE msgID=139 msg=The Directory Server has sent an alert notification generated by class org.opends.server.core.DirectoryServer (alert type org.opends.server.DirectoryServerStarted, alert ID org.opends.messages.core-135): The Directory Server has started successfully 
[29/Mar/2018:03:51:18 +0100] category=CORE severity=NOTICE msgID=139 msg=The Directory Server has sent an alert notification generated by class org.opends.server.core.DirectoryServer (alert type org.opends.server.DirectoryServerShutdown, alert ID org.opends.messages.core-141): The Directory Server has started the shutdown process. The shutdown was initiated by an instance of class org.opends.server.core.DirectoryServer and the reason provided for the shutdown was An error occurred while attempting to bootstrap the Directory Server: An error occurred while trying to initialize an instance of class org.opends.server.protocols.http.authz.HttpBasicAuthorizationMechanism as an HTTP endpoint as defined in configuration entry cn=HTTP Basic,cn=HTTP Authorization Mechanisms,cn=config: NullPointerException: identityMapper cannot be null (Reject.java:82 HttpBasicAuthorizationMechanism.java:103 HttpBasicAuthorizationMechanism.java:67 NativeConstructorAccessorImpl.java:-2 NativeConstructorAccessorImpl.java:62 DelegatingConstructorAccessorImpl.java:45 Constructor.java:423 HttpAuthorizationMechanismFactory.java:56 HttpEndpointConfigManager.java:330 HttpEndpointConfigManager.java:248 HttpEndpointConfigManager.java:95 DirectoryServer.java:1363 DirectoryServer.java:4079) 
[29/Mar/2018:03:51:18 +0100] category=PROTOCOL severity=NOTICE msgID=276 msg=Started listening for new connections on HTTP Connection Handler 0.0.0.0 port 8080 
[29/Mar/2018:03:51:18 +0100] category=PROTOCOL severity=NOTICE msgID=277 msg=Stopped listening for new connections on Administration Connector 0.0.0.0 port 4444 
[29/Mar/2018:03:51:18 +0100] category=PROTOCOL severity=NOTICE msgID=277 msg=Stopped listening for new connections on LDAP 0.0.0.0 port 1389 
[29/Mar/2018:03:51:18 +0100] category=PROTOCOL severity=NOTICE msgID=277 msg=Stopped listening for new connections on LDAPS 0.0.0.0 port 1636 
[29/Mar/2018:03:51:18 +0100] category=BACKEND severity=NOTICE msgID=370 msg=The backend userRoot is now taken offline [29/Mar/2018:03:51:18 +0100] category=CORE severity=NOTICE msgID=203 msg=The Directory Server is now stopped


 

Looks like a side effect of commit https://stash.forgerock.org/projects/OPENDJ/repos/opendj/commits/ec9c53e3e5b4748c887d184d684b039a3852e39f  .

Command to reproduce the problem with test framwork:

./run-pybot.py -s rest2ldap_group.JsonAttrEmbedded -v opendj

NOTE: adding an Impediment flag, because due to this we are not able to verify issues which should be resolved in the same suite.