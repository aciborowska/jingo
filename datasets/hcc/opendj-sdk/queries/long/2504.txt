Found by Robert Wapshott while integrating OpenDJ3 into OpenAM.


It appears the server is throwing a NPE when performing the following query:
SearchOperation(connID=0, opID=1794, baseDN=ou=Policies,ou=default,ou=OrganizationConfig,ou=1.0,ou=iPlanetAMPolicyService,ou=services,o=sunamhiddenrealmdelegationservicepermissions,ou=services,dc=openam,dc=forgerock,dc=org, scope=one, filter=(objectClass=*))

Here is the reported stacktrace:

"Worker Thread 21@10909" daemon prio=5 tid=0x158 nid=NA runnable
  java.lang.Thread.State: RUNNABLE
          at org.forgerock.opendj.ldap.ByteString.compareTo(ByteString.java:661)
          at org.opends.server.backends.pluggable.DN2ID$ChildrenCursor.next(DN2ID.java:310)
          at org.opends.server.backends.pluggable.CursorTransformer$SequentialCursorAdapter.next(CursorTransformer.java:243)
          at org.opends.server.backends.pluggable.CursorTransformer.next(CursorTransformer.java:188)
          at org.opends.server.backends.pluggable.EntryContainer.newIDSetFromCursor(EntryContainer.java:1020)
          at org.opends.server.backends.pluggable.EntryContainer.access$1800(EntryContainer.java:123)
          at org.opends.server.backends.pluggable.EntryContainer$3.getIDSetFromScope(EntryContainer.java:980)
          at org.opends.server.backends.pluggable.EntryContainer$3.run(EntryContainer.java:832)
          at org.opends.server.backends.pluggable.EntryContainer$3.run(EntryContainer.java:702)
          at org.opends.server.backends.jeb.JEStorage.read(JEStorage.java:769)
          at org.opends.server.backends.pluggable.TracedStorage.read(TracedStorage.java:506)
          at org.opends.server.backends.pluggable.EntryContainer.search(EntryContainer.java:701)
          at org.opends.server.backends.pluggable.BackendImpl.search(BackendImpl.java:592)
          at org.opends.server.workflowelement.localbackend.LocalBackendSearchOperation.processSearch(LocalBackendSearchOperation.java:234)
          at org.opends.server.workflowelement.localbackend.LocalBackendSearchOperation.processLocalSearch(LocalBackendSearchOperation.java:111)
          at org.opends.server.workflowelement.localbackend.LocalBackendWorkflowElement.execute(LocalBackendWorkflowElement.java:733)
          at org.opends.server.workflowelement.localbackend.LocalBackendWorkflowElement.executeOnNonRootDSE(LocalBackendWorkflowElement.java:1024)
          at org.opends.server.workflowelement.localbackend.LocalBackendWorkflowElement.execute(LocalBackendWorkflowElement.java:895)
          at org.opends.server.core.SearchOperationBasis.run(SearchOperationBasis.java:1015)
          at org.opends.server.extensions.TraditionalWorkerThread.run(TraditionalWorkerThread.java:158)

