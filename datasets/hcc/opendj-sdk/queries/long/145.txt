Steps to reproduce:

	unzip OpenDJ-2.4.0.zip
	configure the directory:



./setup --cli --baseDN dc=example,dc=com --addBaseEntry --ldapPort 389 --adminConnectorPort 4444 --rootUserDN cn=Directory\ Manager --rootUserPassword password --no-prompt --noPropertiesFile


	apply the patch: ./opendj_patch4upgrade.sh




	create the .opends/tools.properties with following contents:



hostname=localhost
port=389
bindDN=cn=Directory Manager
bindPassword=password
baseDN=dc=example,dc=com
searchScope=sub

dsconfig.port=4444
stop-ds.port=4444


	do not stop the server and run the upgrade:



./upgrade -f /tmp/OpenDJ-2.4.2.zip


	the upgrade process hangs indefinitely, and the following error message is observed in the log:





INFO: Launching stop command, argList: [/opt/OpenDJ-2.4.0/bin/stop-ds]
Apr 23, 2011 10:24:53 PM org.opends.quicksetup.util.ServerController$StopReader$1 run
INFO: server: The server is using the following certificate:
Apr 23, 2011 10:24:53 PM org.opends.quicksetup.util.ServerController$StopReader$1 run
INFO: server:     Subject DN:  CN=ubuntu10, O=Administration Connector Self-Signed Certificate
Apr 23, 2011 10:24:53 PM org.opends.quicksetup.util.ServerController$StopReader$1 run
INFO: server:     Issuer DN:  CN=ubuntu10, O=Administration Connector Self-Signed Certificate
Apr 23, 2011 10:24:53 PM org.opends.quicksetup.util.ServerController$StopReader$1 run
INFO: server:     Validity:  Sat Apr 23 22:19:32 CEST 2011 through Mon Apr 22 22:19:32 CEST 2013
Apr 23, 2011 10:24:53 PM org.opends.quicksetup.util.ServerController$StopReader$1 run
INFO: server: Do you wish to trust this certificate and continue connecting to the server?

Without the tools.properties file, the upgrade works fine or if the server is not running before the upgrade script is executed.