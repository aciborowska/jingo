Found with 7.0.0 rev (6f3fe200a94)

In our upgrade tests, we set up a 6.0.0 server and set a global server id using the following command:


./UpgradeTasks/DJ_TASKS3/opendj/setup directory-server -h localhost -p 1392 -D "cn=myself" -w password --adminConnectorPort 4447 -Z 1639 -b dc=com -l /local/GIT/pyforge/PyBot/OpenDJ/testcases/data/upgrade_startup.ldif  --acceptLicense --monitorUserDn uid=Monitor --monitorUserPassword password

./upgrade_group/UpgradeTasks/DJ_TASKS3/opendj/bin/dsconfig -h localhost -p 4447 -D "cn=myself" -w password -X set-global-configuration-prop --set server-id:4 -n
 


We set up another server without specifying a server id:


./UpgradeTasks/DJ_TASKS2/opendj/setup directory-server -h localhost -p 1391 -D "cn=myself" -w password --adminConnectorPort 4446 -Z 1638 -b dc=com -l /local/GIT/pyforge/PyBot/OpenDJ/testcases/data/upgrade_startup.ldif -O --acceptLicense --monitorUserDn uid=Monitor --monitorUserPassword password



and we configure replication between these servers:


./UpgradeTasks/DJ_TASKS2/opendj/bin/dsreplication configure --host1 localhost --port1 4446 --bindDN1 "cn=myself" --bindPassword1 "password" --replicationPort1 8991 --host2 localhost --port2 4447 --bindDN2 "cn=myself" --bindPassword2 "password" --replicationPort2 8992 -b dc=com -I admin -w password -X -n

./UpgradeTasks/DJ_TASKS2/opendj/bin/dsreplication initialize-all -h localhost -p 4446 -b dc=com -I admin -w password -X -n



We add some entries to fill the changelog and we perform some checks then we stop and upgrade one server:


UpgradeTasks/DJ_TASKS2/opendj/bin/stop-ds 

cp -R 7.0.0/opendj UpgradeTasks/DJ_TASKS2/

UpgradeTasks/DJ_TASKS2/opendj/upgrade -n --acceptLicense --force
UpgradeTasks/DJ_TASKS2/opendj/bin/start-ds 



When trying to upgrade the second server, it fails:


/upgrade_group/UpgradeTasks/DJ_TASKS3/opendj/upgrade -n --acceptLicense --force 	
11:20:37.743 	WARN 	ERROR:
-- rc --
returned 10, expected to be in [0]
-- stdout --

>>>> OpenDJ Upgrade Utility

 * OpenDJ configuration will be upgraded from version
 6.0.0.cf670d07003a6410cf757ab079d233692b74936e to
 7.0.0.6f3fe200a94c70528787d701b9c6e929d4423232
 * OpenDJ data will be upgraded from version 6.0.0 to
 7.0.0.6f3fe200a94c70528787d701b9c6e929d4423232
 * See
 'upgrade_group/UpgradeTasks/DJ_TASKS3/opendj/logs/upgrade.log'
 for a detailed log of this operation

>>>> Preparing to upgrade


 ** Could not find a server ID to set for the server. Verify the configuration
 references a valid server ID for domain cn=admin data

 * See
 'upgrade_group/UpgradeTasks/DJ_TASKS3/opendj/logs/upgrade.log'
 for a detailed log of this operation




To reproduce:

in config.cfg:
[OpenDJ]
global_server_id = True
previous_version = 6.0.0

./run-pybot.py -s upgrade_group.UpgradeTasks -t upgrade_tasks dj


Â 