Found with rev (fa8bcf480f1)

We set up 2 servers replicated on dc=com and a proxy in front of them.
We configure a 3rd server to be replicated on dc=org with DJ1.

./DJ1/opendj/bin/dsreplication configure --host1 dj-linux2.internal.forgerock.com --port1 4444 --bindDN1 "cn=myself" --bindPassword1 "password" --replicationPort1 8989 --host2 dj-linux2.internal.forgerock.com --port2 4446 --bindDN2 "cn=myself" --bindPassword2 "password" --replicationPort2 8991 -b dc=org -I admin -w password -X -n

./DJ1/opendj/bin/dsreplication initialize-all -h dj-linux2.internal.forgerock.com -p 4444 -b dc=org -I admin -w password -X -n




We add this 3rd server as primary server in proxy service discovery mechanism.


./PROXY1/opendj/bin/dsconfig -h dj-linux2.internal.forgerock.com -p 4447 -D "cn=myself" -w password -X set-service-discovery-mechanism-prop --mechanism-name "Static Servers Service Discovery Mechanism" --set primary-server:dj-linux2.internal.forgerock.com:1391 -n



and check dc=org is routed properly.

When unconfiguring, we sometimes get the following error in logs:


./DJ3/opendj/bin/dsreplication unconfigure -h dj-linux2.internal.forgerock.com -p 4446 -I admin -w password --unconfigureAll -X -n

--- Check for error patterns in "/DJ3/opendj/logs/errors" file --- 	
07:09:02.382 	WARN 	(ERROR) [26/Sep/2018:06:08:53 +0100] category=CORE severity=ERROR msgID=140 msg=An uncaught exception during processing for thread Replication server RS(4) connector thread has caused it to terminate abnormally. The stack trace for that exception is: NullPointerException: string was null (LocalizableMessage.java:78 ReplicationServerHandler.java:252 ReplicationServer.java:458 ReplicationServer.java:398 ReplicationServerConnectThread.java:42) 	
07:09:02.405 	WARN 	(ERROR) [26/Sep/2018:06:08:53 +0100] category=CORE severity=NOTICE msgID=139 msg=The Directory Server has sent an alert notification generated by class org.opends.server.api.DirectoryThread (alert type org.opends.server.UncaughtException, alert ID org.opends.messages.core-140): An uncaught exception during processing for thread Replication server RS(4) connector thread has caused it to terminate abnormally. The stack trace for that exception is: NullPointerException: string was null (LocalizableMessage.java:78 ReplicationServerHandler.java:252 ReplicationServer.java:458 ReplicationServer.java:398 ReplicationServerConnectThread.java:42)




This seems to be random (could not reproduce it on my laptop)
The test that triggers the error can be run with:



./run-pybot.py  -s proxy_group.RouteConfigurationWithStatic -t Search_With_Specific_Route_Add_New_Server  opendj

