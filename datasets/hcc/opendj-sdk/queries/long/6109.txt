Reproducible on DS 6.0.0 and 6.5.0.

If there are two backends, e.g. backend1 "dc=example,dc=com" and backend2 "dc=sub,dc=example,dc=com" (i.e. sub-suffix), and replication is configured for "dc=example,dc=com":

	expected behaviour: replication should be enabled only for backend1.
	current behaviour: changes in the sub-suffix (backend2) are also replayed.



 

TEST CASE:

	Setup two DS 6.5 instances:





$ ./setup directory-server \
... --sampleData 20 \
 --baseDn dc=example,dc=com



	Create "backend2" on both instances, "dc=sub,dc=example,dc=com":





$ bin/dsconfig create-backend \
 --set base-dn:dc=sub,dc=example,dc=com \
 --set enabled:true \
 --set db-cache-percent:10 \
 --type je \
 --backend-name backend2 \
 --hostname ... --port ... \
 --bindDn "cn=directory manager" --bindPassword password -X -n



	Add entries to the new backend, only on instance1:



 


dn: dc=sub,dc=example,dc=com
objectClass: top
objectClass: domain
dc: sub
dn: uid=test.0,dc=sub,dc=example,dc=com
objectClass: top
objectClass: extensibleObject
objectClass: organizationalPerson
objectClass: person
objectClass: inetOrgPerson
mail: test.0@example.com
givenName: test.0-givenname
sn: test.0-sn
cn: test.0-cn
userPassword: password
uid: test.0


 


	Configure and initialise replication for "dc=example,dc=com" from instance1 to instance2.



Dsreplication status on instance1:



$ bin/dsreplication status -h ... -p ... --adminUID admin --adminpassword password -X
Suffix DN : Server : Entries : Replication enabled : DS ID : RS ID : RS Port (1) : Delay (ms) : Security (2)
---------------------------:-----------------------------------:---------:---------------------:-------:-------:-------------:------------:-------------
dc=example,dc=com : trio.internal.forgerock.com:60446 : 22 : true : 2360 : 27386 : 60991 : 0 : false
dc=example,dc=com : trio.internal.forgerock.com:60447 : 22 : true : 7613 : 13168 : 60992 : 0 : false
dc=amcfg,dc=example,dc=com : trio.internal.forgerock.com:60446 : 2 : : : : : : 
dc=amcfg,dc=example,dc=com : trio.internal.forgerock.com:60447 : 0 : : : : : : 
uid=Monitor : trio.internal.forgerock.com:60446 : 1 : : : : : : 



	Add an entry in "dc=sub,dc=example,dc=com" on instance1:





dn: uid=test.1,dc=sub,dc=example,dc=com
objectClass: top
objectClass: extensibleObject
objectClass: organizationalPerson
objectClass: person
objectClass: inetOrgPerson
mail: test.1@example.com
givenName: test.1-givenname
sn: test.1-sn
cn: test.1-cn
userPassword: password
uid: test.1



	On instance2:



(instance2 error log)


[19/Mar/2019:15:52:01 +0800] category=CORE severity=NOTICE msgID=139 msg=The Directory Server has sent an alert notification generated by class org.opends.server.replication.plugin.LDAPReplicationDomain (alert type org.opends.server.replication.UnresolvedConflict, alert ID org.opends.messages.replication-69): An unresolved conflict was detected for DN uid=test.1,dc=amcfg,dc=example,dc=com


	the "dc=amcfg" entry does not exist on instance2, because it was only created on instance1 (before configuring replication):


$ bin/ldapsearch -p 60392 -D "cn=directory manager" -w password -b "dc=sub,dc=example,dc=com" "uid=test.1" dn
# The LDAP search request failed: 32 (No Such Entry)
# Additional Information: The search base entry 'dc=sub,dc=example,dc=com' does not exist

	a replication conflict entry has been created on instance2, for uid=test.1:


$ bin/ldapsearch -p 60392 -D "cn=directory manager" -w password -b "dc=example,dc=com" "uid=test.1" +
dn: entryuuid=ac11e3aa-d35f-4307-a10b-acd8849a3b68+uid=test.1,dc=example,dc=com
createTimestamp: 20190319075200Z
creatorsName: cn=Directory Manager
ds-sync-conflict: uid=test.1,dc=sub,dc=example,dc=com
ds-sync-hist: dn:0104016994ef8cad000000a42360:add
...


