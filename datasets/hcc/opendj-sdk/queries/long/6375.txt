During our performance tests, we started encountering performance degradation when comparing throughtput of indexed modrate operations between 6.5.0 and 7.0.0.

Last successful test was run with 7.0.0-SNAPSHOT revision number: 30b584acb50

Issue found with 7.0.0-SNAPSHOT revision number: 4c4ca7672a4

 

Steps to reproduce:

	Setup OLD_DJ1 and OLD_DJ2 with version 6.5.0 and NEW_DJ1 and NEW_DJ2 with version 7.0.0-SNAPSHOT with 100000 users
	Create replication topology containing OLD_DJs
	Create replication topology containing NEW_DJs
	Run modrate on each topology

modrate -h beaufort.internal.forgerock.com -p 1389 -D "cn=Directory Manager" -w password -d 1800 -b uid=user.{1},ou=People,dc=com -S -F -B 60 -c 40 -i 18 -g "rand(0,99999)" -g "randstr(20)" "mail:{2}@example.com"

	Compare average_throughput and average_response_time between versions. Tolerance is set to 5%, with new DJ version throughput and response time is higher:

Average throughput (7.0.0-SNAPSHOT vs. 6.5.0): 2,747.30 < 2,940.00 - perf change: -6.55 %"
Average response time (7.0.0-SNAPSHOT vs. 6.5.0): 14.54 > 13.59 - perf change: +7.03 %"

 



Command to run the test:

./run-pybot.py -c perf -s perf_comparison.operationscomparison -t ModRate_Indexed dj
