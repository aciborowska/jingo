During our performance tests, we started encountering performance degradation when comparing search throughput on cn=monitor entry between 6.5.0 and 7.0.0.

Last successful test was run with 7.0.0-SNAPSHOT revision number: 054825e4d76

Found with 7.0.0-SNAPSHOT revision number: 4c4ca7672a4

 

Steps to reproduce:

	Setup OLD_DJ with version 6.5.0 and NEW_DJ with version 7.0.0-SNAPSHOT with 1000 users
	Create replication topology containing OLD_DJ
	Create replication topology containing NEW_DJ
	Run searchrate, modrate, addrate and searchrate on each topology

searchrate -h comte.internal.forgerock.com -p 1389 -d 1800 -b dc=com -S -F -B 60 -c 40 -i 18 -g "rand(0,999)" "(uid=user.{1})"

modrate -h comte.internal.forgerock.com -p 1389 -D "cn=Directory Manager" -w password -d 1800 -b uid=user.{1},ou=People,dc=com -S -F -B 60 -c 40 -i 18 -g "rand(0,999)" -g "randstr(40)" "description:{2}"

addrate -h comte.internal.forgerock.com -p 1389 -D "cn=Directory Manager" -w password -d 1800 -S -F -B 60 -c 40 -i 18 -C off /external/testuser/jenkins/workspace/OpenDJ-7.0.x/perf_comparison/monitor_entry_comparison/results/20190615-104430/perf_comparison/tmp/addrate.template

searchrate -h comte.internal.forgerock.com -p 1389 -D "cn=Directory Manager" -w password -d 1800 -b cn=monitor -S -F -B 60 -c 40 -i 18 "(objectclass=*)"

	Compare average_throughput and average_response_time betweeen versions. Tolerance is set to 5%, with new DJ version throughput and response time is higher:

Average throughput (7.0.0-SNAPSHOT vs. 6.5.0): 341.20 < 365.50 - perf change: -6.65 %"
Average response time (7.0.0-SNAPSHOT vs. 6.5.0): 117.21 > 109.42 - perf change: +7.12 %" 

 



Command to run the test:

./run-pybot.py -c perf -s perf_comparison.monitorcomparison dj

