Example (see OPENDJ-6184):



[09/Apr/2019:11:11:37 +0100] category=SYNC severity=ERROR msgID=119 msg=Directory server DS(aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa) encountered an unexpected error while connecting to replication server [fe80:0:0:0:0:5efe:ac18:30a%net1]:8989 for domain "dc=example,dc=com": ClassCastException: org.opends.server.replication.protocol.StopMsg cannot be cast to org.opends.server.replication.protocol.TopologyMsg (ReplicationBroker.java:999 ReplicationBroker.java:696 ReplicationBroker.java:269 ReplicationDomain.java:2115 LDAPReplicationDomain.java:576 MultimasterReplication.java:321 MultimasterReplication.java:295 MultimasterReplication.java:408 MultimasterReplication.java:95 ServerManagedObjectAddListenerAdaptor.java:50 ConfigAddListenerAdaptor.java:159 ConfigurationHandler.java:464 ConfigurationBackend.java:303 AddOperation.java:536 AddOperation.java:329 AddOperation.java:268 SynchronousStrategy.java:37 LdapClientConnection.java:443 LdapClientConnection.java:114 LdapClientConnection.java:727 LdapClientConnection.java:563 ...)



Acceptance criteria:

Make replication code resilient to unexpected StopMsgs. All casts should be guarded with instanceof checks.