I have 4 trunk servers - 2 DS and 2 RS, all connected and replicating. These are using ProtocolVersion.REPLICATION_PROTOCOL_V8.

When I connect a 2.6.1 DS (REPLICATION_PROTOCOL_V7) things look like they're working - changes to dc=example,dc=com seem to flow through - but the 2.6.1 server's error log is flooded with failures:


[17/Jul/2014:09:35:34 +0100] category=SYNC severity=SEVERE_WARNING msgID=14811316 msg=Directory server DS(17939) encountered an error while receiving changes for domain "cn=admin data" from replication server RS(14282) at rih.local/172.20.2.253:9989. The connection will be closed, and this directory server will now try to connect to another replication server



Analysis with netstat shows the 2.6.1 server repeatedly disconnecting and reconnecting to each RS. The RSes and the 2.6.1 DS consume a lot of CPU - something that's easy to spot when they're on your laptop!

With a debugger attached to the 2.6.1 server I can see that a DataFormatException is being thrown by ReplicationMsg.generateMsg() - buffer[0] is 37 (MSG_TYPE_REPLICA_OFFLINE), which is an unknown message for a v7 server.

The trunk server should not be sending this message.