Reported on DS 6.0.0.

When available disk space goes below the RS changelog disk-low-threshold, the RS continues running (as expected):

 


[11/Sep/2018:13:56:02 +0800] category=CORE severity=WARNING msgID=139 msg=The Directory Server has sent an alert notification generated by class org.opends.server.extensions.DiskSpaceMonitor (alert type org.opends.server.DiskSpaceLow, alert ID org.opends.messages.core-749): The free space (448.63 gigabytes) on the disk containing directory "/home" is between low and full threshold for the following subsystems: "Replication Changelog" (low=500 gigabytes, full=100 gigabytes). Write operations are only permitted by a user with the BYPASS_LOCKDOWN privilege until the free space rises above the threshold. Replication updates are still allowed
[11/Sep/2018:13:56:02 +0800] category=SYNC severity=WARNING msgID=311 msg=Disk space for the replication changelog is getting low. The replication server will continue to operate, but will stop in the event of a full disk

 

But when available disk space goes back above the RS changelog disk-low-threshold, the RS tries to start its threads and bind to the RS port... although the threads were running all the while. So the RS "restart" fails because it is already running:

 


[11/Sep/2018:13:56:22 +0800] category=CORE severity=NOTICE msgID=751 msg=The free space (448.63 gigabytes) on the disk containing directory "/home" is now above the low threshold for the following subsystems: "Replication Changelog" (low=54.21 gigabytes, full=50.21 gigabytes)
[11/Sep/2018:13:56:22 +0800] category=SYNC severity=ERROR msgID=309 msg=Could not restart the Replication Server, bind to listen port 8989 failed : Address already in use (Bind failed)

 

TEST CASE:
~~~~~~~~~~

1. Start DS 6.0.0, configure replication (DS+RS).

2. Set disk thresholds for RS changelog, so that the disk-low-threshold is higher than available disk space:


$ bin/dsconfig set-replication-server-prop --provider-name "Multimaster Synchronization" --bindPassword password --bindDN "cn=Directory Manager" --hostname host1.domain.com --port 4444 --trustAll --no-prompt --set disk-low-threshold:"500 GB" --set disk-full-threshold:"100 GB"

 

3. And then reset disk thresholds to default, so that the disk-low-threshold is lower than the available disk space:


$ bin/dsconfig set-replication-server-prop --provider-name "Multimaster Synchronization" --bindPassword password --bindDN "cn=Directory Manager" --hostname host1.domain.com --port 4444 --trustAll --no-prompt --reset disk-low-threshold --reset disk-full-threshold

 

Error log has:


[11/Sep/2018:13:56:22 +0800] category=SYNC severity=ERROR msgID=309 msg=Could not restart the Replication Server, bind to listen port 8989 failed : Address already in use (Bind failed)

 

 