While investigating issue OPENDJ-333 I thought initially that the divergence was being caused by usage of a permissive modify request control. Ultimately, this was not the cause, but I believe that there is a potential bug here anyway since this control is not handled by replication AFAIK.

The following test case should expose the problem:

dn: cn=test,dc=example,dc=com
changetype: add
objectClass: top
objectClass: person
cn: test
sn: test
description: one
description: two


	Permissive modify request control
dn: cn=test,dc=example,dc=com
control: 1.2.840.113556.1.4.1413 true
changetype: modify
delete: description
description: missing value
-
add: description
description: three
-



The final modify request should be applied without any problems even though the value to be deleted is missing, resulting in an entry containing the values "one", "two", and "three". I suspect that the change will be applied successfully but will fail during replay causing divergence: the replica will not contain the value "three".