Problem
Persistent search does not work anymore after online rebuild-index finishes (for those connections that is still connected and using PSearch)

Test
1. Tested on DJ 2.6.3 & 5.5 where (server/client)

2. Start a client (5.5. ldapsearch client)

# ldapsearch -h localhost -p 389 -D"cn=Directory Manager" -w password -C PS:any:1:1 -b "dc=openam,dc=forgerock,dc=org" '(objectclass=*)'

3. Now touch some entries to see persistent search works as there is the psearch result. Eg


# Persistent search change type:  modify
dn: uid=demo,ou=people,dc=openam,dc=forgerock,dc=org
objectClass: inetuser
objectClass: iplanet-am-managed-person
objectClass: kbaInfoContainer
....


4. Do a online rebuilt index

# rebuild-index -h localhost -p 10504 -D"cn=Directory Manager" -w password --rebuildAll -b "dc=openam,dc=forgerock,dc=org" -t 0 -X

5. When the above is done. touch some entries again. There is no psearch result (and the connection is idle)


 Problem

So persistent search does not work anymore if there is a rebuild-index online done.

 Workaround

Do not do online index rebuild (or do a reconnection)