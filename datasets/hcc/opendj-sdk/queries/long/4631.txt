1. Two DJ 3.5.2 instances.

2. Two backends:
 userRoot "dc=example,dc=com" (100K entries)
 backend2 "dc=example2,dc=com (1K entries)

3. Dsreplication enable.

No "dsreplication initialize".

4. Run rebuild-index of both backends in parallel:

./rebuild-index --port 4444 --hostname myhost.mydomain.com --bindDN "cn=directory manager" --bindpassword password --baseDN "dc=example2,dc=com" --rebuildAll --trustAll --start 0

./rebuild-index --port 4444 --hostname myhost.mydomain.com --bindDN "cn=directory manager" --bindpassword password --baseDN "dc=example,dc=com" --rebuildAll --trustAll --start 0

=> One of the rebuild-index tasks failed:


[14/Sep/2017:16:47:32 +0800] category=CONFIG severity=ERROR msgID=646 msg=org.forgerock.opendj.config.server.ConfigChangeListenerAdaptor.applyConfigurationChange failed for entry ds-cfg-backend-id=userRoot,cn=Backends,cn=config: result code=Other, admin action required=false, messages="An unexpected error occurred while attempting to determine whether the backend associated with configuration entry ds-cfg-backend-id=userRoot,cn=Backends,cn=config should be enabled or disabled: NullPointerException (LDAPReplicationDomain.java:278 BackendConfigManager.java:792 BackendConfigManager.java:407 BackendConfigManager.java:59 ServerManagedObjectChangeListenerAdaptor.java:50 ConfigChangeListenerAdaptor.java:281 ConfigurationHandler.java:643 ConfigurationBackend.java:473 LocalBackendModifyOperation.java:492 LocalBackendModifyOperation.java:279 LocalBackendWorkflowElement.java:744 LocalBackendWorkflowElement.java:1051 LocalBackendWorkflowElement.java:894 ModifyOperationBasis.java:337 InternalClientConnection.java:1382 InternalClientConnection.java:1464 TaskUtils.java:208 TaskUtils.java:191 RebuildTask.java:192 Task.java:965 TaskThread.java:179). It will be disabled"
[14/Sep/2017:16:47:32 +0800] category=TASK severity=ERROR msgID=2 msg=The task could not disable a backend: ds-cfg-backend-id=userRoot,cn=Backends,cn=config[14/Sep/2017:16:47:32 +0800] category=BACKEND severity=NOTICE msgID=414 msg=Rebuild Index task 20170914164732304 finished execution in the state Stopped by error

 Code inspection shows the the issue is also present in 5.0, 5.5,6.0 however NPE happens at a different location (see next comment)