Running export-ldif, import-ldif, verify-index in an offline mode when a notification handler is enabled against a password policy fails with the following.

 

opendj; bin /$ ./export-ldif --offline --backendId userRoot --includeBranch dc=example,dc=com --ldifFile export.ldif
An error occurred while attempting to initialize server components to run the
tool: An error occurred while attempting to initialize the password policy
components:  The password policy defined in configuration entry cn=Default
Password Policy,cn=Password Policies,cn=config is invalid: ConfigException: No
notification handler enabled with DN: cn=SMTP Handler,cn=Account Status
Notification Handlers,cn=config (PasswordPolicyFactory.java:308
PasswordPolicyFactory.java:227 PasswordPolicyFactory.java:166
PasswordPolicyFactory.java:86 PasswordPolicyFactory.java:645
PasswordPolicyFactory.java:82 PasswordPolicyConfigManager.java:297
PasswordPolicyConfigManager.java:102 DirectoryServer.java:1820
DirectoryServer.java:314 DirectoryServer.java:901 DirectoryServer.java:801
ExportLdif.java:340 ExportLdif.java:326 TaskToolHelper.java:311
ExportLdif.java:293 Utils.java:961 Utils.java:938 ExportLdif.java:137)
(id=org.opends.messages.tool-373)

 

This is related to:

OPENDJ-5895 Unable to rebuild indexes when the Error Log Handler is assigned to a password policy

1) Create a Mail Server entry

 

dsconfig create-mail-server \
 --set enabled:true \
 --set smtp-server:2525 \
 --type generic \
 --server-name mail.example.com \
 --hostname localhost \
 --port 4444 \
 --bindDn "cn=Directory Manager" \
 --trustAll \
 --no-prompt

 

2) Create the SMTP Handler Notification Handler

 

dsconfig set-account-status-notification-handler-prop \
 --hostname opendj.forgerock.com \
 --port 4444 \
 --bindDN "cn=Directory Manager" \
 --bindPasswordFile passwordfile \
 --handler-name "SMTP Handler Notification Handler" \
 --set enabled:true \
 --set send-email-as-html:true \
 --trustAll --no-prompt

3) Add the SMTP Handler Notification Handler to the Default Password Policy.

 

dsconfig set-password-policy-prop \
 --policy-name 'Default Password Policy' \
 --set account-status-notification-handler:'SMTP Handler Notification Handler' \
 --hostname opendj.forgerock.com \
 --port 4444 \
 --bindDN "cn=Directory Manager" \
 --bindPasswordFile passwordfile \
 --trustAll \
 --no-prompt

 

 

 

 