When testing failover scenarios, the following NPE was detected with 2.6.4 SDK:

java.lang.NullPointerException
	at org.forgerock.opendj.ldap.HeartBeatConnectionFactory$ConnectionImpl.checkState(HeartBeatConnectionFactory.java:831)
	at org.forgerock.opendj.ldap.HeartBeatConnectionFactory$ConnectionImpl.deleteAsync(HeartBeatConnectionFactory.java:647)
	at org.forgerock.opendj.ldap.AbstractAsynchronousConnection.delete(AbstractAsynchronousConnection.java:111)
	at org.forgerock.opendj.ldap.AbstractConnection.delete(AbstractConnection.java:360)
	at org.forgerock.opendj.ldap.AbstractConnectionWrapper.delete(AbstractConnectionWrapper.java:265)
	at org.forgerock.opendj.ldap.CachedConnectionPool$PooledConnection.delete(CachedConnectionPool.java:310)
	at org.forgerock.openam.cts.impl.LDAPAdapter.delete(LDAPAdapter.java:188)
	at org.forgerock.openam.cts.impl.async.DeleteTask.execute(DeleteTask.java:37)
	at org.forgerock.openam.cts.impl.async.TaskProcessor.run(TaskProcessor.java:91)



As it can be seen, the connection was quite busy performing delete operations when the server went down (this is a failoverLB->FixedCP->ACF->HBCF decorated connection), which then resulted in this NPE. The expected end-user behavior would be to see an ErrorResultException being thrown in this scenario explaining that the connection is no longer valid (or there was a connection failure).