User's privileges that were added via ds-privilege-name will not work if the user authenticates via SASL EXTERNAL. The same user can use the privilege if the user authenticates using simple bind.

I discovered that the entry object that is passed to the getPrivileges method (from ClientConnection.java) does not contain operational attributes. As ds-privilege-name is operational, this causes the server to ignore a user's privileges if the user is authenticated via SASL. Tracing back this problem, I am pretty sure that the root cause is the Certificate Mapper that returns the mapped user's entry without any operational attribute. In this case, I was using the "Subject DN to User Attribute Certificate Mapper". 

The following changes to "SubjectDNToUserAttributeCertificateMapper.java" fixed the issue for me.


--- src/server/org/opends/server/extensions/SubjectDNToUserAttributeCertificateMapper.java     (revision 7856)
+++ src/server/org/opends/server/extensions/SubjectDNToUserAttributeCertificateMapper.java     (working copy)
@@ -210,7 +210,8 @@
       {
         if (userEntry == null)
         {
-          userEntry = entry;
+          Backend backend = DirectoryServer.getBackend(baseDN);
+          userEntry = backend.getEntry(entry.getDN());
         }
         else
         {

 

All the other Certificate Mappers contain similar code, so the provided fix may also be applied to those classes.