In the /opt/opendj/env.sh script:

 

1. The `DJ_INSTANCE`  environment variable comes from a value passed in the configmap.  This is used in the  script to calculate the list of RS servers that get templated in config.ldif.

This work ok in helm because we template the variable once, but it is painful in kustomize.

We should just calculate it from the hostname: $HOSTNAME instead, then we can just get rid of it in the configmap variable.

I think this works for bash:


 DJ_INSTANCE=${HOSTNAME::-2}

  Which truncates the last two characters ( the -0, -1, etc.)

2. The serverId in 7.x can now be a string (not just a digit). We should just set the serverId to the $HOSTNAME