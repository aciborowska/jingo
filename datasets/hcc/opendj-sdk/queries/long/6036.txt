Found with rev 0b5093d719d1c87e1c722c94d60b3d12aa0bc758

We set up two 3.5.0 servers, with some data.
Then we configure replication:

DJ_ENCRYPT1/opendj/bin/dsreplication enable --host1 localhost --port1 4451 --bindDN1 "cn=myself" --bindPassword1 "password" --replicationPort1 8996 --host2 localhost --port2 4452 --bindDN2 "cn=myself" --bindPassword2 "password" --replicationPort2 8997 -b dc=com -I admin -w password -X -n

DJ_ENCRYPT1/opendj/bin/dsreplication initialize-all -h localhost -p 4451 -b dc=com -I admin -w password -X -n



We set confidentiality to true for changelogs on each server.
We add some entries on one server and check data are in sync.
Then we stop and upgrade the first server.

We check replication is working by doing LDAP operations on both servers.
Some operations are missing on second server changelog:


Content of servers differs, differences can be found at: /local/GIT/pyforge/results/20190225-164721/replication_group3/Upgrade/DJ_ENCRYPT1/opendj/tmp/diff_Encrypted_Replication_Topology_changelog_DJ_ENCRYPT1_DJ_ENCRYPT2.ldif 		
dn: changeNumber=10,cn=changelog
changetype: delete

dn: changeNumber=11,cn=changelog
changetype: delete

dn: changeNumber=12,cn=changelog
changetype: delete

dn: changeNumber=13,cn=changelog
changetype: delete

dn: changeNumber=14,cn=changelog
changetype: delete

dn: changeNumber=15,cn=changelog
changetype: delete

dn: changeNumber=16,cn=changelog
changetype: delete

dn: changeNumber=9,cn=changelog
changetype: delete



To reproduce this issue:


./run-pybot.py -n -v -s replication_group3.Upgrade -t Encrypted_Replication_Topology opendj



This is a regression but is not always reproducible.