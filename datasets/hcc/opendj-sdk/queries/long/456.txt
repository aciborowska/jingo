When setting up replication, the LDAP schema (cn=schema) is automatically replicated during the "dsreplication enable" process. 
In several setups I discovered that the 3rd instance (the 2nd "dsreplication enable" command) which is added to a topology does not get custom schema changes. Only the first two servers contain the same schema (99-user.ldif).

The issue can be reproduced using the following steps:
1.) setup 3 OpenDJ instances
2.) modify schema on instance1 (e.g. by adding a custom object class)
3.) setup replication between instance1 and instance2
4.) setup replication between instance1 and instance3
In this setup, instance1 and instance2 contain the custom schema changes while instance3 doesn't.

I'm pretty sure that the return code of mustInitializeSchema in ReplicationCliMain.java causes this problem.

The following patch fixed the issue for me:


--- src/server/org/opends/server/tools/dsreplication/ReplicationCliMain.java     (revision 7831)
+++ src/server/org/opends/server/tools/dsreplication/ReplicationCliMain.java     (working copy)
@@ -9325,7 +9325,7 @@
       String id2 = server2.getSchemaReplicationID();
       if (id1 != null)
       {
-        mustInitializeSchema = id1.equals(id2);
+        mustInitializeSchema = !id1.equals(id2);
       }
       else
       {



Best regards,
Manuel