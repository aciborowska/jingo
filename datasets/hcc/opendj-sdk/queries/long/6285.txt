When upgrading DJ from version 6.0.0 to 7.0.0 on Linux, error is raised during preparation:

>>>> Preparing to upgrade

Unable to retrieve the hostname from the admin backend using the truststore as
source of keys; 'advertised-listen-address' attribute in global configurati...
    [ Message content over the limit has been removed. ]
... Migrating replication changelog files to 6.5.0 format...............   FAIL
  Migrating replication changelog files to 6.5.0 format...............   FAIL

 ** An error occurred while renaming the changelog files:
 InitializationException: CryptoManager failed to retrieve entry
 "ds-cfg-key-id=ads-certificate,cn=ads-truststore" (the instance-key-pair
 public-key-certificate): Constraint Violation: Unable to process entry
 ds-cfg-key-id=ads-certificate,cn=ads-truststore in the trust store backend
 because the requested DN is one level below the base DN but does not specify
 a certificate name (CryptoManagerSync.java:134 DirectoryServer.java:763
 DirectoryServer.java:695 UpgradeTasks.java:1772 ProgressMonitor.java:81
 UpgradeTasks.java:1768 Upgrade.java:953 UpgradeCli.java:233 Utils.java:945
 Utils.java:922 UpgradeCli.java:95)


Config is set to:

version = 7.0.0-SNAPSHOT
previous_version = 6.0.0


 

Steps to reproduce the issue:

	Setup DJ 6.0.0
	Upgrade instance to 7.0.0-SNAPSHOT --> error should be raised



 

Command to run one of the failed tests:

./run-pybot.py -s upgrade_group.upgradetasks -t upgrade_tasks dj


 

Found in OPENDJ 7.0.0-SNAPSHOT, revision number: 66ec4cddc7fa399304a32470a5f939c8f866e9e0