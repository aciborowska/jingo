### What is the problem
Reindexing a collection causes XSL transformations run by the `transform:transform` function to fail.  XPath expressions and keys generated on a document included by the `xsl:doc` function behave strangely and generate different results after the reindex requested from the Java client.

### What did you expect
The attached example which counts the nodes in a document illustrates the problem.  Prior to the reindex, the node count reported is `1`, after the reindex, the count is `0`.  Editing and saving the XML document restores the count to `1`.  Removing either or both of the two comments at the start of the XML document appears to eliminate the problem as well.

### Describe how to reproduce or add a test
Using the Java client:
1. Create a test collection, `/db/test`. 
2. Upload the `test.xql`, `xml.xml` and `xsl.xsl` documents attached to this collection using the Java client.  
3. Open `test.xql` and choose submit.  The result should be `1`.  (`<param-count expr="count($xml//*)">1</param-count>` specifically.)
4. Choose the `/db/test` collection and reindex.
5. Submit `test.xql` again.  The result is `0`.
6. Open `xml.xml` and choose save.
7. Submit `test.xql` again.  The result is `1`.  Repeating step 4 and 5 will cause the result to become `0` again.
8. Remove either comment at the beginning of `xml.xml` and save the file.  
9. Submit `test.xql`.  The result will be `1`.
10. Reindex test again, and resubmit `test.xql`.  With the comment removed, the result will be `1` after the reindex.

Although this test doesn't demonstrate it, I also found this behavior:  If the XML document consists of two nodes:  `<a><b/></a>`, then after reindexing, the expression `count(doc('xml.xml')//*)` returns `0` , but `count(doc('xml.xml')/a//*)` returns `1` if evaluated inside a transformation.  If these expressions are evaluated in the XQuery, they return the expected results before and after the reindex.  Only expression evaluation inside a transformation are affected.


[test.zip](https://github.com/eXist-db/exist/files/1636765/test.zip)



### Context information
Please always add the following information
- eXist-db version: 3.6.1
- Java version: Java(TM) SE Runtime Environment (build 1.8.0_151-b12)
- Operating system: MacOS & Linux
- 64 bit
- Any custom changes in e.g. conf.xml: N/A (problem exists on customized and uncustomized instances)
