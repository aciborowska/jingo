We had a problem with a recursive function checking permissions using the security module function sm:get-permissions(). Our function broke up due to a java exception because one collection had an owner but was missing a group.

Maybe this should better not lead into java-exception but in some exist-exception or into an entry in the error log?

> An error occurred: null
> 
> Caused by:
> 
> javax.servlet.ServletException: An error occurred: null
>     at org.exist.http.servlets.EXistServlet.doGet(EXistServlet.java:256)
>     at javax.servlet.http.HttpServlet.service(HttpServlet.java:735)
>     at javax.servlet.http.HttpServlet.service(HttpServlet.java:848)
>     at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:669)
>     at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:457)
>     at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:137)
>     at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:575)
>     at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:231)
>     at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1075)
>     at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:384)
>     at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:193)
>     at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1009)
>     at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:135)
>     at org.eclipse.jetty.server.Dispatcher.forward(Dispatcher.java:229)
>     at org.eclipse.jetty.server.Dispatcher.forward(Dispatcher.java:103)
>     at org.exist.http.urlrewrite.Forward.doRewrite(Forward.java:46)
>     at org.exist.http.urlrewrite.XQueryURLRewrite.doRewrite(XQueryURLRewrite.java:567)
>     at org.exist.http.urlrewrite.XQueryURLRewrite.service(XQueryURLRewrite.java:355)
>     at javax.servlet.http.HttpServlet.service(HttpServlet.java:848)
>     at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:669)
>     at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1448)
>     at de.betterform.agent.web.filter.XFormsFilter.doFilter(XFormsFilter.java:177)
>     at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1419)
>     at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:455)
>     at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:137)
>     at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:533)
>     at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:231)
>     at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1075)
>     at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:384)
>     at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:193)
>     at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1009)
>     at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:135)
>     at org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:154)
>     at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:116)
>     at org.eclipse.jetty.server.Server.handle(Server.java:368)
>     at org.eclipse.jetty.server.AbstractHttpConnection.handleRequest(AbstractHttpConnection.java:488)
>     at org.eclipse.jetty.server.AbstractHttpConnection.headerComplete(AbstractHttpConnection.java:932)
>     at org.eclipse.jetty.server.AbstractHttpConnection$RequestHandler.headerComplete(AbstractHttpConnection.java:994)
>     at org.eclipse.jetty.http.HttpParser.parseNext(HttpParser.java:640)
>     at org.eclipse.jetty.http.HttpParser.parseAvailable(HttpParser.java:235)
>     at org.eclipse.jetty.server.AsyncHttpConnection.handle(AsyncHttpConnection.java:82)
>     at org.eclipse.jetty.io.nio.SelectChannelEndPoint.handle(SelectChannelEndPoint.java:628)
>     at org.eclipse.jetty.io.nio.SelectChannelEndPoint$1.run(SelectChannelEndPoint.java:52)
>     at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:608)
>     at org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:543)
>     at java.lang.Thread.run(Thread.java:745)
> Caused by: java.lang.NullPointerException
>     at org.exist.xquery.functions.securitymanager.PermissionsFunction.permissionsToXml(PermissionsFunction.java:489)
>     at org.exist.xquery.functions.securitymanager.PermissionsFunction.functionGetPermissions(PermissionsFunction.java:297)
>     at org.exist.xquery.functions.securitymanager.PermissionsFunction.eval(PermissionsFunction.java:250)
>     at org.exist.xquery.BasicFunction.eval(BasicFunction.java:70)
>     at org.exist.xquery.InternalFunctionCall.eval(InternalFunctionCall.java:56)
>     at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)
>     at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:65)
>     at org.exist.xquery.LetExpr.eval(LetExpr.java:189)
>     at org.exist.xquery.LetExpr.eval(LetExpr.java:187)
>     at org.exist.xquery.ForExpr.eval(ForExpr.java:304)
>     at org.exist.xquery.BindingExpression.eval(BindingExpression.java:164)
>     at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)
>     at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:65)
>     at org.exist.xquery.LetExpr.eval(LetExpr.java:189)
>     at org.exist.xquery.ForExpr.eval(ForExpr.java:304)
>     at org.exist.xquery.BindingExpression.eval(BindingExpression.java:164)
>     at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)
>     at org.exist.xquery.PathExpr.eval(PathExpr.java:264)
>     at org.exist.xquery.EnclosedExpr.eval(EnclosedExpr.java:80)
>     at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)
>     at org.exist.xquery.PathExpr.eval(PathExpr.java:264)
>     at org.exist.xquery.ElementConstructor.eval(ElementConstructor.java:311)
>     at org.exist.xquery.DynamicCardinalityCheck.eval(DynamicCardinalityCheck.java:74)
>     at org.exist.xquery.functions.system.AsUser.eval(AsUser.java:93)
>     at org.exist.xquery.InternalFunctionCall.eval(InternalFunctionCall.java:56)
>     at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)
>     at org.exist.xquery.PathExpr.eval(PathExpr.java:264)
>     at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)
>     at org.exist.xquery.XQuery.execute(XQuery.java:297)
>     at org.exist.xquery.XQuery.execute(XQuery.java:217)
>     at org.exist.http.RESTServer.executeXQuery(RESTServer.java:1533)
>     at org.exist.http.RESTServer.doGet(RESTServer.java:508)
>     at org.exist.http.servlets.EXistServlet.doGet(EXistServlet.java:222)
>     ... 45 more
> 
> Caused by:
> 
> java.lang.NullPointerException
>     at org.exist.xquery.functions.securitymanager.PermissionsFunction.permissionsToXml(PermissionsFunction.java:489)
>     at org.exist.xquery.functions.securitymanager.PermissionsFunction.functionGetPermissions(PermissionsFunction.java:297)
>     at org.exist.xquery.functions.securitymanager.PermissionsFunction.eval(PermissionsFunction.java:250)
>     at org.exist.xquery.BasicFunction.eval(BasicFunction.java:70)
>     at org.exist.xquery.InternalFunctionCall.eval(InternalFunctionCall.java:56)
>     at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)
>     at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:65)
>     at org.exist.xquery.LetExpr.eval(LetExpr.java:189)
>     at org.exist.xquery.LetExpr.eval(LetExpr.java:187)
>     at org.exist.xquery.ForExpr.eval(ForExpr.java:304)
>     at org.exist.xquery.BindingExpression.eval(BindingExpression.java:164)
>     at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:58)
>     at org.exist.xquery.DebuggableExpression.eval(DebuggableExpression.java:65)
>     at org.exist.xquery.LetExpr.eval(LetExpr.java:189)
>     at org.exist.xquery.ForExpr.eval(ForExpr.java:304)
>     at org.exist.xquery.BindingExpression.eval(BindingExpression.java:164)
>     at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)
>     at org.exist.xquery.PathExpr.eval(PathExpr.java:264)
>     at org.exist.xquery.EnclosedExpr.eval(EnclosedExpr.java:80)
>     at org.exist.xquery.AbstractExpression.eval(AbstractExpression.java:71)
>     at org.exist.xquery.PathExpr.eval(PathExpr.java:264)
>     at org.exist.xquery.ElementConstructor.eval(ElementConstructor.java:311)
>     at org.exist.xquery.DynamicCardinalityCheck.eval(DynamicCardinalityCheck.java:74)
>     at org.exist.xquery.functions.system..
