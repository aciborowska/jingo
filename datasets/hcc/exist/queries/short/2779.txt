NPE with higher order functions