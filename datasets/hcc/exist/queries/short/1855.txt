BrokerPool enterServiceMode and exitServiceMode are not thread-safe