The LogicalOperator that has a ReadScalar udf has a dependency on the relation that is provides the input to scalar variables. But this is not captured in the graph representation, and as a result DependencyOrderWalker does not traverse the graph in the real dependency order.

The testcase TestFRJoin2.testConcatenateJobForScalar3 fails as a result of this issue. (It has been commented out for now.)