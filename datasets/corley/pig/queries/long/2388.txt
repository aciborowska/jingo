We need a single Pig installation that works with both Hadoop versions. The current shim implementation assumes different builds for each version. We can solve this statically through internal build/installation system or by making the shim dynamic so that pig.jar will work on both version with runtime detection. Attached patch is to convert the static shims into a shim interface with 2 implementations, each of which will be compiled against the respective Hadoop version and included into single pig.jar (similar to what Hive does).

The default build behavior remains unchanged, only the shim for ${hadoopversion} will be compiled. Both shims can be built via:  ant -Dbuild-all-shims=true