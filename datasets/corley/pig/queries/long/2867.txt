Making a call to {{PigServer.registerQuery}} with an {{InputStream}} will fail if the script contains a macro. This is because {{QueryParserDriver.makeMacroDef}} requires a filename. {{QueryParserDriver.makeMacroDef}} should be changed to not assume that the script input is from a file.