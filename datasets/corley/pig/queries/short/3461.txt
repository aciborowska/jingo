Rewrite PartitionFilterOptimizer to make it work for all the cases