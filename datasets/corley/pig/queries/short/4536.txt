LIMIT and DISTINCT inside nested foreach should have combiner optimization