Diamond query optimization throws error in JOIN