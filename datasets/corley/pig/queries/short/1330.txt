Move pruned schema tracking logic from LoadFunc to core code