Assert wrongly pushed up in optimizer