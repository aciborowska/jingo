Ranking empty records leads to NullPointerException