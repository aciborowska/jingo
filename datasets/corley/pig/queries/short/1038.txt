Optimize nested distinct/sort to use secondary key