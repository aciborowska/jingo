Reusing alias name in nested foreach causes incorrect results