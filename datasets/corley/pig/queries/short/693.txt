Parameter to UDF which is an alias returned in another UDF in nested foreach causes incorrect results