optimizer pushes filter before the foreach that generates column used by filter