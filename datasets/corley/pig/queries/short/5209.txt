Cross product on flatten(map) fails with ClassCastException