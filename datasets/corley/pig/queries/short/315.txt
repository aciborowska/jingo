Issue with cast in foreach