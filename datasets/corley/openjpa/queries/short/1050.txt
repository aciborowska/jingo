Use generic types and remove casts wherever applicable