Rework ManagedRuntime to make better use of TransactionSynchronizationRegistry