Improve query result processing with composite pattern