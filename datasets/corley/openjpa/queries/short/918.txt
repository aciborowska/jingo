Stored procedures not handling returns properly