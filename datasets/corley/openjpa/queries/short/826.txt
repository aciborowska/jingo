moving some code outside of lock boundaries, that don't need to be locked