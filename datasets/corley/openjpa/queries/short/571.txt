StackOverflow: resolvable but too long recursion in broker