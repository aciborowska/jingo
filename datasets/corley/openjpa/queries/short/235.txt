SQL reordering to avoid non-nullable foreign key constraint violations