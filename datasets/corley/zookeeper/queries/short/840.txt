massive code duplication in zookeeper class