fix test coverage for single threaded C-API