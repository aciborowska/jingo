Review and refactor Java client close logic