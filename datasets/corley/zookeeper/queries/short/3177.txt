Refactor request throttle logic in NIO and Netty to keep the same behavior and make the code easier to maintain