factor out common methods from zookeeper.java