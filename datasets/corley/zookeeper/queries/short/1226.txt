extract version check in separate method in PrepRequestProcessor