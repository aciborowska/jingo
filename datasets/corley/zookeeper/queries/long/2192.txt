ZOOKEEPER-2163 applies to the trunk branch. This feature is too needed to wait for 3.5.x. So, port the feature to the 3.4.x branch so it can be released ahead of 3.5.x.