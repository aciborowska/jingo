pending changes used by PrepRequestProcessor and FinalRequestProcessor is complicated and requires synchronization between threads.